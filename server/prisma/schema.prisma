generator client {
  provider = "prisma-client-js"

  previewFeatures = ["clientExtensions"]
}

datasource db {
  provider = "postgresql"

  url = env("DATABASE_URL")
}

// 列舉型別 (Enums)

enum UserRole {
  admin    // System Admin
  manager  // Manager
  staff    // Regular Staff
  @@map("user_role")
}

enum GenderType {
  male    // Male
  female  // Female
  other   // Other
  @@map("gender_type")
}

enum DeploymentStatus {
  active      // Active
  ended       // Ended
  pending     // Pending
  terminated  // Terminated
  @@map("deployment_status")
}

enum IncidentSeverity {
  low       // Low
  medium    // Medium
  high      // High
  critical  // Critical
  @@map("incident_severity")
}

enum IncidentStatus {
  open         // Open
  in_progress  // In Progress
  closed       // Closed
  @@map("incident_status")
}

enum PermitType {
  initial    // Initial Recruitment
  extension  // Extension
  reissue    // Reissue
  @@map("permit_type")
}

enum HealthCheckType {
  entry          // Entry Exam
  mo6 @map("6mo")   // 6-Month Periodic
  mo18 @map("18mo") // 18-Month Periodic
  mo30 @map("30mo") // 30-Month Periodic
  supplementary  // Supplementary
  @@map("health_check_type")
}

enum HealthCheckResult {
  pass     // Pass
  fail     // Fail
  pending  // Pending
  @@map("health_check_result")
}

enum WorkerCategory {
  general              // General Worker
  intermediate_skilled // Intermediate Skilled
  professional         // Professional
  @@map("worker_category")
}

enum ManagementSourceType {
  direct_hiring  // Direct Hiring
  re_hiring      // Re-hiring
  transfer_in    // Transfer In
  replacement    // Replacement
  @@map("management_source_type")
}

enum ServiceStatus {
  active_service       // Active Service
  contract_terminated  // Contract Terminated
  runaway              // Runaway
  transferred_out      // Transferred Out
  commission_ended     // Commission Ended
  @@map("service_status")
}

enum StaffRoleType {
  sales_agent       // Sales Agent
  admin_staff       // Admin Staff
  bilingual_staff   // Bilingual Staff
  customer_service  // Customer Service
  accountant        // Accountant
  @@map("staff_role_type")
}

enum InsuranceType {
  labor     // Labor Insurance
  health    // Health Insurance
  accident  // Accident Insurance
  @@map("insurance_type")
}

enum AddressType {
  approval_letter   // Approval Letter Address
  medical_pickup    // Medical Pickup Address
  actual_residence  // Actual Residence Address
  arc               // ARC Address
  work              // Work Address
  @@map("address_type")
}

enum JobOrderStatus {
  open       // Open
  sourcing   // Sourcing
  partial    // Partial
  filled     // Filled
  processing // Processing
  completed  // Completed
  cancelled  // Cancelled
  @@map("job_order_status")
}

enum CandidateResult {
  selected       // Selected
  rejected       // Rejected
  failed_medical // Failed Medical
  pending        // Pending
  @@map("candidate_result")
}

enum WorkerEventType {
  RUNAWAY           // Runaway
  TRANSFER_OUT      // Transfer Out
  DEPARTURE         // Departure
  DOMESTIC_HIRE     // Domestic Hire
  CONTRACT_RENEWAL  // Contract Renewal
  DEATH             // Death
  OTHER             // Other
  @@map("worker_event_type")
}

enum RunawayStatus {
  reported_internally      // Reported Internally
  notification_submitted   // Notification Submitted
  confirmed_runaway        // Confirmed Runaway
  found                    // Found
  @@map("runaway_status")
}

enum EmployerType {
  BUSINESS    // Business Entity
  INDIVIDUAL  // Individual
  INSTITUTION // Institution
}

// ==========================================

// Phase 7: Collaboration & Alert System Enums

// ==========================================

enum CommentEntityType {
  WORKER       // Worker
  EMPLOYER     // Employer
  DEPLOYMENT   // Deployment
  JOB_ORDER    // Job Order
  LEAD         // Lead
  HEALTH_CHECK // Health Check
  @@map("comment_entity_type")
}

enum AlertSeverity {
  CRITICAL // Critical (3 days)
  WARNING  // Warning (1 month)
  INFO     // Info
  @@map("alert_severity")
}

enum AlertStatus {
  OPEN         // Open
  ACKNOWLEDGED // Acknowledged
  RESOLVED     // Resolved
  @@map("alert_status")
}

// Models

// ==========================================
// Reference Data Tables
// ==========================================

// Application Category (MOL Permit Type)
model ApplicationCategory {
  id String @id @default(uuid()) @db.Uuid

  code String @unique @db.VarChar(30) // Category Code
  nameZh String @map("name_zh") @db.VarChar(100) // Category Name (Chinese)
  nameEn String? @map("name_en") @db.VarChar(100) // Category Name (English)

  // Core Fields
  type EmployerType @default(BUSINESS) // Employer Type

  // Quota & Fee Config
  quotaBaseRate Decimal? @map("quota_base_rate") @db.Decimal(5, 2) // Quota Base Rate
  securityFeeStandard Int @default(2000) @map("security_fee_standard") // Standard Security Fee

  // UI Config
  iconName String? @map("icon_name") @db.VarChar(50) // Icon Name
  color String? @db.VarChar(20) // Color
  description String? @db.Text
  sortOrder Int @default(0) @map("sort_order")
  isActive Boolean @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  // Relations
  employers Employer[]
  workTitles WorkTitle[]

  @@map("application_categories")
}

model WorkTitle {
  id String @id @default(uuid()) @db.Uuid

  // Link to ApplicationCategory
  categoryId String? @map("category_id") @db.Uuid

  category ApplicationCategory? @relation(fields: [categoryId], references: [id])

  code String @db.VarChar(20) // Work Title Code

  // Multi-language Names
  titleZh String @map("title_zh") @db.VarChar(100) // Work Title (Chinese)
  titleEn String @map("title_en") @db.VarChar(100) // Work Title (English)
  titleTh String? @map("title_th") @db.VarChar(100) // Work Title (Thai)
  titleId String? @map("title_id") @db.VarChar(100) // Work Title (Indonesian)
  titleVn String? @map("title_vn") @db.VarChar(100) // Work Title (Vietnamese)

  // Classification Fields
  isIntermediate Boolean @default(false) @map("is_intermediate") // Is Intermediate

  isDefault Boolean @default(false) @map("is_default") // Is Default

  // --- Fees ---

  employmentSecurityFee Int @default(2000) @map("employment_security_fee") // General Security Fee

  reentrySecurityFee Int @default(2000) @map("reentry_security_fee") // Re-entry Security Fee

  // --- Insurance & Services ---

  agencyAccidentInsurance Boolean @default(false) @map("agency_accident_insurance") // Agency Accident Insurance

  agencyAccidentInsuranceAmt Int @default(0) @map("agency_accident_insurance_amount") // Agency Accident Insurance Amount

  agencyLaborHealthInsurance Boolean @default(false) @map("agency_labor_health_insurance") // Agency Labor/Health Insurance

  collectBankLoan Boolean @default(false) @map("collect_bank_loan") // Collect Bank Loan

  // --- Payroll & Compliance ---

  payDay Int? @map("pay_day") // Pay Day

  requiresMedicalCheckup Boolean @default(false) @map("requires_medical_checkup") // Requires Medical Checkup (6mo)

  // System Fields
  sortOrder Int @default(0) @map("sort_order") // Sort Order

  isActive Boolean @default(true) @map("is_active") // Is Active

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz // Created At

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz // 更新時間

  @@unique([categoryId, code])
  @@map("work_titles")
}

// Industry (DGBAS Standards)
model Industry {
  id String @id @default(uuid()) @db.Uuid
  code String @unique @db.VarChar(10) // Industry Code
  category String? @db.VarChar(5) // Category (A, B, C...)

  // Names

  nameZh String @map("name_zh") @db.VarChar(100) // Industry Name (Chinese)
  nameEn String? @map("name_en") @db.VarChar(100) // Industry Name (English)
  nameTh String? @map("name_th") @db.VarChar(100) // Industry Name (Thai)
  nameVn String? @map("name_vn") @db.VarChar(100) // Industry Name (Vietnamese)
  nameId String? @map("name_id") @db.VarChar(100) // Industry Name (Indonesian)

  issuingAgency String? @map("issuing_agency") @db.VarChar(100) // Issuing Agency
  agencyCode String? @map("agency_code") @db.VarChar(50) // Agency Code

  version String? @db.VarChar(10) // Version

  // Status
  isOpen Boolean @default(true) @map("is_open") // Is Open (Allowed for FW)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz // Created At
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz // Updated At

  // Relations

  salaryConfigs IndustrySalaryConfig[]

  recruitmentLetters EmployerRecruitmentLetter[]

  jobTitles IndustryJobTitle[]

  @@map("industries")
}

model IndustrySalaryConfig {
  id String @id @default(uuid()) @db.Uuid

  industryId String @map("industry_id") @db.Uuid

  industry Industry @relation(fields: [industryId], references: [id], onDelete: Cascade)

  effectiveDate DateTime @map("effective_date") @db.Date // Effective Date

  // Salary Standards (Monthly)

  technicalSalary Int @map("technical_salary") // Technical Salary

  nonTechnicalSalary Int @map("non_technical_salary") // Non-Technical Salary

  // Special Schedule

  specialTechSalary Int? @map("special_tech_salary") // Special Schedule Tech Salary

  specialNonTechSalary Int? @map("special_non_tech_salary") // Special Schedule Non-Tech Salary

  // Mid-level Skilled

  midLevelSalary Int? @map("mid_level_salary") // Mid-Level Salary

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@index([industryId])
  @@index([effectiveDate])
  @@map("industry_salary_configs")
}

model IndustryJobTitle {
  id String @id @default(uuid()) @db.Uuid
  industryId String @map("industry_id") @db.Uuid
  industry Industry @relation(fields: [industryId], references: [id], onDelete: Cascade)
  titleZh String @map("title_zh") @db.VarChar(100) // Job Title (Chinese)
  titleEn String? @map("title_en") @db.VarChar(100) // Job Title (English)
  titleTh String? @map("title_th") @db.VarChar(100) // Job Title (Thai)
  titleVn String? @map("title_vn") @db.VarChar(100) // Job Title (Vietnamese)
  titleId String? @map("title_id") @db.VarChar(100) // Job Title (Indonesian)
  isActive Boolean @default(true) @map("is_active") // Is Active
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz // Created At
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz // 更新時間

  @@index([industryId])
  @@map("industry_job_titles")
}

model ContractType {
  id String @id @default(uuid()) @db.Uuid

  code String @unique @db.VarChar(50)

  name String @db.VarChar(100)

  isControlled Boolean @default(false) @map("is_controlled")

  description String? @db.Text

  sortOrder Int @default(0) @map("sort_order")

  isActive Boolean @default(true) @map("is_active")

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  // Relations

  deployments Deployment[]

  @@map("contract_types")
}

model Country {
  id String @id @default(uuid()) @db.Uuid
  code String @unique @db.VarChar(10) // ISO Country Code
  nameZh String @map("name_zh") @db.VarChar(50) // Country Name (Chinese)
  nameEn String? @map("name_en") @db.VarChar(50) // Country Name (English)
  sortOrder Int @default(0) @map("sort_order") // Sort Order
  isActive Boolean @default(true) @map("is_active") // Is Active
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz // Created At
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz // Updated At

  @@map("countries")
}

model DomesticAgency {
  id String @id @default(uuid()) @db.Uuid

  code String @unique @db.VarChar(10)

  agencyNameZh String @map("agency_name_zh") @db.VarChar(100)

  agencyNameEn String? @map("agency_name_en") @db.VarChar(100)

  agencyNameShort String? @map("agency_name_short") @db.VarChar(50)

  phone String? @map("phone") @db.VarChar(20)

  fax String? @map("fax") @db.VarChar(20)

  email String? @map("email") @db.VarChar(100)

  emergencyEmail String? @map("emergency_email") @db.VarChar(255)

  website String? @map("website") @db.VarChar(100)

  customerServicePhone String? @map("customer_service_phone") @db.VarChar(20)
  emergencyPhone String? @map("emergency_phone") @db.VarChar(20)


  zipCode String? @map("zip_code") @db.VarChar(5) // Zip Code
  city String? @db.VarChar(20) // City
  district String? @db.VarChar(20) // District
  addressZh String? @map("address_zh") @db.VarChar(200) // Address (Chinese)
  addressEn String? @map("address_en") @db.VarChar(200) // Address (English)


  representativeName String? @map("representative_name") @db.VarChar(50)

  representativeNameEn String? @map("representative_name_en") @db.VarChar(100)

  representativeIdNo String? @map("representative_id_no") @db.VarChar(20)

  representativePassport String? @map("representative_passport") @db.VarChar(20)

  checkPayableTo String? @map("check_payable_to") @db.VarChar(50)

  // å¬å¸è­ç§è³è¨

  taxId String? @map("tax_id") @db.VarChar(10)

  taxRegistrationNo String? @map("tax_registration_no") @db.VarChar(20)

  permitNumber String? @map("permit_number") @db.VarChar(20)

  permitValidFrom DateTime? @map("permit_valid_from") @db.Date

  permitValidTo DateTime? @map("permit_valid_to") @db.Date

  businessRegistrationNo String? @map("business_registration_no") @db.VarChar(50)

  // éè¡å¸³æ¶è³è¨

  postalAccountNo String? @map("postal_account_no") @db.VarChar(20)

  postalAccountName String? @map("postal_account_name") @db.VarChar(100)

  bankName String? @map("bank_name") @db.VarChar(100)

  bankCode String? @map("bank_code") @db.VarChar(3)

  bankBranchCode String? @map("bank_branch_code") @db.VarChar(4)

  bankAccountNo String? @map("bank_account_no") @db.VarChar(20)

  bankAccountName String? @map("bank_account_name") @db.VarChar(100)

  // å§é¨ç®¡ç

  accountant String? @map("accountant") @db.VarChar(50)

  isActive Boolean @default(true) @map("is_active")

  sortOrder Int @default(0) @map("sort_order")

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  // Relations

  bilateralTradeLicenses AgencyBilateralTradeLicense[]

  bankAccounts DomesticAgencyBankAccount[]

  employees Employee[]

  @@map("domestic_agencies")
}

model Bank {
  id String @id @default(uuid()) @db.Uuid

  code String @unique @db.VarChar(12)

  bankName String @map("bank_name") @db.VarChar(100)

  bankNameEn String? @map("bank_name_en") @db.VarChar(100)

  contactPerson String? @map("contact_person") @db.VarChar(50)

  phone String? @map("phone") @db.VarChar(30)

  fax String? @map("fax") @db.VarChar(30)

  address String? @map("address") @db.VarChar(200)

  notes String? @map("notes") @db.VarChar(200)

  isActive Boolean @default(true) @map("is_active")

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  // Relations

  agencyAccounts DomesticAgencyBankAccount[]

  @@map("banks")
}

model DomesticAgencyBankAccount {
  id String @id @default(uuid()) @db.Uuid

  domesticAgencyId String @map("domestic_agency_id") @db.Uuid

  domesticAgency DomesticAgency @relation(fields: [domesticAgencyId], references: [id], onDelete: Cascade)

  bankId String @map("bank_id") @db.Uuid

  bank Bank @relation(fields: [bankId], references: [id], onDelete: Cascade)

  agencyUnitCode String @map("agency_unit_code") @db.VarChar(12)

  agencyAccountNo String @map("agency_account_no") @db.VarChar(20)

  accountPurpose String? @map("account_purpose") @db.VarChar(100)

  isPrimary Boolean @default(false) @map("is_primary")

  isActive Boolean @default(true) @map("is_active")

  notes String? @map("notes") @db.Text

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@unique([domesticAgencyId, bankId, agencyAccountNo])
  @@index([domesticAgencyId])
  @@index([bankId])

  @@map("domestic_agency_bank_accounts")
}

model AgencyBilateralTradeLicense {
  id String @id @default(uuid()) @db.Uuid

  agencyId String @map("agency_id") @db.Uuid

  agency DomesticAgency @relation(fields: [agencyId], references: [id], onDelete: Cascade)

  country String @db.VarChar(2)

  licenseNumber String? @map("license_number") @db.VarChar(50)

  validFrom DateTime @map("valid_from") @db.Date

  validTo DateTime @map("valid_to") @db.Date

  status String @default("ACTIVE") @db.VarChar(20) // ACTIVE, EXPIRED, REVOKED


  notes String? @map("notes") @db.Text

  createdBy String? @map("created_by") @db.Uuid

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@index([agencyId])
  @@index([validTo])
  @@map("agency_bilateral_trade_licenses")
}

model PartnerAgency {
  id String @id @default(uuid()) @db.Uuid

  code String @unique @db.VarChar(10)

  agencyNameZh String @map("agency_name_zh") @db.VarChar(200)

  agencyNameZhShort String? @map("agency_name_zh_short") @db.VarChar(100)

  agencyNameEn String? @map("agency_name_en") @db.VarChar(200)

  agencyNameEnShort String? @map("agency_name_en_short") @db.VarChar(100)

  phone String? @map("phone") @db.VarChar(20)

  fax String? @map("fax") @db.VarChar(20)

  email String? @map("email") @db.VarChar(100)

  country String? @map("country") @db.VarChar(2)

  countryNameZh String? @map("country_name_zh") @db.VarChar(20)

  addressZh String? @map("address_zh") @db.VarChar(200)

  addressEn String? @map("address_en") @db.VarChar(200)

  addressShort String? @map("address_short") @db.VarChar(200)

  contactPerson String? @map("contact_person") @db.VarChar(50)

  contactPhone String? @map("contact_phone") @db.VarChar(20)

  mailingAddressZh String? @map("mailing_address_zh") @db.VarChar(200)

  mailingAddressEn String? @map("mailing_address_en") @db.VarChar(200)

  representativeName String? @map("representative_name") @db.VarChar(50)

  representativeNameEn String? @map("representative_name_en") @db.VarChar(100)

  representativeIdNo String? @map("representative_id_no") @db.VarChar(20)

  representativePassport String? @map("representative_passport") @db.VarChar(20)

  taxId String? @map("tax_id") @db.VarChar(10)

  businessRegistrationNo String? @map("business_registration_no") @db.VarChar(50)

  permitNumber String? @map("permit_number") @db.VarChar(50)

  foreignLicenseNo String? @map("foreign_license_no") @db.VarChar(50)

  foreignLicenseExpiry DateTime? @map("foreign_license_expiry") @db.Date

  molPermitNo String? @map("mol_permit_no") @db.VarChar(20)

  molValidFrom DateTime? @map("mol_valid_from") @db.Date

  molValidTo DateTime? @map("mol_valid_to") @db.Date

  payeeName String? @map("payee_name") @db.VarChar(100)

  bankName String? @map("bank_name") @db.VarChar(100)

  bankAccountNo String? @map("bank_account_no") @db.VarChar(50)

  bankAddress String? @map("bank_address") @db.VarChar(200)

  loanBankCode String? @map("loan_bank_code") @db.VarChar(10)

  isActive Boolean @default(true) @map("is_active")

  notes String? @map("notes") @db.Text

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  // Relations

  bilateralTradeLicenses PartnerAgencyBilateralLicense[]

  contracts PartnerAgencyContract[]

  @@map("partner_agencies")
}

model PartnerAgencyBilateralLicense {
  id String @id @default(uuid()) @db.Uuid

  agencyId String @map("agency_id") @db.Uuid

  agency PartnerAgency @relation(fields: [agencyId], references: [id], onDelete: Cascade)

  licenseNumber String? @map("license_number") @db.VarChar(50)

  validFrom DateTime @map("valid_from") @db.Date

  validTo DateTime @map("valid_to") @db.Date

  status String @default("ACTIVE") @db.VarChar(20)

  notes String? @map("notes") @db.Text

  createdBy String? @map("created_by") @db.Uuid

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@index([agencyId])
  @@index([validTo]) // å¿«éæ¥è©¢å³å°å°æçè¨±å¯è­
  @@index([status])
  @@map("partner_agency_bilateral_licenses")
}

model PartnerAgencyContract {
  id String @id @default(uuid()) @db.Uuid

  agencyId String @map("agency_id") @db.Uuid

  agency PartnerAgency @relation(fields: [agencyId], references: [id], onDelete: Cascade)

  contractNo String @map("contract_no") @db.VarChar(50)

  contractType String? @map("contract_type") @db.VarChar(50)

  signedDate DateTime? @map("signed_date") @db.Date

  validFrom DateTime? @map("valid_from") @db.Date

  validTo DateTime? @map("valid_to") @db.Date

  summary String? @map("summary") @db.Text

  documentPath String? @map("document_path") @db.VarChar(255)

  status String @default("ACTIVE") @db.VarChar(20)

  createdBy String? @map("created_by") @db.Uuid

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@index([agencyId])
  @@index([contractNo])
  @@index([validTo])
  @@map("partner_agency_contracts")
}

model LoanBank {
  id String @id @default(uuid()) @db.Uuid

  code String @unique @db.VarChar(10)

  nameZh String @map("name_zh") @db.VarChar(50)

  nameEn String? @map("name_en") @db.VarChar(100)

  sortOrder Int @default(0) @map("sort_order")

  isActive Boolean @default(true) @map("is_active")

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  @@map("loan_banks")
}

model Employee {
  id String @id @default(uuid()) @db.Uuid

  code String @unique @db.VarChar(18)

  fullName String @map("full_name") @db.VarChar(50)

  fullNameEn String? @map("full_name_en") @db.VarChar(100)

  gender String? @map("gender") @db.VarChar(10)

  nationality String? @map("nationality") @db.VarChar(20)

  dateOfBirth DateTime? @map("date_of_birth") @db.Date

  idNumber String? @map("id_number") @db.VarChar(20)

  departmentCode String? @map("department_code") @db.VarChar(10)

  employeeNumber String? @map("employee_number") @db.VarChar(10)

  jobTitle String? @map("job_title") @db.VarChar(50)

  domesticAgencyId String? @map("domestic_agency_id") @db.Uuid

  domesticAgency DomesticAgency? @relation(fields: [domesticAgencyId], references: [id], onDelete: SetNull)

  phone String? @map("phone") @db.VarChar(30)

  mobilePhone String? @map("mobile_phone") @db.VarChar(30)

  extension String? @map("extension") @db.VarChar(12)

  email String? @map("email") @db.VarChar(100)

  receiveSms Boolean @default(false) @map("receive_sms")

  contactPerson String? @map("contact_person") @db.VarChar(50)

  contactPhone String? @map("contact_phone") @db.VarChar(30)

  mailingAddressZh String? @map("mailing_address_zh") @db.VarChar(200)

  mailingAddressEn String? @map("mailing_address_en") @db.VarChar(200)

  residentialAddressZh String? @map("residential_address_zh") @db.VarChar(200)

  residentialAddressEn String? @map("residential_address_en") @db.VarChar(200)

  emergencyContact String? @map("emergency_contact") @db.VarChar(50)

  emergencyPhone String? @map("emergency_phone") @db.VarChar(30)

  isSales Boolean @default(false) @map("is_sales")

  isAdmin Boolean @default(false) @map("is_admin")

  isCustomerService Boolean @default(false) @map("is_customer_service")

  isAccounting Boolean @default(false) @map("is_accounting")

  isBilingual Boolean @default(false) @map("is_bilingual")

  employerAutoCode String? @map("employer_auto_code") @db.VarChar(10)

  contractCode String? @map("contract_code") @db.VarChar(4)

  contractSeqUsed Int? @default(0) @map("contract_seq_used")

  salesGroupCode String? @map("sales_group_code") @db.VarChar(10)

  expertise String? @map("expertise") @db.VarChar(200)

  // éè¡å¸³æ¶è³è¨

  postalAccountNo String? @map("postal_account_no") @db.VarChar(12) // åæ¥å¸³è (LBR34)

  postalAccountName String? @map("postal_account_name") @db.VarChar(100) // åæ¥æ¶å (LBR35)

  bankName String? @map("bank_name") @db.VarChar(100) // å¯æ¬¾éè¡åç¨± (LBR38)

  bankAccountName String? @map("bank_account_name") @db.VarChar(100) // éè¡å¸³æ¶åç¨± (LBR39)

  bankAccountNo String? @map("bank_account_no") @db.VarChar(20) // å¯æ¬¾éè¡å¸³è (LBR40)

  // å°é¢è·è³è¨

  hireDate DateTime? @map("hire_date") @db.Date // å°è·æ¥ (LBR22)

  insuranceStartDate DateTime? @map("insurance_start_date") @db.Date // å ä¿æ¥ (LBR43)

  resignationDate DateTime? @map("resignation_date") @db.Date // é¢è·æ¥ (LBR23)

  insuranceEndDate DateTime? @map("insurance_end_date") @db.Date // éä¿æ¥ (LBR44)

  // åè¨»

  notes String? @map("notes") @db.Text // åè¨» (LBR32)

  // çæ

  isActive Boolean @default(true) @map("is_active") // æ¯å¦å¨è·

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@index([code])
  @@index([fullName])
  @@index([departmentCode])
  @@index([domesticAgencyId])
  @@index([isActive])
  @@map("employees")
}

model Department {
  id String @id @default(uuid()) @db.Uuid

  code String @unique @db.VarChar(10) // é¨éä»£ç¢¼

  nameZh String @map("name_zh") @db.VarChar(50) // é¨éåç¨±ï¼ä¸­æï¼

  nameEn String? @map("name_en") @db.VarChar(100) // é¨éåç¨±ï¼è±æï¼

  sortOrder Int @default(0) @map("sort_order")

  isActive Boolean @default(true) @map("is_active")

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  @@map("departments")
}

// ==========================================

// Core Models

// ==========================================

model InternalUser {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  username String @unique @db.VarChar(50)

  email String @unique @db.VarChar(255)

  passwordHash String @map("password_hash") @db.VarChar(255)

  role UserRole @default(staff)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Relations (Created By / Updated By)

  createdEmployers Employer[] @relation("EmployerCreatedBy")

  updatedEmployers Employer[] @relation("EmployerUpdatedBy")

  createdWorkers Worker[] @relation("WorkerCreatedBy")

  updatedWorkers Worker[] @relation("WorkerUpdatedBy")

  createdJobOrders JobOrder[] @relation("JobOrderCreatedBy")

  updatedJobOrders JobOrder[] @relation("JobOrderUpdatedBy")

  // ... (Many other relations would be here, omitting for brevity in favor of core logic, 

  // but strictly strictly speaking, Prisma requires inverse relations for all. 

  // To keep schema manageable, I will define the mandatory ones and maybe skip inverse 

  // on Audit fields if not strictly needed for querying USER -> ALL RECORDS they created.)

  // Actually, let's include the key operational ones.

  assignedServices ServiceAssignment[] @relation("ServiceAssignedUser")

  // Comments & Mentions

  comments SystemComment[] @relation("CommentAuthor")

  mentionsReceived CommentMention[] @relation("MentionedUser")

  // CRM Relations

  assignedLeads Lead[] @relation("LeadAssignedUser")

  @@map("internal_users")
}

// ==========================================

// CRM: Sales Pipeline & Lead Management

// ==========================================

model Lead {
  id String @id @default(uuid()) @db.Uuid

  // åºæ¬è³è¨

  companyName String @map("company_name") @db.VarChar(100)

  taxId String? @unique @map("tax_id") @db.VarChar(20)

  // è¯çµ¡è³è¨

  contactPerson String? @map("contact_person") @db.VarChar(50)

  phone String? @db.VarChar(30)

  email String? @db.VarChar(100)

  address String? @db.Text

  // æ¥­åè³è¨

  industry String? @db.VarChar(50) // ç¢æ¥­é¡å¥ (e.g., MANUFACTURING)

  estimatedWorkerCount Int? @map("estimated_worker_count")

  status String @default("NEW") @db.VarChar(20) // NEW, CONTACTED, DISCOVERY, QUOTATION, NEGOTIATION, WON, LOST

  // è¿½è¹¤è³è¨

  source String? @db.VarChar(50) // ä¾æºï¼walk-in, referral, web

  assignedTo String? @map("assigned_to") @db.Uuid

  assignedUser InternalUser? @relation("LeadAssignedUser", fields: [assignedTo], references: [id])

  // æéæ³è¨

  lastContactDate DateTime? @map("last_contact_date") @db.Date

  nextFollowUpDate DateTime? @map("next_follow_up_date") @db.Date

  // è½æ­£è³è¨

  convertedToEmployerId String? @unique @map("converted_to_employer_id") @db.Uuid

  convertedEmployer Employer? @relation("ConvertedFromLead", fields: [convertedToEmployerId], references: [id])

  convertedAt DateTime? @map("converted_at") @db.Timestamptz

  // Relations

  interactions LeadInteraction[]

  // Audit

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Soft Delete

  isDeleted Boolean @default(false) @map("is_deleted")

  deletedAt DateTime? @map("deleted_at")

  @@index([status])
  @@index([assignedTo])
  @@index([industry])
  @@map("leads")
}

model LeadInteraction {
  id String @id @default(uuid()) @db.Uuid

  leadId String @map("lead_id") @db.Uuid

  lead Lead @relation(fields: [leadId], references: [id], onDelete: Cascade)

  type String @db.VarChar(30) // call, meeting, email, quotation_sent

  summary String @db.VarChar(200)

  detailedNotes String? @map("detailed_notes") @db.Text

  outcome String? @db.VarChar(50) // positive, negative, neutral, follow_up_needed

  date DateTime @default(now()) @db.Timestamptz

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  @@index([leadId])
  @@index([date])
  @@map("lead_interactions")
}

model Employer {
  id String @id @default(uuid()) @db.Uuid

  // Business ID
  code String? @unique @db.VarChar(20) // Employer Code
  shortName String? @map("short_name") @db.VarChar(50) // Short Name
  taxId String? @unique @map("tax_id") @db.VarChar(20) // Tax ID (Unified Business No)
  companyName String @map("company_name") @db.VarChar(100) // Company Name
  companyNameEn String? @map("company_name_en") @db.VarChar(100) // Company Name (English)

  // Responsible Person
  responsiblePerson String? @map("responsible_person") @db.VarChar(50) // Responsible Person Name

  address String? @db.Text // Address (Chinese)
  addressEn String? @map("address_en") @db.Text // Address (English)
  invoiceAddress String? @map("invoice_address") @db.Text // Invoice Address

  // Other Addresses
  taxAddress String? @map("tax_address") @db.Text // Tax Address
  healthBillAddress String? @map("health_bill_address") @db.Text // Health Bill Address
  healthBillZip String? @map("health_bill_zip") @db.VarChar(10) // Health Bill Zip

  phoneNumber String? @map("phone_number") @db.VarChar(20) // Phone Number
  mobilePhone String? @map("mobile_phone") @db.VarChar(20) // Mobile Phone
  email String? @db.VarChar(100) // Email

  contactPerson String? @map("contact_person") @db.VarChar(50) // Contact Person
  contactPhone String? @map("contact_phone") @db.VarChar(20) // Contact Phone

  // Internal Management
  referrer String? @db.VarChar(50) // Referrer
  terminateDate DateTime? @map("terminate_date") @db.Date // Termination Date

  // Relations to Details

  corporateInfo CorporateInfo?

  individualInfo IndividualInfo?

  // Relation to Category
  applicationCategoryId String? @map("application_category_id") @db.Uuid

  category ApplicationCategory? @relation(fields: [applicationCategoryId], references: [id])

  // Existing Relations

  recruitmentLetters EmployerRecruitmentLetter[]

  deployments Deployment[]

  permitDocuments PermitDocument[]

  incidents Incident[]

  serviceAssignments ServiceAssignment[]

  jobOrders JobOrder[]

  factories EmployerFactory[]

  createdBy String? @map("created_by") @db.Uuid

  updatedBy String? @map("updated_by") @db.Uuid

  createdByUser InternalUser? @relation("EmployerCreatedBy", fields: [createdBy], references: [id])

  updatedByUser InternalUser? @relation("EmployerUpdatedBy", fields: [updatedBy], references: [id])

  // CRM & Conversion

  // Reverse relation: Employer can be created from Lead conversion

  convertedFromLead Lead? @relation("ConvertedFromLead")

  allocationRate Decimal? @map("allocation_rate") @db.Decimal(5, 4) // Allocation Rate
  complianceStandard String? @map("compliance_standard") @db.VarChar(50) // Compliance Standard
  zeroFeeEffectiveDate DateTime? @map("zero_fee_effective_date") @db.Date // Zero Fee Effective Date
  industryAttributes Json? @map("industry_attributes") // Industry Attributes
  monthlyServiceFee Int @default(1500) @map("monthly_service_fee") // Monthly Service Fee
  remarks String? @db.Text // Remarks

  unitTaxId String? @map("unit_tax_id") @db.VarChar(50) // Unit Tax ID
  houseTaxId String? @map("house_tax_id") @db.VarChar(50) // House Tax ID

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Relations

  laborCounts EmployerLaborCount[]

  industryRecognitions IndustryRecognition[]

  recruitmentProofs RecruitmentProof[]

  officialDocuments OfficialDocument[]

  // Phase 9: Accounting Module Relations
  billingAliases EmployerBillingAlias[]
  receivables    Receivable[]

  // Soft Delete

  isDeleted Boolean @default(false) @map("is_deleted")

  deletedAt DateTime? @map("deleted_at")

  // Quota Cache

  totalQuota Int @default(0) @map("total_quota") // Total Quota

  // Agency Relation

  agencyId String? @map("agency_id") @db.Uuid

  agency AgencyCompany? @relation(fields: [agencyId], references: [id])

  @@map("employers")
}

model EmployerFactory {
  id String @id @default(uuid()) @db.Uuid

  employerId String @map("employer_id") @db.Uuid

  employer Employer @relation(fields: [employerId], references: [id], onDelete: Cascade)

  name String @map("name") @db.VarChar(100) // Factory Name

  factoryRegNo String? @map("factory_reg_no") @db.VarChar(50) // Factory Registration No

  address String? @db.Text // Factory Address
  addressEn String? @map("address_en") @db.Text // Factory Address (English)
  zipCode String? @map("zip_code") @db.VarChar(10) // Zip Code
  city String? @db.VarChar(20) // City
  district String? @db.VarChar(20) // District

  laborCount Int? @default(0) // Domestic Labor Count
  foreignCount Int? @default(0) // Foreign Labor Count

  // Factory Details
  taxId String? @map("tax_id") @db.VarChar(50) // Tax ID
  laborInsuranceNo String? @map("labor_insurance_no") @db.VarChar(50) // Labor Insurance No
  healthInsuranceNo String? @map("health_insurance_no") @db.VarChar(50) // Health Insurance No
  ranking String? @map("ranking") @db.VarChar(20) // Factory Ranking

  createdAt DateTime @default(now()) @map("created_at")

  // Relations

  deployments Deployment[]

  industryRecognitions IndustryRecognition[]

  workers Worker[]

  // Recruitment Letter Relation

  recruitmentLetters EmployerRecruitmentLetter[] @relation("LetterWorkFactory")

  @@map("employer_factories")
}

model EmployerLaborCount {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  employerId String @map("employer_id") @db.Uuid

  year Int

  month Int

  count Int @default(0) // Internal labor count

  employer Employer @relation(fields: [employerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  @@unique([employerId, year, month])
  @@map("employer_labor_counts")
}

model CorporateInfo {
  id String @id @default(uuid()) @db.Uuid

  employerId String @unique @map("employer_id") @db.Uuid

  employer Employer @relation(fields: [employerId], references: [id], onDelete: Cascade)

  factoryRegistrationNo String? @map("factory_registration_no") @db.VarChar(50) // Factory Registration No
  factoryRegistrationId String? @map("factory_registration_id") @db.VarChar(50) // Factory Registration ID
  factoryAddress String? @map("factory_address") @db.Text // Factory Address
  factoryAddressEn String? @map("factory_address_en") @db.Text // Factory Address (English)

  industryType String? @map("industry_type") @db.VarChar(50) // Industry Type
  industryCode String? @map("industry_code") @db.VarChar(20) // Industry Code
  capital Decimal? @db.Decimal(15, 2) // Capital Amount

  laborInsuranceNo String? @map("labor_insurance_no") @db.VarChar(50) // Labor Insurance No
  laborInsuranceId String? @map("labor_insurance_id") @db.VarChar(50) // Labor Insurance ID
  healthInsuranceUnitNo String? @map("health_insurance_unit_no") @db.VarChar(50) // Health Insurance Unit No
  healthInsuranceId String? @map("health_insurance_id") @db.VarChar(50) // Health Insurance ID

  securityFeeAccount String? @map("security_fee_account") @db.VarChar(50) // Security Fee Account
  faxNumber String? @map("fax_number") @db.VarChar(20) // Fax Number

  // Institution Specifics

  institutionCode String? @map("institution_code") @db.VarChar(50) // Institution Code
  bedCount Int? @map("bed_count") // Bed Count

  @@map("corporate_info")
}

model IndividualInfo {
  id String @id @default(uuid()) @db.Uuid

  employerId String @unique @map("employer_id") @db.Uuid

  employer Employer @relation(fields: [employerId], references: [id], onDelete: Cascade)

  responsiblePersonDob DateTime? @map("responsible_person_dob") @db.Date // Responsible Person DOB
  responsiblePersonIdNo String? @map("responsible_person_id_no") @db.VarChar(20) // Responsible Person ID No
  responsiblePersonFather String? @map("responsible_person_father_name") @db.VarChar(50) // Father's Name
  responsiblePersonMother String? @map("responsible_person_mother_name") @db.VarChar(50) // Mother's Name
  responsiblePersonSpouse String? @map("responsible_person_spouse") @db.VarChar(50) // Spouse's Name
  mobilePhone String? @map("mobile_phone") @db.VarChar(20) // Mobile Phone

  // Detailed Individual Info
  englishName String? @map("english_name") @db.VarChar(100) // English Name
  birthPlace String? @map("birth_place") @db.VarChar(50) // Birth Place
  birthPlaceEn String? @map("birth_place_en") @db.VarChar(100) // Birth Place (English)

  // Residence Address
  residenceAddress String? @map("residence_address") @db.Text // Residence Address
  residenceZip String? @map("residence_zip") @db.VarChar(10) // Residence Zip
  residenceCity String? @map("residence_city") @db.VarChar(20) // Residence City
  residenceDistrict String? @map("residence_district") @db.VarChar(20) // Residence District

  idIssueDate DateTime? @map("id_issue_date") @db.Date // ID Issue Date
  idIssuePlace String? @map("id_issue_place") @db.VarChar(50) // ID Issue Place
  idIssueType String? @map("id_issue_type") @db.VarChar(20) // ID Issue Type
  militaryStatus String? @map("military_status") @db.VarChar(20) // Military Status
  militaryStatusEn String? @map("military_status_en") @db.VarChar(50) // Military Status (English)

  // Home Care Specifics
  patientName String? @map("patient_name") @db.VarChar(50) // Patient Name
  patientIdNo String? @map("patient_id_no") @db.VarChar(20) // Patient ID No
  careAddress String? @map("care_address") @db.Text // Care Address
  relationship String? @map("relationship") @db.VarChar(50) // Relationship

  @@map("individual_info")
}

model Worker {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  englishName String @map("english_name") @db.VarChar(100) // English Name
  chineseName String? @map("chinese_name") @db.VarChar(50) // Chinese Name
  photoUrl String? @map("photo_url") @db.VarChar(255) // Photo URL

  dob DateTime @db.Date // Date of Birth

  // [Modified] Nationality (Dynamic)

  nationalityId String? @map("nationality_id") @db.Uuid // Nationality ID

  nationality Nationality? @relation(fields: [nationalityId], references: [id])

  // REMOVED: nationality NationalityType

  category WorkerCategory @default(general) // Worker Category

  gender GenderType? // Gender

  mobilePhone String? @map("mobile_phone") @db.VarChar(50) // Mobile Phone

  foreignAddress String? @map("foreign_address") @db.Text // Foreign Address

  maritalStatus String? @map("marital_status") @db.VarChar(20) // Marital Status

  marriageDate DateTime? @map("marriage_date") @db.Date // Marriage Date

  divorceDate DateTime? @map("divorce_date") @db.Date // Divorce Date

  height Decimal? @db.Decimal(5, 2) // Height

  weight Decimal? @db.Decimal(5, 2) // Weight

  birthPlace String? @map("birth_place") @db.VarChar(100) // Birth Place

  educationLevel String? @map("education_level") @db.VarChar(50) // Education Level

  spouseName String? @map("spouse_name") @db.VarChar(100) // Spouse Name

  overseasContactPhone String? @map("overseas_contact_phone") @db.VarChar(50) // Overseas Contact Phone

  overseasFamilyContact String? @map("overseas_family_contact") @db.VarChar(100) // Overseas Family Contact

  // Social & Emergency

  lineId String? @map("line_id") @db.VarChar(50) // LINE ID

  religion String? @db.VarChar(50) // Religion

  emergencyContactName String? @map("emergency_contact_name") @db.VarChar(50) // Emergency Contact (TW)

  emergencyContactPhone String? @map("emergency_contact_phone") @db.VarChar(50) // Emergency Phone (TW)

  bankAccountNo String? @map("bank_account_no") @db.VarChar(50) // Bank Account No

  bankCode String? @map("bank_code") @db.VarChar(20) // Bank Code

  loanBank String? @map("loan_bank") @db.VarChar(50) // Loan Bank

  loanAmount Decimal? @map("loan_amount") @db.Decimal(10, 2) // Loan Amount

  flightArrivalInfo String? @map("flight_arrival_info") @db.VarChar(100) // Flight Arrival Info

  oneStopServiceSerial String? @map("one_stop_service_serial") @db.VarChar(50) // One-Stop Service Serial

  flightDeparture String? @map("flight_departure") @db.VarChar(20) // Flight Departure

  createdBy String? @map("created_by") @db.Uuid

  updatedBy String? @map("updated_by") @db.Uuid

  createdByUser InternalUser? @relation("WorkerCreatedBy", fields: [createdBy], references: [id])

  updatedByUser InternalUser? @relation("WorkerUpdatedBy", fields: [updatedBy], references: [id])

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Relations

  events WorkerEvent[]

  passports WorkerPassport[]

  arcs WorkerArc[]

  deployments Deployment[]

  healthChecks HealthCheck[]

  incidents Incident[]

  officialDocuments OfficialDocument[]

  serviceAssignments ServiceAssignment[]

  insurances WorkerInsurance[]

  addressHistory WorkerAddressHistory[]

  interviewCandidates InterviewCandidate[]

  payrolls PayrollRecord[]

  // Phase 9: Accounting Module Relations
  receivables Receivable[]

  // Soft Delete

  isDeleted Boolean @default(false) @map("is_deleted")

  deletedAt DateTime? @map("deleted_at")

  // Foreign Agency

  foreignAgencyId String? @map("foreign_agency_id") @db.Uuid

  foreignAgency ForeignAgency? @relation(fields: [foreignAgencyId], references: [id])

  // New Fields for Scheduler

  residencePermitExpiry DateTime? @map("residence_permit_expiry") @db.Date

  passportExpiry DateTime? @map("passport_expiry") @db.Date

  medCheck6moDeadline DateTime? @map("med_check_6mo_deadline") @db.Date

  medCheck18moDeadline DateTime? @map("med_check_18mo_deadline") @db.Date

  medCheck30moDeadline DateTime? @map("med_check_30mo_deadline") @db.Date

  // Dormitory Bed

  bedId String? @unique @map("bed_id") @db.Uuid

  bed DormitoryBed? @relation(fields: [bedId], references: [id])

  EmployerFactory EmployerFactory? @relation(fields: [employerFactoryId], references: [id])

  employerFactoryId String? @db.Uuid

  // Relations

  accommodationHistory WorkerAccommodationHistory[]

  relocationNotifications RelocationNotification[]

  entryFiling EntryFiling?

  medicalExceptions MedicalException[]

  @@map("workers")
}

// Entry Filing

model EntryFiling {
  id String @id @default(uuid()) @db.Uuid

  workerId String @unique @map("worker_id") @db.Uuid

  // Entry Date

  entryDate DateTime @map("entry_date") @db.Date

  flightNo String? @map("flight_no") @db.VarChar(20)

  visaNo String? @map("visa_no") @db.VarChar(50)

  // Entry Report Date

  entryReportDate DateTime? @map("entry_report_date") @db.Date

  entryReportRefNo String? @map("entry_report_ref_no") @db.VarChar(50)

  entryReportStatus String @default("PENDING") @map("entry_report_status") @db.VarChar(20)

  // Initial Exam Date

  initialExamDate DateTime? @map("initial_exam_date") @db.Date

  initialExamHospital String? @map("initial_exam_hospital") @db.VarChar(100)

  initialExamResult String? @map("initial_exam_result") @db.VarChar(20)

  // ARC Application Date

  arcApplyDate DateTime? @map("arc_apply_date") @db.Date

  arcReceiptNo String? @map("arc_receipt_no") @db.VarChar(50)

  arcNo String? @map("arc_no") @db.VarChar(20)

  arcStatus String @default("PENDING") @map("arc_status") @db.VarChar(20)

  // Permit Application Date

  permitApplyDate DateTime? @map("permit_apply_date") @db.Date

  permitReceiptNo String? @map("permit_receipt_no") @db.VarChar(50)

  permitNo String? @map("permit_no") @db.VarChar(50)

  permitStatus String @default("PENDING") @map("permit_status") @db.VarChar(20)

  // Overall Compliance

  overallCompliance String @default("PENDING") @map("overall_compliance") @db.VarChar(20)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  worker Worker @relation(fields: [workerId], references: [id])

  @@index([overallCompliance])
  @@index([entryDate])
  @@map("entry_filings")
}

// Medical Exception

model MedicalException {
  id String @id @default(uuid()) @db.Uuid

  workerId String @map("worker_id") @db.Uuid

  healthCheckId String? @map("health_check_id") @db.Uuid

  // Diagnosis Date

  diagnosisDate DateTime @map("diagnosis_date") @db.Date

  diseaseType String @map("disease_type") @db.VarChar(100)

  description String? @db.Text

  // Health Department Notification

  healthDeptNotified Boolean @default(false) @map("health_dept_notified")

  healthDeptNotifyDate DateTime? @map("health_dept_notify_date") @db.Date

  employerNotified Boolean @default(false) @map("employer_notified")

  employerNotifyDate DateTime? @map("employer_notify_date") @db.Date

  // Treatment Status

  treatmentStatus String @default("PENDING") @map("treatment_status") @db.VarChar(30)

  resolutionDate DateTime? @map("resolution_date") @db.Date

  remarks String? @db.Text

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  worker Worker @relation(fields: [workerId], references: [id])

  healthCheck HealthCheck? @relation(fields: [healthCheckId], references: [id])

  @@index([treatmentStatus])
  @@index([diseaseType])
  @@map("medical_exceptions")
}

model WorkerAccommodationHistory {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  workerId String @map("worker_id") @db.Uuid

  worker Worker @relation(fields: [workerId], references: [id], onDelete: Cascade)

  // Accommodation Details

  address String? @db.Text

  dormitoryBedId String? @map("dormitory_bed_id") @db.Uuid

  dormitoryBed DormitoryBed? @relation(fields: [dormitoryBedId], references: [id])

  // Timeline

  startDate DateTime @map("start_date") @db.Date

  endDate DateTime? @map("end_date") @db.Date

  isCurrent Boolean @default(false) @map("is_current")

  // Audit

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("worker_accommodation_history")
}

model RelocationNotification {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  workerId String @map("worker_id") @db.Uuid

  worker Worker @relation(fields: [workerId], references: [id], onDelete: Cascade)

  // Addresses

  oldAddress String? @map("old_address") @db.Text

  newAddress String? @map("new_address") @db.Text

  // Government Notification Tracking

  notificationType String @default("CHANGE_OF_RESIDENCE") @map("notification_type") // e.g., CHANGE_OF_RESIDENCE (ååé¨/ç§»æ°ç½²)

  // Timeline tracking

  mailingDate DateTime? @map("mailing_date") @db.Date

  filingDate DateTime? @map("filing_date") @db.Date

  // Receipt info (Usually from government response)

  receiptDate DateTime? @map("receipt_date") @db.Date

  receiptNumber String? @map("receipt_number") @db.VarChar(50)

  status String @default("PENDING") @db.VarChar(20) // PENDING, PROCESSING, COMPLETED, REJECTED

  notes String? @db.Text

  createdBy String? @map("created_by") @db.Uuid

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("relocation_notifications")
}

model EmployerRecruitmentLetter {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  employerId String @map("employer_id") @db.Uuid

  // --- 1. Recruitment Letter (Employer Recruitment Letter) ---

  letterNumber String @unique @map("letter_number") @db.VarChar(50) // Recruitment Letter Number (e.g., 123456789)

  issueDate DateTime @map("issue_date") @db.Date // Recruitment Letter Issue Date

  expiryDate DateTime @map("expiry_date") @db.Date // Recruitment Letter Expiry Date

  validUntil DateTime @default(now()) @map("valid_until") @db.Date // Recruitment Letter Valid Until Date (default to current date)

  // --- [Phase 1 New Relations] ---

  industryRecognitionId String? @map("industry_recognition_id") @db.Uuid

  industryRecognition IndustryRecognition? @relation(fields: [industryRecognitionId], references: [id])

  recruitmentProofId String? @map("recruitment_proof_id") @db.Uuid

  recruitmentProof RecruitmentProof? @relation(fields: [recruitmentProofId], references: [id])

  // --- 2. Industrial Bureau ---

  // [DEPRECATED] Use relation industryRecognition instead

  // Industrial Bureau Reference Number (e.g., 123456789)

  industrialBureauRef String? @map("industrial_bureau_ref") @db.VarChar(50) // Industrial Bureau Reference Number

  industrialBureauDate DateTime? @map("industrial_bureau_date") @db.Date // Industrial Bureau Date

  industryTier String? @map("industry_tier") @db.VarChar(10) // Industry Tier (e.g., "B")

  // --- 3. Domestic Recruitment ---

  domesticRecruitmentRef String? @map("domestic_recruitment_ref") @db.VarChar(50) // Domestic Recruitment Reference Number

  domesticRecruitmentDate DateTime? @map("domestic_recruitment_date") @db.Date // Domestic Recruitment Date

  // --- 4. Review Fee ---

  reviewFeeReceiptNo String? @map("review_fee_receipt_no") @db.VarChar(50) // Review Fee Receipt Number

  reviewFeePayDate DateTime? @map("review_fee_pay_date") @db.Date // Review Fee Payment Date

  reviewFeeAmount Int @default(200) @map("review_fee_amount") // Review Fee Amount (default to 200)

  // --- 5. Quota ---

  approvedQuota Int @default(0) @map("approved_quota") // Approved Quota

  usedQuota Int @default(0) @map("used_quota") // Used Quota

  // --- Legacy / Details ---

  submissionDate DateTime? @map("submission_date") @db.Date // Submission Date

  laborMinistryReceiptDate DateTime? @map("labor_ministry_receipt_date") @db.Date // Labor Ministry Receipt Date

  // --- Legacy / Details ---

  issueUnit String? @default("ååé¨") @map("issue_unit") @db.VarChar(50) // Issue Unit

  issueWord String? @default("ååç¼äºå­") @map("issue_word") @db.VarChar(50) // Issue Word

  caseNumber String? @map("case_number") @db.VarChar(50) // Case Number

  // Hierarchy (for split letters)

  parentLetterId String? @map("parent_letter_id") @db.Uuid

  parentLetter EmployerRecruitmentLetter? @relation("LetterHierarchy", fields: [parentLetterId], references: [id])

  childLetters EmployerRecruitmentLetter[] @relation("LetterHierarchy")

  // Work Location & Job Info

  workAddress String? @map("work_address") @db.Text // Work Address

  jobType String? @map("job_type") @db.VarChar(50) // Job Type (e.g., Full-time)

  jobTitle String? @map("job_title") @db.VarChar(100) // Job Title (e.g., Software Engineer)

  industryCode String? @map("industry_code") @db.VarChar(50) // Industry Code 

  // Project / Bureau Info

  projectCode String? @map("project_code") @db.VarChar(50) // Project Code (e.g., x1-03...)

  // industrialBureauRef removed as it is defined above

  // Quota Management - Moved to top

  // Gender Constraints (Legacy support)

  quotaMale Int @default(0) @map("quota_male")

  quotaFemale Int @default(0) @map("quota_female")

  // Project & Attributes

  recruitmentProjectType String? @map("recruitment_project_type") @db.VarChar(100) // Recruitment Project Type (e.g., LBE24)

  applyForRehiringBonus Boolean @default(false) @map("apply_for_rehiring_bonus") // Apply for Rehiring Bonus

  // Industry Link

  industryId String? @map("industry_id") @db.Uuid

  industry Industry? @relation(fields: [industryId], references: [id])

  // Work Address Logic

  workAddressType String? @map("work_address_type") @db.VarChar(50) // FACTORY, COMPANY, FAMILY, OR_APPLICANT

  workAddressFactoryId String? @map("work_address_factory_id") @db.Uuid

  workAddressFactory EmployerFactory? @relation("LetterWorkFactory", fields: [workAddressFactoryId], references: [id])

  // Other Attributes

  recruitmentType String? @map("recruitment_type") @db.VarChar(20) // Recruitment Type (e.g., Temporary/Permanent/Seasonal)

  nationalityId String? @map("nationality_id") @db.Uuid

  nationality Nationality? @relation(fields: [nationalityId], references: [id])

  // REMOVED: nationality     NationalityType?

  canCirculate Boolean @default(true) @map("can_circulate") // Can Circulate

  remarks String? @db.Text // Remarks

  // Relations

  employer Employer @relation(fields: [employerId], references: [id], onDelete: Cascade)

  deployments Deployment[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Soft Delete

  isDeleted Boolean @default(false) @map("is_deleted")

  deletedAt DateTime? @map("deleted_at")

  @@map("employer_recruitment_letters")
}

model WorkerPassport {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  workerId String @map("worker_id") @db.Uuid

  passportNumber String @map("passport_number") @db.VarChar(50)

  issueDate DateTime @map("issue_date") @db.Date

  expiryDate DateTime @map("expiry_date") @db.Date

  issuePlace String? @map("issue_place") @db.VarChar(100)

  isCurrent Boolean @default(false) @map("is_current")

  isVerified Boolean @default(false) @map("is_verified") // Added for verification

  worker Worker @relation(fields: [workerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("worker_passports")
}

model WorkerArc {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  workerId String @map("worker_id") @db.Uuid

  arcNumber String @map("arc_number") @db.VarChar(50)

  issueDate DateTime @map("issue_date") @db.Date

  expiryDate DateTime @map("expiry_date") @db.Date

  isCurrent Boolean @default(false) @map("is_current")

  isVerified Boolean @default(false) @map("is_verified") // Added for verification

  worker Worker @relation(fields: [workerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("worker_arcs")
}

model Deployment {
  billingPlan BillingPlan?

  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  workerId String @map("worker_id") @db.Uuid

  employerId String @map("employer_id") @db.Uuid

  recruitmentLetterId String? @map("recruitment_letter_id") @db.Uuid

  startDate DateTime @map("start_date") @db.Date

  endDate DateTime? @map("end_date") @db.Date

  status DeploymentStatus @default(active)

  serviceStatus ServiceStatus @default(active_service) @map("service_status")

  sourceType ManagementSourceType @default(direct_hiring) @map("source_type")

  jobDescription String? @map("job_description") @db.Text

  entryDate DateTime? @map("entry_date") @db.Date

  // Handover Date

  handoverDate DateTime? @map("handover_date") @db.Date

  entryReportSerial String? @map("entry_report_serial") @db.VarChar(50)

  flightNumber String? @map("flight_number") @db.VarChar(20)

  flightArrivalDate DateTime? @map("flight_arrival_date") @db.Date

  visaLetterNo String? @map("visa_letter_no") @db.VarChar(50)

  jobType String? @map("job_type") @db.VarChar(50)

  shift String? @map("shift") @db.VarChar(50)

  // Overseas Recruitment Workflow Fields

  overseasCheckStatus String? @map("overseas_check_status") @db.VarChar(20)

  overseasCheckDate DateTime? @map("overseas_check_date") @db.Date

  // Dynamic Contract Type

  contractTypeId String? @map("contract_type_id") @db.Uuid

  contractType ContractType? @relation(fields: [contractTypeId], references: [id])

  // Dynamic Termination Reason

  contractEndReasonId String? @map("contract_end_reason_id") @db.Uuid

  contractEndReason ContractEndReason? @relation(fields: [contractEndReasonId], references: [id])

  docVerificationStatus String? @map("doc_verification_status") @db.VarChar(20)

  docSubmissionDate DateTime? @map("doc_submission_date") @db.Date

  docVerifiedDate DateTime? @map("doc_verified_date") @db.Date

  visaStatus String? @map("visa_status") @db.VarChar(20)

  visaApplicationDate DateTime? @map("visa_application_date") @db.Date

  visaNumber String? @map("visa_number") @db.VarChar(50)

  // Termination Information

  terminationReason String? @map("termination_reason") @db.VarChar(50)

  terminationNotes String? @map("termination_notes") @db.Text

  // Contract / Salary Info

  basicSalary Decimal? @map("basic_salary") @db.Decimal(10, 2)

  foodAmount Decimal? @map("food_amount") @db.Decimal(10, 2)

  foodStatus String? @map("food_status") @db.VarChar(50)

  // Specific Factory Location

  factoryId String? @map("factory_id") @db.Uuid

  factory EmployerFactory? @relation(fields: [factoryId], references: [id])

  worker Worker @relation(fields: [workerId], references: [id])

  employer Employer @relation(fields: [employerId], references: [id])

  recruitmentLetter EmployerRecruitmentLetter? @relation(fields: [recruitmentLetterId], references: [id])

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Relations

  healthChecks HealthCheck[]

  permitDetails WorkerPermitDetail[]

  insurances WorkerInsurance[]

  runawayRecords RunawayRecord[]

  // Soft Delete

  isDeleted Boolean @default(false) @map("is_deleted")

  deletedAt DateTime? @map("deleted_at")

  @@map("deployments")
}

model RunawayRecord {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  deploymentId String @map("deployment_id") @db.Uuid
  deployment Deployment @relation(fields: [deploymentId], references: [id], onDelete: Cascade)

  missingDate DateTime @map("missing_date") @db.Date // 失聯日期
  reportDate DateTime @default(now()) @map("report_date") @db.Date // 系統記錄日期

  // Government Notification
  notificationDate DateTime? @map("notification_date") @db.Date // 通報主管機關日期
  notificationNumber String? @map("notification_number") @db.VarChar(50) // 通報序號

  status RunawayStatus @default(reported_internally)

  // 3-day logic
  threeDayCountdownStart DateTime? @map("three_day_countdown_start") @db.Date // Usually same as missingDate
  
  // Quota Impact
  isQuotaFrozen Boolean @default(false) @map("is_quota_frozen")

  notes String? @db.Text

  createdBy String? @map("created_by") @db.Uuid
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("runaway_records")
}

// ==========================================

// [Phase 1] Pre-Permit / Component Documents

// ==========================================

model IndustryRecognition {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  employerId String @map("employer_id") @db.Uuid

  factoryId String? @map("factory_id") @db.Uuid // Optional: link to specific factory if multi-site

  bureauRefNumber String @unique @map("bureau_ref_number") @db.VarChar(50) // Bureau Reference Number

  issueDate DateTime @map("issue_date") @db.Date // Issue Date

  // Tier Management

  tier String @map("tier") @db.VarChar(10) // A+, A, B, C, D

  expiryDate DateTime? @map("expiry_date") @db.Date // Expiry Date (usually 3 years?)

  allocationRate Decimal? @map("allocation_rate") @db.Decimal(5, 2) // e.g. 0.20

  extraRate Decimal? @default(0) @map("extra_rate") @db.Decimal(5, 2) // Extra Quota Rate (e.g. 0.20)

  fileUrl String? @map("file_url") @db.Text

  // Stats

  approvedQuota Int @default(0) @map("approved_quota")

  usedQuota Int @default(0) @map("used_quota")

  employer Employer @relation(fields: [employerId], references: [id], onDelete: Cascade)

  employerFactory EmployerFactory? @relation(fields: [factoryId], references: [id])

  // Relations

  recruitmentLetters EmployerRecruitmentLetter[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Soft Delete

  isDeleted Boolean @default(false) @map("is_deleted")

  deletedAt DateTime? @map("deleted_at")

  @@map("industry_recognitions")
}

model RecruitmentProof {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  employerId String @map("employer_id") @db.Uuid

  receiptNumber String @unique @map("receipt_number") @db.VarChar(50) // Receipt Number

  registerDate DateTime @map("register_date") @db.Date // Register Date

  issueDate DateTime @map("issue_date") @db.Date // Issue Date

  jobCenter String? @map("job_center") @db.VarChar(50) // Job Center

  status String @default("VALID") @db.VarChar(20) // VALID, EXPIRED, USED

  // Fees

  reviewFeeReceiptNo String? @map("review_fee_receipt_no") @db.VarChar(50) // Review Fee Receipt Number

  reviewFeePayDate DateTime? @map("review_fee_pay_date") @db.Date

  employer Employer @relation(fields: [employerId], references: [id], onDelete: Cascade)

  // Relations

  recruitmentLetters EmployerRecruitmentLetter[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("recruitment_proofs")
}

model PermitDocument {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  employerId String @map("employer_id") @db.Uuid

  permitNumber String @unique @map("permit_number") @db.VarChar(50)

  issueDate DateTime @map("issue_date") @db.Date

  issuingAuthority String? @map("issuing_authority") @db.VarChar(100)

  employer Employer @relation(fields: [employerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Relations

  workerPermitDetails WorkerPermitDetail[]

  @@map("permit_documents")
}

model WorkerPermitDetail {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  permitDocumentId String @map("permit_document_id") @db.Uuid

  deploymentId String @map("deployment_id") @db.Uuid

  permitType PermitType @map("permit_type")

  startDate DateTime @map("start_date") @db.Date

  endDate DateTime @map("end_date") @db.Date

  permitDocument PermitDocument @relation(fields: [permitDocumentId], references: [id], onDelete: Cascade)

  deployment Deployment @relation(fields: [deploymentId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("worker_permit_details")
}

model HealthCheck {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  workerId String @map("worker_id") @db.Uuid

  deploymentId String @map("deployment_id") @db.Uuid

  checkType HealthCheckType @map("check_type")

  checkDate DateTime @map("check_date") @db.Date

  hospitalName String? @map("hospital_name") @db.VarChar(100)

  result HealthCheckResult @default(pending)

  reportDate DateTime? @map("report_date") @db.Date

  failReason String? @map("fail_reason") @db.Text

  worker Worker @relation(fields: [workerId], references: [id], onDelete: Cascade)

  deployment Deployment @relation(fields: [deploymentId], references: [id], onDelete: Cascade)

  medicalExceptions MedicalException[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("health_checks")
}

model Incident {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  workerId String? @map("worker_id") @db.Uuid

  employerId String? @map("employer_id") @db.Uuid

  description String @db.Text

  severityLevel IncidentSeverity @map("severity_level")

  status IncidentStatus @default(open)

  incidentDate DateTime @default(now()) @map("incident_date") @db.Timestamptz

  isAutoGenerated Boolean @default(false) @map("is_auto_generated")

  sourceRefId String? @map("source_ref_id") @db.Uuid

  category String? @map("category") @db.VarChar(50)

  worker Worker? @relation(fields: [workerId], references: [id])

  employer Employer? @relation(fields: [employerId], references: [id])

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("incidents")
}

model ServiceAssignment {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  employerId String? @map("employer_id") @db.Uuid

  workerId String? @map("worker_id") @db.Uuid

  internalUserId String @map("internal_user_id") @db.Uuid

  role StaffRoleType

  startDate DateTime @default(now()) @map("start_date") @db.Date

  endDate DateTime? @map("end_date") @db.Date

  notes String? @db.Text

  employer Employer? @relation(fields: [employerId], references: [id], onDelete: Cascade)

  worker Worker? @relation(fields: [workerId], references: [id], onDelete: Cascade)

  internalUser InternalUser @relation("ServiceAssignedUser", fields: [internalUserId], references: [id])

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  @@map("service_assignments")
}

model WorkerInsurance {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  workerId String @map("worker_id") @db.Uuid

  deploymentId String? @map("deployment_id") @db.Uuid

  type InsuranceType

  providerName String? @map("provider_name") @db.VarChar(50)

  policyNumber String? @map("policy_number") @db.VarChar(50)

  insuredAmount Decimal? @map("insured_amount") @db.Decimal(10, 2)

  startDate DateTime @map("start_date") @db.Date

  endDate DateTime? @map("end_date") @db.Date

  worker Worker @relation(fields: [workerId], references: [id], onDelete: Cascade)

  deployment Deployment? @relation(fields: [deploymentId], references: [id])

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("worker_insurances")
}

model WorkerAddressHistory {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  workerId String @map("worker_id") @db.Uuid

  addressType AddressType @map("address_type")

  addressDetail String @map("address_detail") @db.Text

  startDate DateTime @map("start_date") @db.Date

  endDate DateTime? @map("end_date") @db.Date

  worker Worker @relation(fields: [workerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  @@map("worker_address_history")
}

model JobOrder {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  employerId String @map("employer_id") @db.Uuid

  // Basic Info (Added for Phase 0.2)

  title String @default("General Worker") @db.VarChar(200)

  description String? @db.Text

  skillRequirements String? @map("skill_requirements") @db.Text

  workLocation String? @map("work_location") @db.VarChar(200)

  jobType String? @map("job_type") @db.VarChar(100)

  requiredCount Int @default(1) @map("required_count")

  // Legacy/Other Fields

  orderDate DateTime @default(now()) @map("order_date") @db.Date

  requiredWorkers Int @default(1) @map("required_workers")

  expectedArrivalDate DateTime? @map("expected_arrival_date") @db.Date

  localRecruitmentDeadline DateTime? @map("local_recruitment_deadline") @db.Date

  status JobOrderStatus @default(open)

  jobCenter String? @map("job_center") @db.VarChar(100)

  nationalityPreference String? @map("nationality_preference") @db.VarChar(50) // Nationality Preference (e.g., "VN,PH,ID")

  genderPreference GenderType? @map("gender_preference") // Gender Preference

  filledCount Int @default(0) @map("filled_count") // Filled Count

  employer Employer @relation(fields: [employerId], references: [id], onDelete: Cascade)

  createdBy String? @map("created_by") @db.Uuid

  updatedBy String? @map("updated_by") @db.Uuid

  createdByUser InternalUser? @relation("JobOrderCreatedBy", fields: [createdBy], references: [id])

  updatedByUser InternalUser? @relation("JobOrderUpdatedBy", fields: [updatedBy], references: [id])

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Relations

  interviews Interview[]

  // Soft Delete

  isDeleted Boolean @default(false) @map("is_deleted")

  deletedAt DateTime? @map("deleted_at")

  @@map("job_orders")
}

model WorkerEvent {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  workerId String @map("worker_id") @db.Uuid

  eventType WorkerEventType @map("event_type")

  eventDate DateTime? @map("event_date") @db.Date // Event Date

  reportDate DateTime? @map("report_date") @db.Date // Report Date

  bureauRefNumber String? @map("bureau_ref_number") @db.VarChar(50) // Bureau Reference Number

  bureauRefDate DateTime? @map("bureau_ref_date") @db.Date // Bureau Reference Date

  notes String? @db.Text

  fileUrl String? @map("file_url") @db.Text

  worker Worker @relation(fields: [workerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("worker_events")
}

model Interview {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  jobOrderId String @map("job_order_id") @db.Uuid

  interviewDate DateTime @map("interview_date") @db.Timestamptz

  location String? @db.Text

  interviewer String? @db.VarChar(100)

  jobOrder JobOrder @relation(fields: [jobOrderId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Relations

  candidates InterviewCandidate[]

  @@map("interviews")
}

model InterviewCandidate {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  interviewId String @map("interview_id") @db.Uuid

  // Link to Candidate OR Worker

  candidateId String? @map("candidate_id") @db.Uuid

  workerId String? @map("worker_id") @db.Uuid

  result CandidateResult @default(pending)

  remarks String? @db.Text

  interview Interview @relation(fields: [interviewId], references: [id], onDelete: Cascade)

  candidate Candidate? @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  worker Worker? @relation(fields: [workerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@unique([interviewId, workerId])
  @@map("interview_candidates")
}

model Attachment {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  refId String @map("ref_id") @db.Uuid

  refTable String @map("ref_table") @db.VarChar(50)

  filePath String @map("file_path") @db.Text

  fileName String @map("file_name") @db.VarChar(255)

  fileType String? @map("file_type") @db.VarChar(100)

  uploaderId String? @map("uploader_id") @db.Uuid

  uploadedAt DateTime @default(now()) @map("uploaded_at") @db.Timestamptz

  @@index([refTable, refId])
  @@map("attachments")
}

model Hospital {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  code String? @unique @db.VarChar(50)

  name String @db.VarChar(255)

  shortName String? @map("short_name") @db.VarChar(50)

  address String? @db.Text

  city String? @db.VarChar(50)

  country String? @db.VarChar(50)

  validUntil DateTime? @map("valid_until") @db.Date

  // Contact Info

  phone String? @db.VarChar(50) // LBB07

  fax String? @db.VarChar(50) // LBB10

  contactPerson String? @map("contact_person") @db.VarChar(50) // LBB09

  // Legacy / Config

  assessmentCode String? @map("assessment_code") @db.VarChar(50) // LBB11

  sortOrder Int @default(999) @map("sort_order") // LBB12

  isGeneral Boolean @default(false) @map("is_general")

  isXray Boolean @default(false) @map("is_xray")

  isOverseas Boolean @default(false) @map("is_overseas")

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("hospitals")
}

// Tax Configuration (Annual Parameters)

model TaxConfig {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  year Int @unique

  minWage Int @map("min_wage")

  minWageThresholdMultiplier Float @default(1.5) @map("min_wage_threshold_multiplier")

  standardDeduction Int @map("standard_deduction")

  salaryDeduction Int @map("salary_deduction")

  personalExemption Int @map("personal_exemption")

  taxRateResident Float @map("tax_rate_resident")

  nonResidentLowRate Float @map("non_resident_low_rate")

  nonResidentHighRate Float @map("non_resident_high_rate")

  effectiveDate DateTime @map("effective_date") @db.Date

  notes String? @db.Text

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("tax_configs")
}

model IncomeTaxCategory {
  id String @id @default(uuid()) @db.Uuid

  code String @unique @db.VarChar(10) // e.g., "50", "9A"

  name String @db.VarChar(100) // e.g., "Income Tax"

  nameEn String? @map("name_en") @db.VarChar(100)

  // Tax Rates

  taxRateNonResident Decimal @default(0) @map("tax_rate_non_resident") @db.Decimal(5, 2) // e.g., 20.00

  description String? @db.Text

  sortOrder Int @default(0) @map("sort_order")

  isActive Boolean @default(true) @map("is_active")

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@map("income_tax_categories")
}

// Fee Items (Official Fees by Nationality)

model ReceivableItem {
  id String @id @default(uuid()) @db.Uuid

  code String @unique @db.VarChar(20) // LAA01: Item Code

  // Names (Multi-language)

  nameZh String @map("name_zh") @db.VarChar(100) // LAA02
  nameEn String @map("name_en") @db.VarChar(100) // LAA02_2
  nameTh String? @map("name_th") @db.VarChar(100) // LAA02_1
  nameId String? @map("name_id") @db.VarChar(100) // LAA02_3
  nameVn String? @map("name_vn") @db.VarChar(100) // LAA02_4

  // Accounting Settings

  debitAccountCode String? @map("debit_account_code") @db.VarChar(50) // LAA12
  creditAccountCode String? @map("credit_account_code") @db.VarChar(50) // LAA16

  // Type & Config

  itemCategory String? @map("item_category") @db.VarChar(50) // LAA13 (e.g., "flight", "medical", "service_fee")
  isDailyCalculation Boolean @default(false) @map("is_daily_calculation") // LAA14
  isActive Boolean @default(true) @map("is_active") // LAA15

  // Relations

  pricingRules ReceivablePricingRule[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("receivable_items")
}

model ReceivablePricingRule {
  id String @id @default(uuid()) @db.Uuid

  itemId String @map("item_id") @db.Uuid

  item ReceivableItem @relation(fields: [itemId], references: [id], onDelete: Cascade)

  nationalityId String? @map("nationality_id") @db.Uuid

  nationality Nationality? @relation(fields: [nationalityId], references: [id])

  gender GenderType? // Enum: male, female

  employerId String? @map("employer_id") @db.Uuid // Special price for specific employer

  // Tenure-based pricing (e.g., Year 1 vs Year 2 service fee)

  minTenureMonths Int? @map("min_tenure_months") // e.g., 1 (Month 1-12)
  maxTenureMonths Int? @map("max_tenure_months") // e.g., 12

  amount Decimal @db.Decimal(10, 2)

  description String? @db.Text // Internal note for this rule

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Indexes for fast lookup

  @@index([itemId])
  @@index([employerId])
  @@map("receivable_pricing_rules")
}

// Insurance Tiers (Labor + Health Insurance Rates by Salary Grade)

model InsuranceTier {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  grade Int @unique

  minSalary Int @map("min_salary")

  maxSalary Int @map("max_salary")

  laborFee Int @map("labor_fee")

  healthFee Int @map("health_fee")

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("insurance_tiers")
}

// ==========================================

// Document System (Dynamic & Multi-language)

// ==========================================

model Nationality {
  id String @id @default(uuid()) @db.Uuid

  code String @unique @db.VarChar(10) // e.g., "PH", "VN", "TH"

  name String @db.VarChar(100) // Local Name (e.g., "Philippines")

  nameZh String @map("name_zh") @db.VarChar(100) // "菲律賓"

  nameEn String? @map("name_en") @db.VarChar(100)

  countryCode String? @map("country_code") @db.VarChar(3) // ISO Code

  sortOrder Int @default(0) @map("sort_order")

  isActive Boolean @default(true) @map("is_active")

  // Relations

  workers Worker[]

  templates DocumentTemplate[]

  pricingRules ReceivablePricingRule[]

  recruitmentLetters EmployerRecruitmentLetter[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@map("nationalities")
}

model DocumentRequirement {
  id String @id @default(uuid()) @db.Uuid

  code String @unique @db.VarChar(50) // e.g., "LABOR_CONTRACT"

  name String @db.VarChar(100) // e.g., "Labor Contract"

  category String? @db.VarChar(50) // e.g., "Entry", "Medical"

  isRequired Boolean @default(false) @map("is_required")

  templates DocumentTemplate[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@map("document_requirements")
}

// Document Templates (Physical Files)

model DocumentTemplate {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  name String @db.VarChar(255) // Specific version name e.g. "Labor Contract (Thai)"

  filePath String @map("file_path") @db.Text

  fileFormat String? @map("file_format") @db.VarChar(20) // docx, xlsx, odt, pdf

  mimeType String? @map("mime_type") @db.VarChar(100)

  originalName String? @map("original_name") @db.VarChar(255)

  // Placeholder è¨­å® (JSON æ ¼å¼å²å­æ¬ä½å°æ)

  placeholderSchema Json? @map("placeholder_schema")

  // Links

  documentRequirementId String? @map("document_requirement_id") @db.Uuid

  documentRequirement DocumentRequirement? @relation(fields: [documentRequirementId], references: [id])

  nationalityId String? @map("nationality_id") @db.Uuid

  nationality Nationality? @relation(fields: [nationalityId], references: [id])

  language String? @db.VarChar(20) // e.g., "zh-TW", "en", "th"

  version String? @db.VarChar(20) // e.g., "v1.0"

  isActive Boolean @default(true) @map("is_active")

  description String? @db.Text

  category String? @db.VarChar(50)

  isTested Boolean @default(false) @map("is_tested")

  testedAt DateTime? @map("tested_at") @db.Timestamptz

  testedBy String? @map("tested_by") @db.Uuid

  activatedAt DateTime? @map("activated_at") @db.Timestamptz

  activatedBy String? @map("activated_by") @db.Uuid

  // Relations

  generatedDocuments GeneratedDocument[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("document_templates")
}

model GeneratedDocument {
  id String @id @default(uuid()) @db.Uuid

  templateId String @map("template_id") @db.Uuid

  template DocumentTemplate @relation(fields: [templateId], references: [id])

  workerId String? @map("worker_id") @db.Uuid

  employerId String? @map("employer_id") @db.Uuid

  fileName String @map("file_name") @db.VarChar(255)

  filePath String @map("file_path") @db.Text

  fileSize Int? @map("file_size")

  status String @default("SUCCESS") @db.VarChar(20) // SUCCESS, FAILED

  errorMessage String? @map("error_message") @db.Text

  generatedAt DateTime @default(now()) @map("generated_at") @db.Timestamptz

  generatedBy String? @map("generated_by") @db.Uuid

  @@index([workerId])
  @@index([employerId])
  @@index([templateId])
  @@map("generated_documents")
}

model AgencyCompany {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  name String @db.VarChar(100)

  licenseNo String? @map("license_no") @db.VarChar(50)

  taxId String? @map("tax_id") @db.VarChar(20)

  address String? @db.Text

  phone String? @db.VarChar(20)

  fax String? @db.VarChar(20)

  email String? @db.VarChar(100)

  responsiblePerson String? @map("responsible_person") @db.VarChar(50)

  isDefault Boolean @default(false) @map("is_default")

  employers Employer[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("agency_companies")
}

model ForeignAgency {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  name String @db.VarChar(100)

  code String? @db.VarChar(50)

  address String? @db.Text

  country String? @db.VarChar(50)

  workers Worker[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("foreign_agencies")
}

model PayrollRecord {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  workerId String @map("worker_id") @db.Uuid

  worker Worker @relation(fields: [workerId], references: [id], onDelete: Cascade)

  payDate DateTime @map("pay_date") @db.Date

  salaryAmount Decimal @map("salary_amount") @db.Decimal(10, 2)

  bonusAmount Decimal @map("bonus_amount") @db.Decimal(10, 2)

  taxWithheld Decimal @map("tax_withheld") @db.Decimal(10, 2)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("payroll_records")
}

model Dormitory {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  name String @db.VarChar(100)

  address String? @db.Text

  landlordName String? @map("landlord_name") @db.VarChar(50)

  accommodationType String? @map("accommodation_type") @db.VarChar(50)

  rentFee Int @default(0) @map("rent_fee")

  managementFee Int @default(0) @map("management_fee")

  totalArea Decimal? @map("total_area") @db.Decimal(10, 2)

  capacity Int? @default(0)

  bathroomCount Int? @default(0) @map("bathroom_count")

  waterHeaterCount Int? @default(0) @map("water_heater_count")

  hasFireExtinguisher Boolean @default(false) @map("has_fire_extinguisher")

  hasFireAlarm Boolean @default(false) @map("has_fire_alarm")

  fireSafetyExpiry DateTime? @map("fire_safety_expiry") @db.Date

  rooms DormitoryRoom[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("dormitories")
}

model DormitoryRoom {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  dormitoryId String @map("dormitory_id") @db.Uuid

  roomNumber String @map("room_number") @db.VarChar(20)

  capacity Int @default(0)

  area Decimal? @db.Decimal(10, 2) // Added for compliance checks

  dormitory Dormitory @relation(fields: [dormitoryId], references: [id], onDelete: Cascade)

  beds DormitoryBed[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("dormitory_rooms")
}

model DormitoryBed {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  roomId String @map("room_id") @db.Uuid

  bedCode String @map("bed_code") @db.VarChar(20)

  isOccupied Boolean @default(false) @map("is_occupied")

  room DormitoryRoom @relation(fields: [roomId], references: [id], onDelete: Cascade)

  worker Worker?

  accommodationHistory WorkerAccommodationHistory[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("dormitory_beds")
}

model ComplianceRule {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  code String @unique @db.VarChar(50)

  value String @db.VarChar(255)

  category String @db.VarChar(50)

  description String? @db.Text

  effectiveDate DateTime @default(now()) @map("effective_date") @db.Date

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("compliance_rules")
}

model OfficialAgency {
  id String @id @default(uuid()) @db.Uuid

  code String @unique @db.VarChar(50) // e.g., "MOL", "NIA"

  name String @db.VarChar(100) // e.g., "Ministry of Labor"

  nameEn String? @map("name_en") @db.VarChar(100)

  address String? @db.Text

  phone String? @db.VarChar(50)

  website String? @db.VarChar(200)

  isActive Boolean @default(true) @map("is_active")

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  // Relations

  personnel OfficialAgencyPerson[]

  @@map("official_agencies")
}

model OfficialAgencyPerson {
  id String @id @default(uuid()) @db.Uuid

  agencyId String @map("agency_id") @db.Uuid

  agency OfficialAgency @relation(fields: [agencyId], references: [id], onDelete: Cascade)

  // Personal Info

  name String @db.VarChar(50)

  nameEn String? @map("name_en") @db.VarChar(100)

  title String? @db.VarChar(100) // e.g., "Minister", "Director"

  titleEn String? @map("title_en") @db.VarChar(100)

  // Tenure & Status

  startDate DateTime? @map("start_date") @db.Date

  endDate DateTime? @map("end_date") @db.Date

  isActing Boolean @default(false) @map("is_acting")

  actingNotes String? @map("acting_notes") @db.Text

  sortOrder Int @default(0) @map("sort_order")

  isActive Boolean @default(true) @map("is_active")

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@map("official_agency_personnel")
}

model ContractEndReason {
  id String @id @default(uuid()) @db.Uuid

  code String @unique @db.VarChar(50) // e.g., "HAA", "HEE"

  name String @db.VarChar(100) // e.g., "合約到期"

  nameEn String? @map("name_en") @db.VarChar(100)

  description String? @db.Text

  isAbnormal Boolean @default(false) @map("is_abnormal")

  category String? @db.VarChar(50)

  sortOrder Int @default(0) @map("sort_order")

  isActive Boolean @default(true) @map("is_active")

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  // Relations

  deployments Deployment[]

  @@map("contract_end_reasons")
}

model OfficialDocument {
  id String @id @default(uuid()) @db.Uuid

  employerId String @map("employer_id") @db.Uuid

  employer Employer @relation(fields: [employerId], references: [id], onDelete: Cascade)

  // Optional: Link to a specific worker (e.g., Runaway letter for Worker A)

  workerId String? @map("worker_id") @db.Uuid

  worker Worker? @relation(fields: [workerId], references: [id])

  documentType String @map("document_type") @db.VarChar(50)

  docNumber String @map("doc_number") @db.VarChar(50)

  issueDate DateTime @map("issue_date") @db.Date 

  expiryDate DateTime? @map("expiry_date") @db.Date 

  issuingAgency String? @map("issuing_agency") @db.VarChar(100)

  title String? @db.VarChar(200)

  description String? @db.Text

  filePath String? @map("file_path") @db.Text

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@index([employerId])
  @@index([workerId])
  @@index([docNumber])
  @@map("official_documents")
}

// ==========================================
// Phase 7: Collaboration & Alert System (Models)
// ==========================================

// Note: Enums CommentEntityType, AlertSeverity, AlertStatus are defined earlier (~line 1000)

// 系統留言 (7.1)
model SystemComment {
  id String @id @default(uuid()) @db.Uuid

  // 關聯實體
  entityType CommentEntityType @map("entity_type")
  entityId   String            @map("entity_id") @db.Uuid

  // 內容
  content String @db.Text

  // 作者
  authorId String       @map("author_id") @db.Uuid
  author   InternalUser @relation("CommentAuthor", fields: [authorId], references: [id])

  // 軟刪除
  isDeleted Boolean @default(false) @map("is_deleted")

  // 關聯
  mentions CommentMention[]

  // 時間戳記
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@index([entityType, entityId])
  @@index([authorId])
  @@map("system_comments")
}

// 留言提及 (@Mentions)
model CommentMention {
  id String @id @default(uuid()) @db.Uuid

  commentId String @map("comment_id") @db.Uuid
  userId    String @map("user_id") @db.Uuid

  // 是否已讀
  isRead Boolean   @default(false) @map("is_read")
  readAt DateTime? @map("read_at") @db.Timestamptz

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  comment SystemComment @relation(fields: [commentId], references: [id], onDelete: Cascade)
  user    InternalUser  @relation("MentionedUser", fields: [userId], references: [id])

  @@unique([commentId, userId])
  @@index([userId, isRead])
  @@map("comment_mentions")
}

// 智慧異常警示 (7.2)
model SystemAlert {
  id String @id @default(uuid()) @db.Uuid

  // 關聯實體
  entityType CommentEntityType @map("entity_type")
  entityId   String            @map("entity_id") @db.Uuid

  // 警示內容
  severity    AlertSeverity
  title       String        @db.VarChar(100)
  description String?       @db.Text

  // 到期/逾期資訊
  dueDate   DateTime? @map("due_date") @db.Date
  alertType String    @map("alert_type") @db.VarChar(50) // e.g., "ARC_EXPIRY", "HEALTH_CHECK", "ENTRY_REPORT"

  // 狀態
  status         AlertStatus @default(OPEN)
  acknowledgedBy String?     @map("acknowledged_by") @db.Uuid
  acknowledgedAt DateTime?   @map("acknowledged_at") @db.Timestamptz
  resolvedAt     DateTime?   @map("resolved_at") @db.Timestamptz

  // 時間戳記
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@index([severity, status])
  @@index([entityType, entityId])
  @@index([dueDate])
  @@map("system_alerts")
}

// 求職者資料庫 (Candidate Pool)
model Candidate {
  id String @id @default(uuid()) @db.Uuid

  // 基本資料
  nameZh      String?     @map("name_zh") @db.VarChar(100)
  nameEn      String?     @map("name_en") @db.VarChar(100)
  gender      GenderType?
  birthDate   DateTime?   @map("birth_date") @db.Date
  nationality String      @default("IDN") @db.VarChar(3)

  // 護照
  passportNo     String?   @unique @map("passport_no") @db.VarChar(20)
  passportExpiry DateTime? @map("passport_expiry") @db.Date

  // 身材與狀態
  height        Int?
  weight        Int?
  maritalStatus String? @map("marital_status") @db.VarChar(20)
  education     String? @db.VarChar(50)
  skills        String? @db.Text

  status String @default("NEW") @db.VarChar(20)

  createdAt          DateTime             @default(now()) @map("created_at") @db.Timestamptz
  updatedAt          DateTime             @updatedAt @map("updated_at") @db.Timestamptz
  InterviewCandidate InterviewCandidate[]

  @@map("candidates")
}

// ==========================================
// Phase 8: Dynamic Billing Engine
// ==========================================

enum BillingItemCategory {
  SERVICE_FEE
  ARC_FEE
  HEALTH_CHECK_FEE
  DORMITORY_FEE
  MEDICAL_FEE
  INSURANCE_FEE
  AIRPORT_PICKUP
  TRAINING_FEE
  PLACEMENT_FEE
  STABILIZATION_FEE
  ADMIN_FEE
  OTHER_FEE

  @@map("billing_item_category")
}

enum BillingPlanStatus {
  PENDING
  CONFIRMED
  ACTIVE
  COMPLETED
  CANCELLED

  @@map("billing_plan_status")
}

enum BillingReviewStatus {
  NORMAL
  NEEDS_REVIEW
  FLAGGED

  @@map("billing_review_status")
}

enum BillingItemStatus {
  GENERATED
  CONFIRMED
  INVOICED
  PAID
  WAIVED
  CANCELLED

  @@map("billing_item_status")
}

enum BillToParty {
  WORKER
  EMPLOYER
  AGENCY

  @@map("bill_to_party")
}

model BillingTemplate {
  id                      String                @id @default(uuid()) @db.Uuid
  name                    String                @db.VarChar(100)
  nameEn                  String?               @map("name_en") @db.VarChar(100)
  description             String?               @db.Text
  applicableCategories    String[]              @map("applicable_categories")
  applicableNationalities String[]              @default([]) @map("applicable_nationalities")
  isActive                Boolean               @default(true) @map("is_active")
  isDefault               Boolean               @default(false) @map("is_default")
  version                 Int                   @default(1)
  effectiveFrom           DateTime?             @map("effective_from") @db.Date
  effectiveTo             DateTime?             @map("effective_to") @db.Date
  items                   BillingTemplateItem[]
  createdAt               DateTime              @default(now()) @map("created_at") @db.Timestamptz
  updatedAt               DateTime              @updatedAt @map("updated_at") @db.Timestamptz
  createdBy               String?               @map("created_by") @db.Uuid

  @@index([isActive, isDefault])
  @@index([effectiveFrom, effectiveTo])
  @@map("billing_templates")
}

model BillingTemplateItem {
  id            String              @id @default(uuid()) @db.Uuid
  templateId    String              @map("template_id") @db.Uuid
  name          String              @db.VarChar(100)
  nameEn        String?             @map("name_en") @db.VarChar(100)
  category      BillingItemCategory
  baseAmount    Decimal             @map("base_amount") @db.Decimal(10, 2)
  logicConfig   Json?               @map("logic_config")
  conditions    Json?
  defaultBillTo BillToParty         @default(WORKER) @map("default_bill_to")
  displayOrder  Int                 @default(0) @map("display_order")
  isRequired    Boolean             @default(true) @map("is_required")
  template      BillingTemplate     @relation(fields: [templateId], references: [id], onDelete: Cascade)

  @@index([templateId, displayOrder])
  @@map("billing_template_items")
}

model BillingPlan {
  id            String              @id @default(uuid()) @db.Uuid
  deploymentId  String              @unique @map("deployment_id") @db.Uuid
  templateId    String?             @map("template_id") @db.Uuid
  totalAmount   Decimal             @map("total_amount") @db.Decimal(12, 2)
  paidAmount    Decimal             @default(0) @map("paid_amount") @db.Decimal(12, 2)
  balanceAmount Decimal             @default(0) @map("balance_amount") @db.Decimal(12, 2)
  status        BillingPlanStatus   @default(PENDING)
  reviewStatus  BillingReviewStatus @default(NORMAL) @map("review_status")
  reviewReason  String?             @map("review_reason") @db.Text
  confirmedAt   DateTime?           @map("confirmed_at") @db.Timestamptz
  confirmedBy   String?             @map("confirmed_by") @db.Uuid
  items         BillingPlanItem[]
  deployment    Deployment          @relation(fields: [deploymentId], references: [id])
  createdAt     DateTime            @default(now()) @map("created_at") @db.Timestamptz
  updatedAt     DateTime            @updatedAt @map("updated_at") @db.Timestamptz

  @@index([deploymentId])
  @@index([status, reviewStatus])
  @@map("billing_plans")
}

model BillingPlanItem {
  id             String              @id @default(uuid()) @db.Uuid
  billingPlanId  String              @map("billing_plan_id") @db.Uuid
  billingDate    DateTime            @map("billing_date") @db.Date
  dueDate        DateTime?           @map("due_date") @db.Date
  amount         Decimal             @db.Decimal(10, 2)
  itemCategory   BillingItemCategory @map("item_category")
  status         BillingItemStatus   @default(GENERATED)
  billTo         BillToParty         @default(WORKER) @map("bill_to")
  calculatedFrom Json?               @map("calculated_from")
  isProrated     Boolean             @default(false) @map("is_prorated")
  proratedDays   Int?                @map("prorated_days")
  description    String?             @db.Text
  remarks        String?             @db.Text
  billingPlan    BillingPlan         @relation(fields: [billingPlanId], references: [id], onDelete: Cascade)
  createdAt      DateTime            @default(now()) @map("created_at") @db.Timestamptz
  updatedAt      DateTime            @updatedAt @map("updated_at") @db.Timestamptz

  @@index([billingPlanId, billingDate])
  @@index([status])
  @@index([itemCategory])
  @@map("billing_plan_items")
}

// ==========================================
// Phase 9: Enhanced Accounting Module
// ==========================================

// 1. 動態帳款科目定義 (Dynamic Billing Item Definition)
model BillingItemDefinition {
  id        String              @id @default(uuid()) @db.Uuid
  code      String              @unique @db.VarChar(50) // 系統內部識別碼 (e.g., "UTILITY", "RENT")
  name      String              @db.VarChar(100) // 預設顯示名稱 (e.g., "水電費")
  nameEn    String?             @map("name_en") @db.VarChar(100)
  category  BillingItemCategory // 關聯到現有 enum 分類
  isSystem  Boolean             @default(false) @map("is_system") // 系統預設科目(不可刪除)
  isActive  Boolean             @default(true) @map("is_active")
  sortOrder Int                 @default(0) @map("sort_order")

  // Relations
  employerAliases EmployerBillingAlias[]
  receivables     Receivable[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@map("billing_item_definitions")
}

// 2. 雇主專屬科目別名 (Employer-specific Billing Alias)
model EmployerBillingAlias {
  id           String @id @default(uuid()) @db.Uuid
  employerId   String @map("employer_id") @db.Uuid
  definitionId String @map("definition_id") @db.Uuid
  customName   String @map("custom_name") @db.VarChar(100) // 該雇主看到的名稱

  employer   Employer              @relation(fields: [employerId], references: [id], onDelete: Cascade)
  definition BillingItemDefinition @relation(fields: [definitionId], references: [id])

  @@unique([employerId, definitionId])
  @@index([employerId])
  @@map("employer_billing_aliases")
}

// 3. 應收帳款 (Account Receivable)
model Receivable {
  id           String @id @default(uuid()) @db.Uuid
  workerId     String @map("worker_id") @db.Uuid
  employerId   String @map("employer_id") @db.Uuid
  billingCycle String @map("billing_cycle") @db.VarChar(10) // 帳期 (e.g., "2024-01")

  itemDefinitionId String @map("item_definition_id") @db.Uuid
  itemName         String @map("item_name") @db.VarChar(100) // 冗餘存儲 (Snapshot)

  amount  Decimal  @db.Decimal(10, 2) // 應收金額
  dueDate DateTime @map("due_date") @db.Date // 應收帳款日

  status String @default("PENDING") @db.VarChar(20) // PENDING, PARTIAL, PAID, CANCELLED
  type   String @default("REGULAR") @db.VarChar(20) // REGULAR (一般), ADJUSTMENT (補收/調整)

  // 調整單連結到原始帳款
  originalReceivableId String? @map("original_receivable_id") @db.Uuid

  // Relations
  transactions       PaymentTransaction[]
  auditLogs          AccountingAuditLog[]
  invoiceItems       InvoiceItem[]
  worker             Worker                @relation(fields: [workerId], references: [id])
  employer           Employer              @relation(fields: [employerId], references: [id])
  itemDefinition     BillingItemDefinition @relation(fields: [itemDefinitionId], references: [id])
  originalReceivable Receivable?           @relation("AdjustmentFrom", fields: [originalReceivableId], references: [id])
  adjustments        Receivable[]          @relation("AdjustmentFrom")

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz
  createdBy String?  @map("created_by") @db.Uuid

  @@index([workerId, billingCycle])
  @@index([employerId, billingCycle])
  @@index([status])
  @@map("receivables")
}

// 4. 實收帳款 (Payment Transaction / 金流)
model PaymentTransaction {
  id           String @id @default(uuid()) @db.Uuid
  receivableId String @map("receivable_id") @db.Uuid

  amount        Decimal  @db.Decimal(10, 2) // 實收金額
  paymentDate   DateTime @map("payment_date") @db.Date // 實收帳款日
  paymentMethod String   @map("payment_method") @db.VarChar(30) // CASH, TRANSFER, SALARY_DEDUCTION

  // 作廢機制
  isVoided   Boolean   @default(false) @map("is_voided")
  voidedAt   DateTime? @map("voided_at") @db.Timestamptz
  voidedBy   String?   @map("voided_by") @db.Uuid
  voidReason String?   @map("void_reason") @db.Text

  note      String? @db.Text
  createdBy String  @map("created_by") @db.Uuid

  receivable Receivable @relation(fields: [receivableId], references: [id])

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  @@index([receivableId])
  @@index([paymentDate])
  @@map("payment_transactions")
}

// 5. 帳務審計紀錄 (Accounting Audit Log)
model AccountingAuditLog {
  id           String @id @default(uuid()) @db.Uuid
  receivableId String @map("receivable_id") @db.Uuid

  action       String  @db.VarChar(30) // CREATE, UPDATE, VOID, ADJUSTMENT
  fieldChanged String? @map("field_changed") @db.VarChar(50)
  oldValue     String? @map("old_value") @db.Text
  newValue     String? @map("new_value") @db.Text
  reason       String? @db.Text

  createdBy String   @map("created_by") @db.Uuid
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  receivable Receivable @relation(fields: [receivableId], references: [id])

  @@index([receivableId])
  @@map("accounting_audit_logs")
}

// 6. 請款單 (Invoice)
model Invoice {
  id        String @id @default(uuid()) @db.Uuid
  invoiceNo String @unique @map("invoice_no") @db.VarChar(30) // 系統生成的請款單號

  payerType String @map("payer_type") @db.VarChar(20) // EMPLOYER, WORKER
  payerId   String @map("payer_id") @db.Uuid // 關聯到 Employer 或 Worker

  issueDate DateTime @default(now()) @map("issue_date") @db.Date
  dueDate   DateTime @map("due_date") @db.Date

  totalAmount Decimal @map("total_amount") @db.Decimal(12, 2)
  status      String  @default("DRAFT") @db.VarChar(20) // DRAFT, ISSUED, PAID, CANCELLED

  notes     String? @db.Text
  createdBy String  @map("created_by") @db.Uuid

  items InvoiceItem[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@index([payerType, payerId])
  @@index([status])
  @@map("invoices")
}

// 7. 請款單項目 (Invoice Item)
model InvoiceItem {
  id           String  @id @default(uuid()) @db.Uuid
  invoiceId    String  @map("invoice_id") @db.Uuid
  receivableId String  @map("receivable_id") @db.Uuid
  amount       Decimal @db.Decimal(10, 2) // 本次請款金額 (可能只請部分)

  invoice    Invoice    @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  receivable Receivable @relation(fields: [receivableId], references: [id])

  @@index([invoiceId])
  @@map("invoice_items")
}
