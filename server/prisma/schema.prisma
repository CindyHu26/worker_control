generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["clientExtensions"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enums
enum UserRole {
  admin
  manager
  staff

  @@map("user_role")
}

enum GenderType {
  male
  female
  other

  @@map("gender_type")
}

enum DeploymentStatus {
  active
  ended
  pending
  terminated

  @@map("deployment_status")
}

enum IncidentSeverity {
  low
  medium
  high
  critical

  @@map("incident_severity")
}

enum IncidentStatus {
  open
  in_progress
  closed

  @@map("incident_status")
}

enum PermitType {
  initial
  extension
  reissue

  @@map("permit_type")
}

enum HealthCheckType {
  entry
  mo6           @map("6mo")
  mo18          @map("18mo")
  mo30          @map("30mo")
  supplementary

  @@map("health_check_type")
}

enum HealthCheckResult {
  pass
  fail
  pending

  @@map("health_check_result")
}

// enum NationalityType {
//   PH
//   ID
//   VN
//   TH
//   OTHER
// 
//   @@map("nationality_type")
// }

enum WorkerCategory {
  general
  intermediate_skilled
  professional

  @@map("worker_category")
}

enum ManagementSourceType {
  direct_hiring
  re_hiring
  transfer_in
  replacement

  @@map("management_source_type")
}

enum ServiceStatus {
  active_service
  contract_terminated
  runaway
  transferred_out
  commission_ended

  @@map("service_status")
}

enum StaffRoleType {
  sales_agent
  admin_staff
  bilingual_staff
  customer_service
  accountant

  @@map("staff_role_type")
}

enum InsuranceType {
  labor
  health
  accident

  @@map("insurance_type")
}

enum AddressType {
  approval_letter
  medical_pickup
  actual_residence
  arc
  work

  @@map("address_type")
}

enum JobOrderStatus {
  open         // ÈñãÁº∫‰∏≠
  sourcing     // ÈÅ∏Â∑•‰∏≠
  partial      // ÈÉ®ÂàÜÈåÑÂèñ
  filled       // È°çÊªø
  processing
  completed
  cancelled

  @@map("job_order_status")
}

enum CandidateResult {
  selected
  rejected
  failed_medical
  pending

  @@map("candidate_result")
}

enum WorkerEventType {
  RUNAWAY
  TRANSFER_OUT
  DEPARTURE
  DOMESTIC_HIRE
  CONTRACT_RENEWAL
  DEATH
  OTHER
  
  @@map("worker_event_type")
}

enum EmployerType {
  BUSINESS // ‰∫ãÊ•≠ÂñÆ‰Ωç (ÈúÄÁµ±Á∑®„ÄÅÂÖ¨Âè∏Âêç„ÄÅÂãû‰øùË≠âËôü) -> ÈÅ©Áî®Ë£ΩÈÄ†Ê•≠„ÄÅÁáüÈÄ†Ê•≠„ÄÅÊµ∑Ê¥ãÊºÅÊíà
  INDIVIDUAL // Ëá™ÁÑ∂‰∫∫ (ÈúÄË∫´ÂàÜË≠â„ÄÅÊà∂Á±çÂú∞ÂùÄ) -> ÈÅ©Áî®ÂÆ∂Â∫≠ÁúãË≠∑„ÄÅÂÆ∂Â∫≠Âπ´ÂÇ≠
  INSTITUTION // Ê©üÊßã (ÈúÄÁµ±Á∑®„ÄÅÊ©üÊßã‰ª£Á¢º„ÄÅÂ∫ä‰ΩçÊï∏) -> ÈÅ©Áî®È§äË≠∑Ê©üÊßã
}

// ==========================================
// Phase 7: Collaboration & Alert System Enums
// ==========================================

enum CommentEntityType {
  WORKER
  EMPLOYER
  DEPLOYMENT
  JOB_ORDER
  LEAD
  HEALTH_CHECK
  
  @@map("comment_entity_type")
}

enum AlertSeverity {
  CRITICAL  // üî¥ 3Â§©ÂÖßÈÄæÊúü
  WARNING   // üü° 1ÂÄãÊúàÂÖßÂà∞Êúü
  INFO      // üîµ ÂæÖË£úË≥áÊñô/ÈÄ≤Â∫¶ËøΩËπ§
  
  @@map("alert_severity")
}

enum AlertStatus {
  OPEN
  ACKNOWLEDGED
  RESOLVED
  
  @@map("alert_status")
}


// Models

// ==========================================
// Reference Data Tables
// ==========================================

model EmployerCategory {
  id        String       @id @default(uuid()) @db.Uuid
  code      String       @unique @db.VarChar(20) // e.g., "MANUFACTURING"
  nameZh    String       @map("name_zh") @db.VarChar(50) // Ë£ΩÈÄ†Ê•≠
  nameEn    String?      @map("name_en") @db.VarChar(50)
  
  // [Added] Core Fields
  type      EmployerType @default(BUSINESS)

  // [Added] UI Config
  iconName    String? @map("icon_name") @db.VarChar(50) // e.g., "Building", "User"
  color       String? @db.VarChar(20) // e.g., "blue", "green"
  description String? @db.Text

  sortOrder Int      @default(0) @map("sort_order")
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  
  // Relations
  employers Employer[]

  @@map("employer_categories")
}

model JobType {
  id   String @id @default(uuid()) @db.Uuid
  code String @unique @db.VarChar(20) // LBJ01: ‰ª£Á¢º (e.g., "1")

  // --- Names (Multi-language) ---
  titleZh String  @map("title_zh") @db.VarChar(100) // LBJ02: Â∑•Á®ÆÂêçÁ®±
  titleEn String  @map("title_en") @db.VarChar(100) // LBJ03: Ëã±ÊñáÂ∑•Á®ÆÂêçÁ®±
  titleTh String? @map("title_th") @db.VarChar(100) // LBJ04: Ê≥∞ÊñáÂ∑•Á®ÆÂêçÁ®±
  titleId String? @map("title_id") @db.VarChar(100) // LBJ05: Âç∞ÊñáÂ∑•Á®ÆÂêçÁ®±
  titleVn String? @map("title_vn") @db.VarChar(100) // LBJ06: Ë∂äÊñáÂ∑•Á®ÆÂêçÁ®±

  // --- Fees ---
  employmentSecurityFee Int @default(0) @map("employment_security_fee") // LBJ07: ‰∏ÄËà¨Â∞±ÂÆâË≤ª
  reentrySecurityFee    Int @default(0) @map("reentry_security_fee") // LBJ08: ÈáçÊäïÂ∞±ÂÆâË≤ª

  // --- Insurance & Services ---
  agencyAccidentInsurance    Boolean @default(false) @map("agency_accident_insurance") // LBJ09: ‰ª£Ëæ¶ÊÑèÂ§ñÈö™Âä†‰øù
  agencyAccidentInsuranceAmt Int     @default(0) @map("agency_accident_insurance_amount") // LBJ10: ‰ª£Ëæ¶ÊÑèÂ§ñÈö™‰øùÈ°ç
  agencyLaborHealthInsurance Boolean @default(false) @map("agency_labor_health_insurance") // LBJ11: ‰ª£Ëæ¶ÂãûÂÅ•‰øùÂä†‰øù
  collectBankLoan            Boolean @default(false) @map("collect_bank_loan") // LBJ13: ‰ª£Êî∂ÈäÄË°åË≤∏Ê¨æ

  // --- Payroll & Compliance ---
  payDay                 Int?    @map("pay_day") // LBJ12: Â∑•Á®Æ-ÁôºËñ™Êó•
  requiresMedicalCheckup Boolean @default(false) @map("requires_medical_checkup") // LBJ14: ÊØèÂçäÂπ¥È´îÊ™¢Âê¶

  // --- System Fields ---
  sortOrder Int      @default(0) @map("sort_order")
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("job_types")
}

model Industry {
  id       String  @id @default(uuid()) @db.Uuid
  code     String  @unique @db.VarChar(10) // e.g., "0116"
  category String? @db.VarChar(5) // e.g., "A" (Industry Class)

  // Names
  nameZh String  @map("name_zh") @db.VarChar(100) // e.g., "È£üÁî®ËèáËïàÊ†ΩÂüπÊ•≠"
  nameEn String? @map("name_en") @db.VarChar(100) // e.g., "Growing of Mushrooms"
  nameTh String? @map("name_th") @db.VarChar(100)
  nameVn String? @map("name_vn") @db.VarChar(100)
  nameId String? @map("name_id") @db.VarChar(100)

  // Source metadata (from ROC Ë°åÊ•≠Ê®ôÊ∫ñÂàÜÈ°û)
  issuingAgency String? @map("issuing_agency") @db.VarChar(100) // ÁôºÂ∏ÉÊ©üÈóú
  agencyCode    String? @map("agency_code") @db.VarChar(50)      // Ê©üÈóú‰ª£Á¢º
  version       String? @db.VarChar(10)                          // ÁâàÊú¨

  // Status
  isOpen Boolean @default(true) @map("is_open") // "ÈñãÊîæÂê¶" (LBQ08)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  salaryConfigs      IndustrySalaryConfig[]
  recruitmentLetters EmployerRecruitmentLetter[]
  jobTitles     IndustryJobTitle[]

  @@map("industries")
}

model IndustrySalaryConfig {
  id         String   @id @default(uuid()) @db.Uuid
  industryId String   @map("industry_id") @db.Uuid
  industry   Industry @relation(fields: [industryId], references: [id], onDelete: Cascade)

  effectiveDate DateTime @map("effective_date") @db.Date // Logic applies FROM this date

  // Salary Standards (Monthly)
  technicalSalary    Int @map("technical_salary") // ÊäÄË°ìÂ∑•ÂêàÁêÜËñ™Ë≥á (LBQ09)
  nonTechnicalSalary Int @map("non_technical_salary") // ÈùûÊäÄË°ìÂ∑•ÂêàÁêÜËñ™Ë≥á (LBQ10)

  // Special Schedule (ÁâπÊÆäÊôÇÁ®ã)
  specialTechSalary    Int? @map("special_tech_salary") // ÁâπÊÆäÊôÇÁ®ãÊäÄË°ìÂ∑•Ëñ™Ë≥á (LBQ11)
  specialNonTechSalary Int? @map("special_non_tech_salary") // ÁâπÊÆäÊôÇÁ®ãÈùûÊäÄË°ìÂ∑•Ëñ™Ë≥á (LBQ12)

  // Mid-level Skilled (‰∏≠ÈöéÊäÄË°ì)
  midLevelSalary Int? @map("mid_level_salary") // ‰∏≠ÈöéÊäÄË°ìÂ∑•Ëñ™Ë≥á (LBQ14)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@index([industryId])
  @@index([effectiveDate])
  @@map("industry_salary_configs")
}

model IndustryJobTitle {
  id          String   @id @default(uuid()) @db.Uuid
  industryId  String   @map("industry_id") @db.Uuid
  industry    Industry @relation(fields: [industryId], references: [id], onDelete: Cascade)

  titleZh     String   @map("title_zh") @db.VarChar(100)
  titleEn     String?  @map("title_en") @db.VarChar(100)
  titleTh     String?  @map("title_th") @db.VarChar(100)
  titleVn     String?  @map("title_vn") @db.VarChar(100)
  titleId     String?  @map("title_id") @db.VarChar(100)
  
  isActive    Boolean  @default(true) @map("is_active")
  
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt   DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@index([industryId])
  @@map("industry_job_titles")
}

model ContractType {
  id           String  @id @default(uuid()) @db.Uuid
  code         String  @unique @db.VarChar(50) // LBK01 (e.g., "1", "2")
  name         String  @db.VarChar(100) // LBK02 (e.g., "ÂàùÊ¨°ÊãõÂãü")
  isControlled Boolean @default(false) @map("is_controlled") // LBK03 (ÁÆ°Âà∂Âê¶)

  description String? @db.Text // LBK04 (ÂÇôË®ª)
  sortOrder   Int     @default(0) @map("sort_order")
  isActive    Boolean @default(true) @map("is_active")

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  deployments Deployment[]

  @@map("contract_types")
}

model Country {
  id        String   @id @default(uuid()) @db.Uuid
  code      String   @unique @db.VarChar(10) // ISO code e.g., "PH", "VN" (LBW04)
  nameZh    String   @map("name_zh") @db.VarChar(50) // e.g., "Ëè≤ÂæãË≥ì" (LBW01)
  nameEn    String?  @map("name_en") @db.VarChar(50) // e.g., "Philippines" (LBW02)
  sortOrder Int      @default(0) @map("sort_order")
  isActive  Boolean  @default(true) @map("is_active")
  
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@map("countries")
}

model DomesticAgency {
  id   String @id @default(uuid()) @db.Uuid
  code String @unique @db.VarChar(10) // ‰ª£Ëôü (CO01)

  // ÂÖ¨Âè∏ÂêçÁ®±
  agencyNameZh    String  @map("agency_name_zh") @db.VarChar(100) // ÂÖ¨Âè∏ÂêçÁ®±-‰∏≠ (CO02)
  agencyNameEn    String? @map("agency_name_en") @db.VarChar(100) // ÂÖ¨Âè∏ÂêçÁ®±-Ëã± (CO03)
  agencyNameShort String? @map("agency_name_short") @db.VarChar(50) // ÂÖ¨Âè∏ÂêçÁ®±-Á∞° (CO04)

  // ËÅØÁµ°Ë≥áË®ä
  phone                String? @map("phone") @db.VarChar(20) // ÈõªË©± (CO05)
  fax                  String? @map("fax") @db.VarChar(20) // ÂÇ≥Áúü (CO06)
  email                String? @map("email") @db.VarChar(100) // E-MAIL (CO19)
  emergencyEmail       String? @map("emergency_email") @db.VarChar(255) // Á∑äÊÄ•ÂæÖËæ¶Êî∂‰ª∂ËÄÖe-mail (CO19A)
  website              String? @map("website") @db.VarChar(100) // Á∂≤ÂùÄ (CO32)
  customerServicePhone String? @map("customer_service_phone") @db.VarChar(20) // ÂÆ¢Êà∂Áî≥Ë®¥Â∞àÁ∑ö (CO18)
  emergencyPhone       String? @map("emergency_phone") @db.VarChar(20) // Á∑äÊÄ•ÈÄ£Áµ°ÈõªË©± (CO24)

  // Âú∞ÂùÄË≥áË®ä
  zipCode   String? @map("zip_code") @db.VarChar(5) // ÈÉµÈÅûÂçÄËôü (CO07_POST)
  cityCode  String? @map("city_code") @db.VarChar(3) // Á∏£Â∏ÇÂà•‰ª£Á¢º (CO07_CITY)
  addressZh String? @map("address_zh") @db.VarChar(200) // ÂÖ¨Âè∏Âú∞ÂùÄ-‰∏≠ (CO07_ADR_TC)
  addressEn String? @map("address_en") @db.VarChar(200) // ÂÖ¨Âè∏Âú∞ÂùÄ-Ëã± (CO07_ADR_E)

  // Ë≤†Ë≤¨‰∫∫Ë≥áË®ä
  representativeName     String? @map("representative_name") @db.VarChar(50) // Ë≤†Ë≤¨‰∫∫ÂßìÂêç (CO12)
  representativeNameEn   String? @map("representative_name_en") @db.VarChar(100) // Ë≤†Ë≤¨‰∫∫ÂßìÂêç-Ëã± (CO12_E)
  representativeIdNo     String? @map("representative_id_no") @db.VarChar(20) // Ë≤†Ë≤¨‰∫∫Ë∫´‰ªΩË≠âËôü (CO17)
  representativePassport String? @map("representative_passport") @db.VarChar(20) // Ë≤†Ë≤¨‰∫∫Ë≠∑ÁÖßËôüÁ¢º (CO21)
  checkPayableTo         String? @map("check_payable_to") @db.VarChar(50) // Ë´ãÊ¨æÈñãÁ´ãÊîØÁ•®Êä¨È†≠ (CO34)

  // ÂÖ¨Âè∏Ë≠âÁÖßË≥áË®ä
  taxId                  String?   @map("tax_id") @db.VarChar(10) // ÂÖ¨Âè∏Áµ±‰∏ÄÁ∑®Ëôü (CO14)
  taxRegistrationNo      String?   @map("tax_registration_no") @db.VarChar(20) // Á®ÖÁ±çÁ∑®Ëôü (CO31)
  permitNumber           String?   @map("permit_number") @db.VarChar(20) // ÂÖ¨Âè∏Ë®±ÂèØË≠âÂ≠óËôü (CO13)
  permitValidFrom        DateTime? @map("permit_valid_from") @db.Date // ÂÖ¨Âè∏Ë®±ÂèØË≠âÊïàÊúü-Ëµ∑ (CO16)
  permitValidTo          DateTime? @map("permit_valid_to") @db.Date // ÂÖ¨Âè∏Ë®±ÂèØË≠âÊïàÊúü-Ë®ñ (CO15)
  businessRegistrationNo String?   @map("business_registration_no") @db.VarChar(50) // ÁáüÂà©‰∫ãÊ•≠ÁôªË®òË≠âËôü (CO20)

  // ÈäÄË°åÂ∏≥Êà∂Ë≥áË®ä
  postalAccountNo   String? @map("postal_account_no") @db.VarChar(20) // ÈÉµÊîøÂäÉÊí•Â∏≥Ëôü (CO22)
  postalAccountName String? @map("postal_account_name") @db.VarChar(100) // ÈÉµÊîøÂäÉÊí•Â∏≥Ëôü-Êà∂Âêç (CO23)
  bankName          String? @map("bank_name") @db.VarChar(100) // ÂåØÊ¨æÈäÄË°åÂêçÁ®± (CO25)
  bankCode          String? @map("bank_code") @db.VarChar(3) // ÈäÄË°åÁ∏ΩË°å‰ª£Ëôü (CO26)
  bankBranchCode    String? @map("bank_branch_code") @db.VarChar(4) // ÈäÄË°åÂàÜÊîØÂñÆ‰Ωç‰ª£Ëôü (CO27)
  bankAccountNo     String? @map("bank_account_no") @db.VarChar(20) // ÈäÄË°åÂ∏≥Ëôü (CO28)
  bankAccountName   String? @map("bank_account_name") @db.VarChar(100) // ÈäÄË°åÂ∏≥Êà∂ÂêçÁ®± (CO29)

  // ÂÖßÈÉ®ÁÆ°ÁêÜ
  accountant String?  @map("accountant") @db.VarChar(50) // Â∏≥ÂãôÊúÉË®à (CO30)
  isActive   Boolean  @default(true) @map("is_active")
  sortOrder  Int      @default(0) @map("sort_order")
  createdAt  DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt  DateTime @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  bilateralTradeLicenses AgencyBilateralTradeLicense[]
  bankAccounts           DomesticAgencyBankAccount[]
  employees              Employee[]

  @@map("domestic_agencies")
}

model Bank {
  id   String @id @default(uuid()) @db.Uuid
  code String @unique @db.VarChar(12) // ÈäÄË°åÁ∑®Ëôü (LCA01)

  // ÈäÄË°åÂêçÁ®±
  bankName   String  @map("bank_name") @db.VarChar(100) // ÈäÄË°åÂêçÁ®± (LCA02)
  bankNameEn String? @map("bank_name_en") @db.VarChar(100) // ÈäÄË°åÂêçÁ®±-Ëã±Êñá (LCA02_E)

  // ËÅØÁµ°Ë≥áË®ä
  contactPerson String? @map("contact_person") @db.VarChar(50) // ÈÄ£Áµ°‰∫∫ (LCA03)
  phone         String? @map("phone") @db.VarChar(30) // ÈõªË©± (LCA04)
  fax           String? @map("fax") @db.VarChar(30) // ÂÇ≥Áúü (LCA05)
  address       String? @map("address") @db.VarChar(200) // Âú∞ÂùÄ (LCA07)

  // ÂÇôË®ª
  notes String? @map("notes") @db.VarChar(200) // ÂÇôË®ª (LCA06)

  // ÁãÄÊÖã
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  agencyAccounts DomesticAgencyBankAccount[]

  @@map("banks")
}

model DomesticAgencyBankAccount {
  id String @id @default(uuid()) @db.Uuid

  // Â§ñÈçµ
  domesticAgencyId String         @map("domestic_agency_id") @db.Uuid
  domesticAgency   DomesticAgency @relation(fields: [domesticAgencyId], references: [id], onDelete: Cascade)

  bankId String @map("bank_id") @db.Uuid
  bank   Bank   @relation(fields: [bankId], references: [id], onDelete: Cascade)

  // Ë©≤ÂúãÂÖß‰ª≤‰ªãÂú®Ë©≤ÈäÄË°åÁöÑÂ∞àÂ±¨Ë≥áË®ä
  agencyUnitCode  String @map("agency_unit_code") @db.VarChar(12) // ‰ª≤‰ªãÁöÑÂßîË®óÂñÆ‰Ωç‰ª£Ëôü (LCA09)
  agencyAccountNo String @map("agency_account_no") @db.VarChar(20) // ‰ª≤‰ªãÁöÑËΩâÂÖ•Â∏≥Ëôü (LCA08)

  // Â∏≥Êà∂Áî®ÈÄîË™™Êòé
  accountPurpose String? @map("account_purpose") @db.VarChar(100) // ‰æãÂ¶ÇÔºö„ÄåÂãûÂ∑•Ëñ™Ë≥áËΩâÂ∏≥„Äç„ÄÅ„ÄåÊúçÂãôË≤ªÊî∂Ê¨æ„Äç

  // ÊòØÂê¶ÁÇ∫‰∏ªË¶ÅÂ∏≥Êà∂
  isPrimary Boolean @default(false) @map("is_primary") // Ë©≤‰ª≤‰ªãÂú®Ë©≤ÈäÄË°åÁöÑ‰∏ªË¶ÅÂ∏≥Êà∂

  // ÁãÄÊÖã
  isActive Boolean @default(true) @map("is_active")
  notes    String? @map("notes") @db.Text

  // ÂØ©Ë®àÊ¨Ñ‰Ωç
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  // Á¢∫‰øùÂêå‰∏ÄÂÄã‰ª≤‰ªãÂú®Âêå‰∏ÄÂÆ∂ÈäÄË°åÁöÑÂêå‰∏ÄÂÄãÂ∏≥Ëôü‰∏çÈáçË§á
  @@unique([domesticAgencyId, bankId, agencyAccountNo])
  @@index([domesticAgencyId])
  @@index([bankId])
  @@map("domestic_agency_bank_accounts")
}

model AgencyBilateralTradeLicense {
  id       String         @id @default(uuid()) @db.Uuid
  agencyId String         @map("agency_id") @db.Uuid
  agency   DomesticAgency @relation(fields: [agencyId], references: [id], onDelete: Cascade)

  // ÂúãÂÆ∂‰ª£Á¢º (ISO 3166-1 alpha-2: TH, PH, ID, VN, IN Á≠â)
  country String @db.VarChar(2) // ‰ΩøÁî®ÂÖ©Â≠óÊØçÂúãÂÆ∂‰ª£Á¢º

  // Ë®±ÂèØË≠âË≥áË®ä
  licenseNumber String?  @map("license_number") @db.VarChar(50) // Ë®±ÂèØË≠âÂ≠óËôüÔºàÂ¶ÇÊûúÊúâÔºâ
  validFrom     DateTime @map("valid_from") @db.Date // ÁîüÊïàÊó•Êúü
  validTo       DateTime @map("valid_to") @db.Date // Âà∞ÊúüÊó•Êúü

  // ÁãÄÊÖã
  status String @default("ACTIVE") @db.VarChar(20) // ACTIVE, EXPIRED, REVOKED

  // ÂÇôË®ª
  notes String? @map("notes") @db.Text

  // ÂØ©Ë®àÊ¨Ñ‰Ωç
  createdBy String?  @map("created_by") @db.Uuid
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@index([agencyId])
  @@index([validTo]) // Âø´ÈÄüÊü•Ë©¢Âç≥Â∞áÂà∞ÊúüÁöÑË®±ÂèØË≠â
  @@map("agency_bilateral_trade_licenses")
}

model PartnerAgency {
  id   String @id @default(uuid()) @db.Uuid
  code String @unique @db.VarChar(10) // ‰ª£Ëôü (LBN01)

  // ÂÖ¨Âè∏ÂêçÁ®±
  agencyNameZh      String  @map("agency_name_zh") @db.VarChar(200) // ÂÖ¨Âè∏ÂêçÁ®±-‰∏≠ (LBN02)
  agencyNameZhShort String? @map("agency_name_zh_short") @db.VarChar(100) // ÂÖ¨Âè∏ÂêçÁ®±-‰∏≠Á∞° (LBN04)
  agencyNameEn      String? @map("agency_name_en") @db.VarChar(200) // ÂÖ¨Âè∏ÂêçÁ®±-Ëã± (LBN03)
  agencyNameEnShort String? @map("agency_name_en_short") @db.VarChar(100) // ÂÖ¨Âè∏ÂêçÁ®±-Ëã±Á∞° (LBN04_E)

  // Âü∫Êú¨ËÅØÁµ°Ë≥áË®ä
  phone String? @map("phone") @db.VarChar(20) // ÈõªË©± (LBN05)
  fax   String? @map("fax") @db.VarChar(20) // ÂÇ≥Áúü (LBN06)
  email String? @map("email") @db.VarChar(100) // E-mail (LBN36)

  // ÂúãÂà•ËàáÂú∞ÂùÄ
  country       String? @map("country") @db.VarChar(2) // ÂúãÂà•‰ª£Á¢º (ISO 3166-1 alpha-2)
  countryNameZh String? @map("country_name_zh") @db.VarChar(20) // ÂúãÂà•‰∏≠Êñá (LBN07_CODE)
  addressZh     String? @map("address_zh") @db.VarChar(200) // ÂÖ¨Âè∏Âú∞ÂùÄ-‰∏≠ (LBN07_ADR_TC)
  addressEn     String? @map("address_en") @db.VarChar(200) // ÂÖ¨Âè∏Âú∞ÂùÄ-Ëã± (LBN07_ADR_E)
  addressShort  String? @map("address_short") @db.VarChar(200) // ÂÖ¨Âè∏Âú∞ÂùÄ-Á∞° (LBN07_ADR_SC)

  // ËÅØÁµ°‰∫∫Ë≥áË®ä
  contactPerson String? @map("contact_person") @db.VarChar(50) // ËÅØÁµ°‰∫∫ (LBN29)
  contactPhone  String? @map("contact_phone") @db.VarChar(20) // ËÅØÁµ°ÈõªË©± (LBN30)

  // ÂØÑ‰ª∂Âú∞ÂùÄ
  mailingAddressZh String? @map("mailing_address_zh") @db.VarChar(200) // ÂØÑ‰ª∂Âú∞ÂùÄ-‰∏≠Êñá (LBN31)
  mailingAddressEn String? @map("mailing_address_en") @db.VarChar(200) // ÂØÑ‰ª∂Âú∞ÂùÄ-Ëã±Êñá (LBN32)

  // Ë≤†Ë≤¨‰∫∫Ë≥áË®ä
  representativeName     String? @map("representative_name") @db.VarChar(50) // Ë≤†Ë≤¨‰∫∫ÂßìÂêç (LBN12)
  representativeNameEn   String? @map("representative_name_en") @db.VarChar(100) // Ë≤†Ë≤¨‰∫∫ÂßìÂêç-Ëã± (LBN12_E)
  representativeIdNo     String? @map("representative_id_no") @db.VarChar(20) // Ë≤†Ë≤¨‰∫∫Ë∫´‰ªΩË≠âËôü (LBN19)
  representativePassport String? @map("representative_passport") @db.VarChar(20) // Ë≤†Ë≤¨‰∫∫Ë≠∑ÁÖßËôüÁ¢º (LBN26)

  // ÂÖ¨Âè∏Ë≠âÁÖßË≥áË®ä
  taxId                  String?   @map("tax_id") @db.VarChar(10) // ÂÖ¨Âè∏Áµ±‰∏ÄÁ∑®Ëôü (LBN14)
  businessRegistrationNo String?   @map("business_registration_no") @db.VarChar(50) // ÁáüÂà©‰∫ãÊ•≠ÁôªË®òË≠âËôü (LBN27)
  permitNumber           String?   @map("permit_number") @db.VarChar(50) // ÂÖ¨Âè∏Ë®±ÂèØË≠âÂ≠óËôü (LBN13)
  foreignLicenseNo       String?   @map("foreign_license_no") @db.VarChar(50) // ÂúãÂ§ñÂü∑ÁÖßÁ∑®Ëôü (LBN20)
  foreignLicenseExpiry   DateTime? @map("foreign_license_expiry") @db.Date // ÂúãÂ§ñÂü∑ÁÖßÊïàÊúü (LBN21)

  // ÂãûÂãïÈÉ®Ë™çÂèØË≥áË®ä
  molPermitNo  String?   @map("mol_permit_no") @db.VarChar(20) // ÂãûÂãïÈÉ®Ë®±ÂèØÁ∑®Ëôü (LBN33)
  molValidFrom DateTime? @map("mol_valid_from") @db.Date // ÂãûÂãïÈÉ®Ë™çÂèØÊúâÊïàËµ∑ÂßãÊó• (LBN34)
  molValidTo   DateTime? @map("mol_valid_to") @db.Date // ÂãûÂãïÈÉ®Ë™çÂèØÊúâÊïàÂ±ÜÊªøÊó• (LBN22)

  // ÈäÄË°åÂ∏≥Êà∂Ë≥áË®ä
  payeeName     String? @map("payee_name") @db.VarChar(100) // Êî∂Ê¨æ‰∫∫ (LBN40)
  bankName      String? @map("bank_name") @db.VarChar(100) // ÈäÄË°åÂêçÁ®± (LBN41)
  bankAccountNo String? @map("bank_account_no") @db.VarChar(50) // ÈäÄË°åÂ∏≥Ëôü (LBN42)
  bankAddress   String? @map("bank_address") @db.VarChar(200) // ÈäÄË°åÂú∞ÂùÄ (LBN43)

  // ÈÖçÂêàË≤∏Ê¨æÈäÄË°åÔºàÂ§ñÈçµÂà∞ LoanBank ÂèÉËÄÉË°®Ôºâ
  loanBankCode String? @map("loan_bank_code") @db.VarChar(10) // (LBN24)

  // ÁãÄÊÖãËàáÂÇôË®ª
  isActive Boolean @default(true) @map("is_active") // ‰ΩøÁî®‰∏≠ (LBN25: Y/N)
  notes    String? @map("notes") @db.Text // ÂÇôË®ª (LBN35)

  // ÂØ©Ë®àÊ¨Ñ‰Ωç
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  bilateralTradeLicenses PartnerAgencyBilateralLicense[]
  contracts              PartnerAgencyContract[]

  @@map("partner_agencies")
}

model PartnerAgencyBilateralLicense {
  id       String        @id @default(uuid()) @db.Uuid
  agencyId String        @map("agency_id") @db.Uuid
  agency   PartnerAgency @relation(fields: [agencyId], references: [id], onDelete: Cascade)

  // ‰∫íË≤øË™çË≠âË≥áË®ä
  licenseNumber String?  @map("license_number") @db.VarChar(50) // Ë™çË≠âÁ∑®Ëôü
  validFrom     DateTime @map("valid_from") @db.Date // ‰∫íË≤øÁîüÊïàÊó•Êúü (LBN44)
  validTo       DateTime @map("valid_to") @db.Date // ‰∫íË≤øË™çË≠âÊïàÊúü (LBN37)

  // ÁãÄÊÖã
  status String @default("ACTIVE") @db.VarChar(20) // ACTIVE, EXPIRED, REVOKED, SUSPENDED

  // ÂÇôË®ª
  notes String? @map("notes") @db.Text

  // ÂØ©Ë®àÊ¨Ñ‰Ωç
  createdBy String?  @map("created_by") @db.Uuid
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@index([agencyId])
  @@index([validTo]) // Âø´ÈÄüÊü•Ë©¢Âç≥Â∞áÂà∞ÊúüÁöÑË®±ÂèØË≠â
  @@index([status])
  @@map("partner_agency_bilateral_licenses")
}

model PartnerAgencyContract {
  id       String        @id @default(uuid()) @db.Uuid
  agencyId String        @map("agency_id") @db.Uuid
  agency   PartnerAgency @relation(fields: [agencyId], references: [id], onDelete: Cascade)

  // ÂêàÁ¥ÑË≥áË®ä
  contractNo   String    @map("contract_no") @db.VarChar(50) // Á∞ΩÂÆöÂãûÂ∑•‰æõÊáâÂ•ëÁ¥ÑÊõ∏NO. (LBN45)
  contractType String?   @map("contract_type") @db.VarChar(50) // ÂêàÁ¥ÑÈ°ûÂûãÔºàÂãûÂ∑•‰æõÊáâ„ÄÅ‰∫íË≤øÂçîË≠∞Á≠âÔºâ
  signedDate   DateTime? @map("signed_date") @db.Date // Á∞ΩÁ¥ÑÊó•Êúü
  validFrom    DateTime? @map("valid_from") @db.Date // ÂêàÁ¥ÑÁîüÊïàÊó•
  validTo      DateTime? @map("valid_to") @db.Date // ÂêàÁ¥ÑÂà∞ÊúüÊó•

  // ÂêàÁ¥ÑÂÖßÂÆπÊëòË¶Å
  summary String? @map("summary") @db.Text

  // Êñá‰ª∂ÈôÑ‰ª∂Ë∑ØÂæë
  documentPath String? @map("document_path") @db.VarChar(255)

  // ÁãÄÊÖã
  status String @default("ACTIVE") @db.VarChar(20) // DRAFT, ACTIVE, EXPIRED, TERMINATED

  // ÂØ©Ë®àÊ¨Ñ‰Ωç
  createdBy String?  @map("created_by") @db.Uuid
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@index([agencyId])
  @@index([contractNo])
  @@index([validTo])
  @@map("partner_agency_contracts")
}

model LoanBank {
  id        String   @id @default(uuid()) @db.Uuid
  code      String   @unique @db.VarChar(10) // ÈäÄË°å‰ª£Á¢º
  nameZh    String   @map("name_zh") @db.VarChar(50) // ÈäÄË°åÂêçÁ®±Ôºà‰∏≠ÊñáÔºâ
  nameEn    String?  @map("name_en") @db.VarChar(100) // ÈäÄË°åÂêçÁ®±ÔºàËã±ÊñáÔºâ
  sortOrder Int      @default(0) @map("sort_order")
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  @@map("loan_banks")
}

model Employee {
  id   String @id @default(uuid()) @db.Uuid
  code String @unique @db.VarChar(18) // ‰ª£Á¢º (LBR01) - ÂèØ‰øÆÊîπ

  // Âü∫Êú¨Ë≥áË®ä
  fullName    String    @map("full_name") @db.VarChar(50) // ‰∏≠ÊñáÂßìÂêç (LBR02)
  fullNameEn  String?   @map("full_name_en") @db.VarChar(100) // Ëã±ÊñáÂßìÂêç (LBR16)
  gender      String?   @map("gender") @db.VarChar(10) // ÊÄßÂà• (LBR28): Áî∑/Â•≥
  nationality String?   @map("nationality") @db.VarChar(20) // ÂúãÁ±ç (LBR27)
  dateOfBirth DateTime? @map("date_of_birth") @db.Date // ÁîüÊó• (LBR26)
  idNumber    String?   @map("id_number") @db.VarChar(20) // Ë∫´ÂàÜË≠âÂ≠óËôü (LBR03) - ÈÅ∏Â°´ÔºÅ

  // ËÅ∑ÂãôË≥áË®ä
  departmentCode   String?         @map("department_code") @db.VarChar(10) // ÈÉ®ÈñÄ‰ª£Á¢º (LBR45)
  employeeNumber   String?         @map("employee_number") @db.VarChar(10) // Âì°Â∑•Á∑®Ëôü (LBR47) - ÂèØ‰øÆÊîπ
  jobTitle         String?         @map("job_title") @db.VarChar(50) // ËÅ∑ÂãôÂêçÁ®± (LBR07)
  domesticAgencyId String?         @map("domestic_agency_id") @db.Uuid // ÊâÄÂ±¨ÂúãÂÖß‰ª≤‰ªã (LBR52)
  domesticAgency   DomesticAgency? @relation(fields: [domesticAgencyId], references: [id], onDelete: SetNull)

  // ËÅØÁµ°Ë≥áË®ä
  phone       String? @map("phone") @db.VarChar(30) // ÈõªË©± (LBR04)
  mobilePhone String? @map("mobile_phone") @db.VarChar(30) // ÊâãÊ©ü (LBR48)
  extension   String? @map("extension") @db.VarChar(12) // ÈõªË©±ÂàÜÊ©ü‰ª£Ëôü (LBR18)
  email       String? @map("email") @db.VarChar(100) // E-mail (LBR37)
  receiveSms  Boolean @default(false) @map("receive_sms") // Êî∂Á∞°Ë®äÂê¶ (LBR41)

  // ËÅØÁµ°‰∫∫Ë≥áË®ä
  contactPerson String? @map("contact_person") @db.VarChar(50) // ËÅØÁµ°‰∫∫ (LBR05)
  contactPhone  String? @map("contact_phone") @db.VarChar(30) // ËÅØÁµ°ÈõªË©± (LBR06)

  // Âú∞ÂùÄË≥áË®ä
  mailingAddressZh     String? @map("mailing_address_zh") @db.VarChar(200) // ÈÄöË®ä‰ΩèÂùÄ-‰∏≠Êñá (LBR10)
  mailingAddressEn     String? @map("mailing_address_en") @db.VarChar(200) // ÈÄöË®ä‰ΩèÂùÄ-Ëã±Êñá (LBR11)
  residentialAddressZh String? @map("residential_address_zh") @db.VarChar(200) // Êà∂Á±ç‰ΩèÂùÄ-‰∏≠Êñá (LBR30)
  residentialAddressEn String? @map("residential_address_en") @db.VarChar(200) // Êà∂Á±ç‰ΩèÂùÄ-Ëã±Êñá (LBR31)

  // Á∑äÊÄ•ËÅØÁµ°‰∫∫
  emergencyContact String? @map("emergency_contact") @db.VarChar(50) // Á∑äÊÄ•ÈÄ£Áµ°‰∫∫ (LBR49)
  emergencyPhone   String? @map("emergency_phone") @db.VarChar(30) // Á∑äÊÄ•ÈÄ£Áµ°‰∫∫ÈõªË©± (LBR50)

  // ËÅ∑ÂãôËßíËâ≤ÔºàÂ∏ÉÊûóÂÄºÔºâ
  isSales           Boolean @default(false) @map("is_sales") // Ê•≠ÂãôÂê¶ (LBR08)
  isAdmin           Boolean @default(false) @map("is_admin") // Ë°åÊîøÂê¶ (LBR09)
  isCustomerService Boolean @default(false) @map("is_customer_service") // ÂÆ¢ÊúçÂê¶ (LBR29)
  isAccounting      Boolean @default(false) @map("is_accounting") // ÊúÉË®àÂê¶ (LBR36)
  isBilingual       Boolean @default(false) @map("is_bilingual") // ÈõôË™ûÂê¶ (LBR14)

  // Ê•≠ÂãôÁõ∏Èóú
  employerAutoCode String? @map("employer_auto_code") @db.VarChar(10) // Èõá‰∏ªËá™ÂãïÁ∑®ËôüÁî®‰ª£Á¢º (LBR17)
  contractCode     String? @map("contract_code") @db.VarChar(4) // Ê•≠ÂãôÂêàÁ¥Ñ‰ª£Á¢º (LBR24)
  contractSeqUsed  Int?    @default(0) @map("contract_seq_used") // Ê•≠ÂãôÂêàÁ¥ÑÂ∑≤Áî®Â∫èËôü (LBR25)
  salesGroupCode   String? @map("sales_group_code") @db.VarChar(10) // Ê•≠ÂãôÂàÜÁæ§‰ª£Á¢º (LBR20)
  expertise        String? @map("expertise") @db.VarChar(200) // Â∞àÈï∑ (LBR21)

  // ÈäÄË°åÂ∏≥Êà∂Ë≥áË®ä
  postalAccountNo   String? @map("postal_account_no") @db.VarChar(12) // ÂäÉÊí•Â∏≥Ëôü (LBR34)
  postalAccountName String? @map("postal_account_name") @db.VarChar(100) // ÂäÉÊí•Êà∂Âêç (LBR35)
  bankName          String? @map("bank_name") @db.VarChar(100) // ÂåØÊ¨æÈäÄË°åÂêçÁ®± (LBR38)
  bankAccountName   String? @map("bank_account_name") @db.VarChar(100) // ÈäÄË°åÂ∏≥Êà∂ÂêçÁ®± (LBR39)
  bankAccountNo     String? @map("bank_account_no") @db.VarChar(20) // ÂåØÊ¨æÈäÄË°åÂ∏≥Ëôü (LBR40)

  // Âà∞Èõ¢ËÅ∑Ë≥áË®ä
  hireDate           DateTime? @map("hire_date") @db.Date // Âà∞ËÅ∑Êó• (LBR22)
  insuranceStartDate DateTime? @map("insurance_start_date") @db.Date // Âä†‰øùÊó• (LBR43)
  resignationDate    DateTime? @map("resignation_date") @db.Date // Èõ¢ËÅ∑Êó• (LBR23)
  insuranceEndDate   DateTime? @map("insurance_end_date") @db.Date // ÈÄÄ‰øùÊó• (LBR44)

  // ÂÇôË®ª
  notes String? @map("notes") @db.Text // ÂÇôË®ª (LBR32)

  // ÁãÄÊÖã
  isActive  Boolean  @default(true) @map("is_active") // ÊòØÂê¶Âú®ËÅ∑
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@index([code])
  @@index([fullName])
  @@index([departmentCode])
  @@index([domesticAgencyId])
  @@index([isActive])
  @@map("employees")
}

model Department {
  id        String   @id @default(uuid()) @db.Uuid
  code      String   @unique @db.VarChar(10) // ÈÉ®ÈñÄ‰ª£Á¢º
  nameZh    String   @map("name_zh") @db.VarChar(50) // ÈÉ®ÈñÄÂêçÁ®±Ôºà‰∏≠ÊñáÔºâ
  nameEn    String?  @map("name_en") @db.VarChar(100) // ÈÉ®ÈñÄÂêçÁ®±ÔºàËã±ÊñáÔºâ
  sortOrder Int      @default(0) @map("sort_order")
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  @@map("departments")
}

// ==========================================
// Core Models
// ==========================================

model InternalUser {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  username     String   @unique @db.VarChar(50)
  email        String   @unique @db.VarChar(255)
  passwordHash String   @map("password_hash") @db.VarChar(255)
  role         UserRole @default(staff)
  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt    DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Relations (Created By / Updated By)
  createdEmployers Employer[]          @relation("EmployerCreatedBy")
  updatedEmployers Employer[]          @relation("EmployerUpdatedBy")
  createdWorkers   Worker[]            @relation("WorkerCreatedBy")
  updatedWorkers   Worker[]            @relation("WorkerUpdatedBy")
  createdJobOrders JobOrder[]          @relation("JobOrderCreatedBy")
  updatedJobOrders JobOrder[]          @relation("JobOrderUpdatedBy")
  // ... (Many other relations would be here, omitting for brevity in favor of core logic, 
  // but strictly strictly speaking, Prisma requires inverse relations for all. 
  // To keep schema manageable, I will define the mandatory ones and maybe skip inverse 
  // on Audit fields if not strictly needed for querying USER -> ALL RECORDS they created.)
  // Actually, let's include the key operational ones.
  assignedServices ServiceAssignment[] @relation("ServiceAssignedUser")

  // Comments & Mentions
  comments         SystemComment[]  @relation("CommentAuthor")
  mentionsReceived CommentMention[] @relation("MentionedUser")

  // CRM Relations
  assignedLeads    Lead[]           @relation("LeadAssignedUser")

  @@map("internal_users")
}

// ==========================================
// CRM: Sales Pipeline & Lead Management
// ==========================================

model Lead {
  id                    String   @id @default(uuid()) @db.Uuid
  
  // Âü∫Êú¨Ë≥áË®ä
  companyName           String   @map("company_name") @db.VarChar(100)
  taxId                 String?  @unique @map("tax_id") @db.VarChar(20)
  
  // ËÅØÁµ°Ë≥áË®ä
  contactPerson         String?  @map("contact_person") @db.VarChar(50)
  phone                 String?  @db.VarChar(30)
  email                 String?  @db.VarChar(100)
  address               String?  @db.Text
  
  // Ê•≠ÂãôË≥áË®ä
  industry              String?  @db.VarChar(50)  // Áî¢Ê•≠È°ûÂà• (e.g., MANUFACTURING)
  estimatedWorkerCount  Int?     @map("estimated_worker_count")
  status                String   @default("NEW") @db.VarChar(20)  // NEW, CONTACTED, DISCOVERY, QUOTATION, NEGOTIATION, WON, LOST
  
  // ËøΩËπ§Ë≥áË®ä
  source                String?  @db.VarChar(50)  // ‰æÜÊ∫êÔºöwalk-in, referral, web
  assignedTo            String?  @map("assigned_to") @db.Uuid
  assignedUser          InternalUser? @relation("LeadAssignedUser", fields: [assignedTo], references: [id])
  
  // ÊôÇÈñìÊà≥Ë®ò
  lastContactDate       DateTime? @map("last_contact_date") @db.Date
  nextFollowUpDate      DateTime? @map("next_follow_up_date") @db.Date
  
  // ËΩâÊ≠£Ë≥áË®ä
  convertedToEmployerId String?   @unique @map("converted_to_employer_id") @db.Uuid
  convertedEmployer     Employer? @relation("ConvertedFromLead", fields: [convertedToEmployerId], references: [id])
  convertedAt           DateTime? @map("converted_at") @db.Timestamptz
  
  // Relations
  interactions          LeadInteraction[]
  
  // Audit
  createdAt             DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt             DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz
  
  // Soft Delete
  isDeleted             Boolean   @default(false) @map("is_deleted")
  deletedAt             DateTime? @map("deleted_at")

  @@index([status])
  @@index([assignedTo])
  @@index([industry])
  @@map("leads")
}

model LeadInteraction {
  id            String   @id @default(uuid()) @db.Uuid
  leadId        String   @map("lead_id") @db.Uuid
  lead          Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  
  type          String   @db.VarChar(30)  // call, meeting, email, quotation_sent
  summary       String   @db.VarChar(200)
  detailedNotes String?  @map("detailed_notes") @db.Text
  outcome       String?  @db.VarChar(50)   // positive, negative, neutral, follow_up_needed
  date          DateTime @default(now()) @db.Timestamptz
  
  createdAt     DateTime @default(now()) @map("created_at") @db.Timestamptz
  
  @@index([leadId])
  @@index([date])
  @@map("lead_interactions")
}

model Employer {
  id        String  @id @default(uuid()) @db.Uuid
  // [Added] Business ID
  code      String? @unique @db.VarChar(20) // Èõá‰∏ªÁ∑®Ëôü
  shortName String? @map("short_name") @db.VarChar(50) // Èõá‰∏ªÁ∞°Á®±

  taxId         String? @unique @map("tax_id") @db.VarChar(20)
  companyName   String  @map("company_name") @db.VarChar(100)
  companyNameEn String? @map("company_name_en") @db.VarChar(100)

  // Responsible Person (Common leader name, or for Individual it is the Employer)
  responsiblePerson String? @map("responsible_person") @db.VarChar(50)

  address        String? @db.Text
  addressEn      String? @map("address_en") @db.Text
  invoiceAddress String? @map("invoice_address") @db.Text

  // [Added] Other Addresses
  taxAddress        String? @map("tax_address") @db.Text // Á®ÖÁ±çÂú∞ÂùÄ
  healthBillAddress String? @map("health_bill_address") @db.Text // ÂÅ•‰øùÂ∏≥ÂñÆÂú∞ÂùÄ
  healthBillZip     String? @map("health_bill_zip") @db.VarChar(10) // ÂÅ•‰øùÈÉµÈÅûÂçÄËôü

  phoneNumber String? @map("phone_number") @db.VarChar(20)
  mobilePhone String? @map("mobile_phone") @db.VarChar(20) // [Added] Ë°åÂãïÈõªË©± (CU42/CU34)
  email       String? @db.VarChar(100)

  contactPerson String? @map("contact_person") @db.VarChar(50)
  contactPhone  String? @map("contact_phone") @db.VarChar(20)

  // [Added] Internal Management
  referrer      String?   @db.VarChar(50) // ‰ªãÁ¥π‰∫∫
  terminateDate DateTime? @map("terminate_date") @db.Date // ÁµÇÊ≠¢Âßî‰ªªÊó•Êúü

  // Relations to Details
  corporateInfo  CorporateInfo?
  individualInfo IndividualInfo?

  // [Added] Relation to Category
  employerCategoryId String?           @map("employer_category_id") @db.Uuid
  category           EmployerCategory? @relation(fields: [employerCategoryId], references: [id])

  // Existing Relations
  recruitmentLetters EmployerRecruitmentLetter[]
  deployments        Deployment[]
  permitDocuments    PermitDocument[]
  incidents          Incident[]
  serviceAssignments ServiceAssignment[]
  jobOrders          JobOrder[]
  factories          EmployerFactory[] // [Added] Factories

  createdBy     String?       @map("created_by") @db.Uuid
  updatedBy     String?       @map("updated_by") @db.Uuid
  createdByUser InternalUser? @relation("EmployerCreatedBy", fields: [createdBy], references: [id])
  updatedByUser InternalUser? @relation("EmployerUpdatedBy", fields: [updatedBy], references: [id])

  // CRM & Conversion
  // Reverse relation: Employer can be created from Lead conversion
  convertedFromLead Lead? @relation("ConvertedFromLead")

  allocationRate       Decimal?  @map("allocation_rate") @db.Decimal(5, 4)
  complianceStandard   String?   @map("compliance_standard") @db.VarChar(50)
  zeroFeeEffectiveDate DateTime? @map("zero_fee_effective_date") @db.Date
  industryAttributes   Json?     @map("industry_attributes")
  
  monthlyServiceFee    Int       @default(1500) @map("monthly_service_fee") // [Added] Default Service Fee
  
  remarks              String?   @db.Text // [Added] ÈôÑË®ª (CU43)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  laborCounts          EmployerLaborCount[]
  industryRecognitions IndustryRecognition[]
  recruitmentProofs    RecruitmentProof[]
  officialDocuments    OfficialDocument[]

  // Soft Delete
  isDeleted Boolean   @default(false) @map("is_deleted")
  deletedAt DateTime? @map("deleted_at")

  // Quota Cache
  totalQuota Int @default(0) @map("total_quota") // Derived: Sum(active letters)

  // Agency Relation
  agencyId String?        @map("agency_id") @db.Uuid
  agency   AgencyCompany? @relation(fields: [agencyId], references: [id])

  @@map("employers")
}

model EmployerFactory {
  id         String   @id @default(uuid()) @db.Uuid
  employerId String   @map("employer_id") @db.Uuid
  employer   Employer @relation(fields: [employerId], references: [id], onDelete: Cascade)

  name         String  @map("name") @db.VarChar(100) // Âª†Âêç (Â¶ÇÔºö‰∏ÄÂª†)
  factoryRegNo String? @map("factory_reg_no") @db.VarChar(50) // Ë©≤Âª†ÁöÑÂ∑•Âª†ÁôªË®òË≠â

  address   String? @db.Text
  addressEn String? @map("address_en") @db.Text
  zipCode   String? @map("zip_code") @db.VarChar(10)
  cityCode  String? @map("city_code") @db.VarChar(10)

  laborCount   Int? @default(0) // Ë©≤Âª†Êú¨Âãû‰∫∫Êï∏
  foreignCount Int? @default(0) // Ë©≤Âª†Â§ñÂãû‰∫∫Êï∏

  createdAt DateTime @default(now()) @map("created_at")

  // Relations
  deployments          Deployment[]
  industryRecognitions IndustryRecognition[]
  workers              Worker[]

  // [Added] Recruitment Letter Relation
  recruitmentLetters EmployerRecruitmentLetter[] @relation("LetterWorkFactory")

  @@map("employer_factories")
}

model EmployerLaborCount {
  id         String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  employerId String @map("employer_id") @db.Uuid
  year       Int
  month      Int
  count      Int    @default(0) // Internal labor count

  employer Employer @relation(fields: [employerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  @@unique([employerId, year, month])
  @@map("employer_labor_counts")
}

model CorporateInfo {
  id         String   @id @default(uuid()) @db.Uuid
  employerId String   @unique @map("employer_id") @db.Uuid
  employer   Employer @relation(fields: [employerId], references: [id], onDelete: Cascade)

  factoryRegistrationNo String?  @map("factory_registration_no") @db.VarChar(50)
  factoryRegistrationId String?  @map("factory_registration_id") @db.VarChar(50)
  factoryAddress        String?  @map("factory_address") @db.Text
  factoryAddressEn      String?  @map("factory_address_en") @db.Text
  industryType          String?  @map("industry_type") @db.VarChar(50)
  industryCode          String?  @map("industry_code") @db.VarChar(20)
  capital               Decimal? @db.Decimal(15, 2)
  laborInsuranceNo      String?  @map("labor_insurance_no") @db.VarChar(50)
  laborInsuranceId      String?  @map("labor_insurance_id") @db.VarChar(50)
  healthInsuranceUnitNo String?  @map("health_insurance_unit_no") @db.VarChar(50)
  healthInsuranceId     String?  @map("health_insurance_id") @db.VarChar(50)
  securityFeeAccount    String?  @map("security_fee_account") @db.VarChar(50) // Employment Security Fee Account
  faxNumber             String?  @map("fax_number") @db.VarChar(20)

  // Institution Specifics
  institutionCode String? @map("institution_code") @db.VarChar(50)
  bedCount        Int?    @map("bed_count")

  @@map("corporate_info")
}

model IndividualInfo {
  id         String   @id @default(uuid()) @db.Uuid
  employerId String   @unique @map("employer_id") @db.Uuid
  employer   Employer @relation(fields: [employerId], references: [id], onDelete: Cascade)

  responsiblePersonDob    DateTime? @map("responsible_person_dob") @db.Date
  responsiblePersonIdNo   String?   @map("responsible_person_id_no") @db.VarChar(20)
  responsiblePersonFather String?   @map("responsible_person_father_name") @db.VarChar(50)
  responsiblePersonMother String?   @map("responsible_person_mother_name") @db.VarChar(50)
  responsiblePersonSpouse String?   @map("responsible_person_spouse") @db.VarChar(50)
  mobilePhone             String?   @map("mobile_phone") @db.VarChar(20) // [Added] Ë≤†Ë≤¨‰∫∫Ë°åÂãïÈõªË©±

  // [Added] Detailed Individual Info
  englishName  String? @map("english_name") @db.VarChar(100) // Ë≤†Ë≤¨‰∫∫Ëã±ÊñáÂêç
  birthPlace   String? @map("birth_place") @db.VarChar(50)
  birthPlaceEn String? @map("birth_place_en") @db.VarChar(100)

  // Êà∂Á±çÂú∞ÂùÄ
  residenceAddress  String? @map("residence_address") @db.Text
  residenceZip      String? @map("residence_zip") @db.VarChar(10)
  residenceCityCode String? @map("residence_city_code") @db.VarChar(10)

  idIssueDate      DateTime? @map("id_issue_date") @db.Date
  idIssuePlace     String?   @map("id_issue_place") @db.VarChar(50)
  militaryStatus   String?   @map("military_status") @db.VarChar(20)
  militaryStatusEn String?   @map("military_status_en") @db.VarChar(50)

  // Home Care Specifics
  patientName  String? @map("patient_name") @db.VarChar(50)
  patientIdNo  String? @map("patient_id_no") @db.VarChar(20)
  careAddress  String? @map("care_address") @db.Text
  relationship String? @map("relationship") @db.VarChar(50)

  @@map("individual_info")
}

model Worker {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  englishName String   @map("english_name") @db.VarChar(100)
  chineseName String?  @map("chinese_name") @db.VarChar(50)
  photoUrl    String?  @map("photo_url") @db.VarChar(255)
  dob         DateTime @db.Date

  // [Modified] Nationality (Dynamic)
  nationalityId String?      @map("nationality_id") @db.Uuid
  nationality   Nationality? @relation(fields: [nationalityId], references: [id])
  // REMOVED: nationality NationalityType

  category WorkerCategory @default(general)
  gender   GenderType?

  mobilePhone    String?   @map("mobile_phone") @db.VarChar(50)
  foreignAddress String?   @map("foreign_address") @db.Text
  maritalStatus  String?   @map("marital_status") @db.VarChar(20)
  marriageDate   DateTime? @map("marriage_date") @db.Date
  divorceDate    DateTime? @map("divorce_date") @db.Date
  height         Decimal?  @db.Decimal(5, 2)
  weight         Decimal?  @db.Decimal(5, 2)
  birthPlace     String?   @map("birth_place") @db.VarChar(100)
  educationLevel String?   @map("education_level") @db.VarChar(50)
  spouseName     String?   @map("spouse_name") @db.VarChar(100)

  overseasContactPhone  String? @map("overseas_contact_phone") @db.VarChar(50)
  overseasFamilyContact String? @map("overseas_family_contact") @db.VarChar(100)

  // [New] Social & Emergency
  lineId                String? @map("line_id") @db.VarChar(50)
  religion              String? @db.VarChar(50)
  emergencyContactName  String? @map("emergency_contact_name") @db.VarChar(50)
  emergencyContactPhone String? @map("emergency_contact_phone") @db.VarChar(50)

  bankAccountNo String?  @map("bank_account_no") @db.VarChar(50)
  bankCode      String?  @map("bank_code") @db.VarChar(20)
  loanBank      String?  @map("loan_bank") @db.VarChar(50)
  loanAmount    Decimal? @map("loan_amount") @db.Decimal(10, 2)

  flightArrivalInfo    String? @map("flight_arrival_info") @db.VarChar(100)
  oneStopServiceSerial String? @map("one_stop_service_serial") @db.VarChar(50)
  flightDeparture      String? @map("flight_departure") @db.VarChar(20)

  createdBy     String?       @map("created_by") @db.Uuid
  updatedBy     String?       @map("updated_by") @db.Uuid
  createdByUser InternalUser? @relation("WorkerCreatedBy", fields: [createdBy], references: [id])
  updatedByUser InternalUser? @relation("WorkerUpdatedBy", fields: [updatedBy], references: [id])

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  events              WorkerEvent[]
  passports           WorkerPassport[]
  arcs                WorkerArc[]
  deployments         Deployment[]
  healthChecks        HealthCheck[]
  incidents           Incident[]
  officialDocuments   OfficialDocument[]
  serviceAssignments  ServiceAssignment[]
  insurances          WorkerInsurance[]
  addressHistory      WorkerAddressHistory[]
  interviewCandidates InterviewCandidate[]
  payrolls            PayrollRecord[]

  // Soft Delete
  isDeleted Boolean   @default(false) @map("is_deleted")
  deletedAt DateTime? @map("deleted_at")

  // Foreign Agency
  foreignAgencyId String?        @map("foreign_agency_id") @db.Uuid
  foreignAgency   ForeignAgency? @relation(fields: [foreignAgencyId], references: [id])

  // New Fields for Scheduler
  residencePermitExpiry DateTime? @map("residence_permit_expiry") @db.Date
  passportExpiry        DateTime? @map("passport_expiry") @db.Date
  medCheck6moDeadline   DateTime? @map("med_check_6mo_deadline") @db.Date
  medCheck18moDeadline  DateTime? @map("med_check_18mo_deadline") @db.Date
  medCheck30moDeadline  DateTime? @map("med_check_30mo_deadline") @db.Date

  // Dormitory Bed
  bedId             String?          @unique @map("bed_id") @db.Uuid
  bed               DormitoryBed?    @relation(fields: [bedId], references: [id])
  EmployerFactory   EmployerFactory? @relation(fields: [employerFactoryId], references: [id])
  employerFactoryId String?          @db.Uuid

  @@map("workers")

  // Relations
  accommodationHistory    WorkerAccommodationHistory[]
  relocationNotifications RelocationNotification[]
  entryFiling             EntryFiling?
  medicalExceptions       MedicalException[]
}

// ÂÖ•Â¢ÉÁî≥Â†±ËøΩËπ§ (Phase 4.1)
model EntryFiling {
  id          String   @id @default(uuid()) @db.Uuid
  workerId    String   @unique @map("worker_id") @db.Uuid
  
  // ÂÖ•Â¢ÉË≥áË®ä
  entryDate   DateTime @map("entry_date") @db.Date
  flightNo    String?  @map("flight_no") @db.VarChar(20)
  visaNo      String?  @map("visa_no") @db.VarChar(50)
  
  // 3Êó•ÂÖß: ÂÖ•ÂúãÈÄöÂ†±
  entryReportDate      DateTime? @map("entry_report_date") @db.Date
  entryReportRefNo     String?   @map("entry_report_ref_no") @db.VarChar(50)
  entryReportStatus    String    @default("PENDING") @map("entry_report_status") @db.VarChar(20)
  
  // 3Êó•ÂÖß: ÂÖ•Â¢ÉÂÅ•Ê™¢
  initialExamDate      DateTime? @map("initial_exam_date") @db.Date
  initialExamHospital  String?   @map("initial_exam_hospital") @db.VarChar(100)
  initialExamResult    String?   @map("initial_exam_result") @db.VarChar(20)
  
  // 15Êó•ÂÖß: Â±ÖÁïôË≠âÁî≥Ë´ã
  arcApplyDate         DateTime? @map("arc_apply_date") @db.Date
  arcReceiptNo         String?   @map("arc_receipt_no") @db.VarChar(50)
  arcNo                String?   @map("arc_no") @db.VarChar(20)
  arcStatus            String    @default("PENDING") @map("arc_status") @db.VarChar(20)
  
  // 15Êó•ÂÖß: ËÅòÂÉ±Ë®±ÂèØÁî≥Ë´ã
  permitApplyDate      DateTime? @map("permit_apply_date") @db.Date
  permitReceiptNo      String?   @map("permit_receipt_no") @db.VarChar(50)
  permitNo             String?   @map("permit_no") @db.VarChar(50)
  permitStatus         String    @default("PENDING") @map("permit_status") @db.VarChar(20)
  
  // Êï¥È´îÂêàË¶èÁãÄÊÖã
  overallCompliance    String    @default("PENDING") @map("overall_compliance") @db.VarChar(20)
  
  createdAt   DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt   DateTime  @updatedAt @map("updated_at") @db.Timestamptz
  
  worker      Worker    @relation(fields: [workerId], references: [id])
  
  @@index([overallCompliance])
  @@index([entryDate])
  @@map("entry_filings")
}

// Ë°õÊîøÈÄöÂ†±Áï∞Â∏∏ (Phase 4.2)
model MedicalException {
  id              String   @id @default(uuid()) @db.Uuid
  workerId        String   @map("worker_id") @db.Uuid
  healthCheckId   String?  @map("health_check_id") @db.Uuid
  
  // Áï∞Â∏∏Ë≥áË®ä
  diagnosisDate   DateTime  @map("diagnosis_date") @db.Date
  diseaseType     String    @map("disease_type") @db.VarChar(100)
  description     String?   @db.Text
  
  // ÈÄöÂ†±ÁãÄÊÖã
  healthDeptNotified    Boolean   @default(false) @map("health_dept_notified")
  healthDeptNotifyDate  DateTime? @map("health_dept_notify_date") @db.Date
  employerNotified      Boolean   @default(false) @map("employer_notified")
  employerNotifyDate    DateTime? @map("employer_notify_date") @db.Date
  
  // ËôïÁêÜÁãÄÊÖã
  treatmentStatus   String    @default("PENDING") @map("treatment_status") @db.VarChar(30)
  resolutionDate    DateTime? @map("resolution_date") @db.Date
  remarks           String?   @db.Text
  
  createdAt         DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt         DateTime  @updatedAt @map("updated_at") @db.Timestamptz
  
  worker            Worker       @relation(fields: [workerId], references: [id])
  healthCheck       HealthCheck? @relation(fields: [healthCheckId], references: [id])
  
  @@index([treatmentStatus])
  @@index([diseaseType])
  @@map("medical_exceptions")
}

model WorkerAccommodationHistory {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  workerId    String   @map("worker_id") @db.Uuid
  worker      Worker   @relation(fields: [workerId], references: [id], onDelete: Cascade)
  
  // Accommodation Details
  address        String?  @db.Text
  dormitoryBedId String?  @map("dormitory_bed_id") @db.Uuid
  dormitoryBed   DormitoryBed? @relation(fields: [dormitoryBedId], references: [id])
  
  // Timeline
  startDate   DateTime @map("start_date") @db.Date
  endDate     DateTime? @map("end_date") @db.Date
  
  isCurrent   Boolean  @default(false) @map("is_current")
  
  // Audit
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("worker_accommodation_history")
}

model RelocationNotification {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  workerId    String   @map("worker_id") @db.Uuid
  worker      Worker   @relation(fields: [workerId], references: [id], onDelete: Cascade)
  
  // Addresses
  oldAddress  String?  @map("old_address") @db.Text
  newAddress  String?  @map("new_address") @db.Text
  
  // Government Notification Tracking
  notificationType String   @default("CHANGE_OF_RESIDENCE") @map("notification_type") // e.g., CHANGE_OF_RESIDENCE (ÂãûÂãïÈÉ®/ÁßªÊ∞ëÁΩ≤)
  
  // Timeline tracking
  mailingDate      DateTime? @map("mailing_date") @db.Date
  filingDate       DateTime? @map("filing_date") @db.Date
  
  // Receipt info (Usually from government response)
  receiptDate      DateTime? @map("receipt_date") @db.Date
  receiptNumber    String?   @map("receipt_number") @db.VarChar(50)
  
  status           String    @default("PENDING") @db.VarChar(20) // PENDING, PROCESSING, COMPLETED, REJECTED
  
  notes            String?   @db.Text
  
  createdBy   String?  @map("created_by") @db.Uuid
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("relocation_notifications")
}

model EmployerRecruitmentLetter {
  id         String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  employerId String @map("employer_id") @db.Uuid

  // --- 1. ÊúÄÁµÇÁî¢Âá∫ (ÊãõÂãüÂáΩÊú¨Ë∫´) ---
  letterNumber String   @unique @map("letter_number") @db.VarChar(50) // ÁôºÊñáËôüÁ¢º (ÂãûÂãïÁôº‰∫ãÂ≠ó...)
  issueDate    DateTime @map("issue_date") @db.Date // ÁôºÊñáÊó•Êúü
  expiryDate   DateTime @map("expiry_date") @db.Date // ÊãõÂãüÊïàÊúü
  validUntil   DateTime @default(now()) @map("valid_until") @db.Date // ÊúâÊïàÊúüÈôê (ÈÄöÂ∏∏Âêå expiryDate) - Added default to avoid migration issue on existing rows if any

  // --- [Phase 1 New Relations] ---
  industryRecognitionId String?              @map("industry_recognition_id") @db.Uuid
  industryRecognition   IndustryRecognition? @relation(fields: [industryRecognitionId], references: [id])

  recruitmentProofId String?           @map("recruitment_proof_id") @db.Uuid
  recruitmentProof   RecruitmentProof? @relation(fields: [recruitmentProofId], references: [id])

  // --- 2. Ê≠•È©ü‰∏ÄÔºöÂ∑•Ê•≠Â±ÄÊ†∏ÂÆö (Industrial Bureau) ---
  // [DEPRECATED] Use relation industryRecognition instead
  // Ë≠âÊòé‰Ω†ÊòØ3KÁî¢Ê•≠Ôºå‰∏¶Ê†∏ÂÆöÁ¥öÂà• (A+, A, B, C, D)
  industrialBureauRef  String?   @map("industrial_bureau_ref") @db.VarChar(50) // Â∑•Ê•≠Â±ÄÊ†∏ÂÆöÂáΩËôü
  industrialBureauDate DateTime? @map("industrial_bureau_date") @db.Date // Â∑•Ê•≠Â±ÄÁôºÊñáÊó•
  industryTier         String?   @map("industry_tier") @db.VarChar(10) // Ê†∏ÂÆöÁ¥öÂà• (e.g., "BÁ¥ö")

  // --- 3. Ê≠•È©ü‰∫åÔºöÂúãÂÖßÊ±ÇÊâç (Domestic Recruitment) ---
  // ÂøÖÈ†àÂÖàÂéªÂÖ¨Á´ãÂ∞±Ê•≠ÊúçÂãôÁ´ôÊ±ÇÊâçÔºåÊãøÂà∞„ÄåÊ±ÇÊâçË≠âÊòéÊõ∏„Äç
  domesticRecruitmentRef  String?   @map("domestic_recruitment_ref") @db.VarChar(50) // [Êñ∞] Ê±ÇÊâçË≠âÊòéÊõ∏Â∫èËôü
  domesticRecruitmentDate DateTime? @map("domestic_recruitment_date") @db.Date // [Êñ∞] Ê±ÇÊâçÁôªË®òÊó•/Ë≠âÊòéÊõ∏ÁôºÊñáÊó•

  // --- 4. Ê≠•È©ü‰∏âÔºöË¶èË≤ªÁπ≥Á¥ç (Review Fee) ---
  // Áî≥Ë´ãÊãõÂãüË®±ÂèØÂâçÔºåË¶ÅÂéªÈÉµÂ±ÄÂäÉÊí•ÂØ©Êü•Ë≤ª
  reviewFeeReceiptNo String?   @map("review_fee_receipt_no") @db.VarChar(50) // [Êñ∞] ÂØ©Êü•Ë≤ªÊî∂ÊìöËôüÁ¢º (ÈÉµÊîøÂäÉÊí•ÂñÆËôü)
  reviewFeePayDate   DateTime? @map("review_fee_pay_date") @db.Date // [Êñ∞] Áπ≥Ë≤ªÊó•Êúü
  reviewFeeAmount    Int       @default(200) @map("review_fee_amount") // ÈáëÈ°ç (ÈÄöÂ∏∏ÊØè‰∫∫200ÂÖÉ)

  // --- 5. ÂêçÈ°çËàáË®àÁÆó ---
  approvedQuota Int @default(0) @map("approved_quota") // Ê†∏ÂáÜÂêçÈ°ç (Á∏ΩË®à)
  usedQuota     Int @default(0) @map("used_quota") // Â∑≤Áî®ÂêçÈ°ç (Âø´Âèñ)

  // Legacy / Details
  submissionDate           DateTime? @map("submission_date") @db.Date // ÈÄÅ‰ª∂Êó• (Ë°åÊîøÂ°´ÂØ´)
  laborMinistryReceiptDate DateTime? @map("labor_ministry_receipt_date") @db.Date // ÂãûÂãïÈÉ®Êî∂ÊñáÊó•Êúü

  // --- Legacy / Details ---
  issueUnit  String? @default("ÂãûÂãïÈÉ®") @map("issue_unit") @db.VarChar(50) // ÁôºÊñáÂñÆ‰Ωç
  issueWord  String? @default("ÂãûÂãïÁôº‰∫ãÂ≠ó") @map("issue_word") @db.VarChar(50) // ÁôºÊñáÂ≠ó
  caseNumber String? @map("case_number") @db.VarChar(50) // Ê°àËôü

  // Hierarchy (for split letters)
  parentLetterId String?                     @map("parent_letter_id") @db.Uuid
  parentLetter   EmployerRecruitmentLetter?  @relation("LetterHierarchy", fields: [parentLetterId], references: [id])
  childLetters   EmployerRecruitmentLetter[] @relation("LetterHierarchy")

  // Work Location & Job Info
  workAddress  String? @map("work_address") @db.Text // Â§ñÂãûÂ∑•‰ΩúÂú∞ÂùÄ
  jobType      String? @map("job_type") @db.VarChar(50) // Â∑•Á®Æ‰ª£Á¢º (e.g., Ë£ΩÈÄ†Ê•≠ÂãûÂ∑•)
  jobTitle     String? @map("job_title") @db.VarChar(100) // ËÅ∑ÂãôÂêçÁ®± (e.g., Â°ëËÜ†Áî¢ÂìÅË£ΩÈÄ†ËÅ∑Âì°)
  industryCode String? @map("industry_code") @db.VarChar(50) // ÊâÄÂ±¨Ë°åÊ•≠Âà• (e.g., 22->Â°ëËÜ†Ë£ΩÂìÅ)

  // Project / Bureau Info
  projectCode String? @map("project_code") @db.VarChar(50) // Â∞àÊ°à‰ª£Ëôü (e.g., x1-03...)
  // industrialBureauRef removed as it is defined above

  // Quota Management - Moved to top

  // Gender Constraints (Legacy support)
  quotaMale   Int @default(0) @map("quota_male")
  quotaFemale Int @default(0) @map("quota_female")

  // [NEW] Project & Attributes
  recruitmentProjectType String? @map("recruitment_project_type") @db.VarChar(100) // ÂÖ¨ÂëäÂ∞àÊ°à (LBE24)
  applyForRehiringBonus  Boolean @default(false) @map("apply_for_rehiring_bonus") // ÊâøÊé•ÂÜçÊèêÈ´ò5% (LBE71)

  // [NEW] Industry Link
  industryId String?   @map("industry_id") @db.Uuid
  industry   Industry? @relation(fields: [industryId], references: [id])

  // [NEW] Work Address Logic
  workAddressType      String?          @map("work_address_type") @db.VarChar(50) // FACTORY, COMPANY, FAMILY, OR_APPLICANT
  workAddressFactoryId String?          @map("work_address_factory_id") @db.Uuid
  workAddressFactory   EmployerFactory? @relation("LetterWorkFactory", fields: [workAddressFactoryId], references: [id])

  // Other Attributes
  recruitmentType String?      @map("recruitment_type") @db.VarChar(20) // ÊãõÂãüÂà• (ÂàùÊãõ/ÈáçÊãõ/ÈÅûË£ú)
  nationalityId   String?      @map("nationality_id") @db.Uuid
  nationality     Nationality? @relation(fields: [nationalityId], references: [id])
  // REMOVED: nationality     NationalityType?
  canCirculate    Boolean      @default(true) @map("can_circulate") // ÂèØÂæ™Áí∞Âê¶
  remarks         String?      @db.Text // ÂÇôË®ªË™™Êòé

  // Relations
  employer    Employer     @relation(fields: [employerId], references: [id], onDelete: Cascade)
  deployments Deployment[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Soft Delete
  isDeleted Boolean   @default(false) @map("is_deleted")
  deletedAt DateTime? @map("deleted_at")

  @@map("employer_recruitment_letters")
}

model WorkerPassport {
  id             String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  workerId       String   @map("worker_id") @db.Uuid
  passportNumber String   @map("passport_number") @db.VarChar(50)
  issueDate      DateTime @map("issue_date") @db.Date
  expiryDate     DateTime @map("expiry_date") @db.Date
  issuePlace     String?  @map("issue_place") @db.VarChar(100)
  isCurrent      Boolean  @default(false) @map("is_current")
  isVerified     Boolean  @default(false) @map("is_verified") // Added for verification

  worker Worker @relation(fields: [workerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("worker_passports")
}

model WorkerArc {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  workerId   String   @map("worker_id") @db.Uuid
  arcNumber  String   @map("arc_number") @db.VarChar(50)
  issueDate  DateTime @map("issue_date") @db.Date
  expiryDate DateTime @map("expiry_date") @db.Date
  isCurrent  Boolean  @default(false) @map("is_current")
  isVerified Boolean  @default(false) @map("is_verified") // Added for verification

  worker Worker @relation(fields: [workerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("worker_arcs")
}

model Deployment {
  id                  String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  workerId            String  @map("worker_id") @db.Uuid
  employerId          String  @map("employer_id") @db.Uuid
  recruitmentLetterId String? @map("recruitment_letter_id") @db.Uuid

  startDate     DateTime             @map("start_date") @db.Date
  endDate       DateTime?            @map("end_date") @db.Date
  status        DeploymentStatus     @default(active)
  serviceStatus ServiceStatus        @default(active_service) @map("service_status")
  sourceType    ManagementSourceType @default(direct_hiring) @map("source_type")

  jobDescription    String?   @map("job_description") @db.Text
  entryDate         DateTime? @map("entry_date") @db.Date
  // [New] Handover Date (‰∫§Â∑•Êó•)
  handoverDate      DateTime? @map("handover_date") @db.Date
  entryReportSerial String?   @map("entry_report_serial") @db.VarChar(50)
  flightNumber      String?   @map("flight_number") @db.VarChar(20)
  flightArrivalDate DateTime? @map("flight_arrival_date") @db.Date
  visaLetterNo      String?   @map("visa_letter_no") @db.VarChar(50)
  jobType           String?   @map("job_type") @db.VarChar(50)
  shift             String?   @map("shift") @db.VarChar(50)

  // Overseas Recruitment Workflow Fields
  overseasCheckStatus String?   @map("overseas_check_status") @db.VarChar(20)
  overseasCheckDate   DateTime? @map("overseas_check_date") @db.Date

  // [Added] Dynamic Contract Type
  contractTypeId String?       @map("contract_type_id") @db.Uuid
  contractType   ContractType? @relation(fields: [contractTypeId], references: [id])

  // [NEW] Dynamic Termination Reason
  contractEndReasonId String?            @map("contract_end_reason_id") @db.Uuid
  contractEndReason   ContractEndReason? @relation(fields: [contractEndReasonId], references: [id])

  docVerificationStatus String?   @map("doc_verification_status") @db.VarChar(20)
  docSubmissionDate     DateTime? @map("doc_submission_date") @db.Date
  docVerifiedDate       DateTime? @map("doc_verified_date") @db.Date
  visaStatus            String?   @map("visa_status") @db.VarChar(20)
  visaApplicationDate   DateTime? @map("visa_application_date") @db.Date
  visaNumber            String?   @map("visa_number") @db.VarChar(50)

  // Termination Information
  terminationReason String? @map("termination_reason") @db.VarChar(50)
  terminationNotes  String? @map("termination_notes") @db.Text

  // Contract / Salary Info
  basicSalary Decimal? @map("basic_salary") @db.Decimal(10, 2)
  foodAmount  Decimal? @map("food_amount") @db.Decimal(10, 2)
  foodStatus  String?  @map("food_status") @db.VarChar(50)

  // [New] Specific Factory Location
  factoryId String?          @map("factory_id") @db.Uuid
  factory   EmployerFactory? @relation(fields: [factoryId], references: [id])

  worker            Worker                     @relation(fields: [workerId], references: [id])
  employer          Employer                   @relation(fields: [employerId], references: [id])
  recruitmentLetter EmployerRecruitmentLetter? @relation(fields: [recruitmentLetterId], references: [id])

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  healthChecks  HealthCheck[]
  permitDetails WorkerPermitDetail[]
  insurances    WorkerInsurance[]
  billingPlan   BillingPlan?

  // Soft Delete
  isDeleted Boolean   @default(false) @map("is_deleted")
  deletedAt DateTime? @map("deleted_at")

  @@map("deployments")
}

// ==========================================
// [Phase 1] Pre-Permit / Component Documents
// ==========================================

model IndustryRecognition {
  id         String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  employerId String  @map("employer_id") @db.Uuid
  factoryId  String? @map("factory_id") @db.Uuid // Optional: link to specific factory if multi-site

  bureauRefNumber String   @unique @map("bureau_ref_number") @db.VarChar(50) // Â∑•Ê•≠Â±ÄÂáΩËôü
  issueDate       DateTime @map("issue_date") @db.Date // ÁôºÊñáÊó•Êúü

  // Tier Management
  tier           String    @map("tier") @db.VarChar(10) // A+, A, B, C, D
  expiryDate     DateTime? @map("expiry_date") @db.Date // ÊïàÊúü (usually 3 years?)
  allocationRate Decimal?  @map("allocation_rate") @db.Decimal(5, 2) // e.g. 0.20
  extraRate      Decimal?  @default(0) @map("extra_rate") @db.Decimal(5, 2) // [NEW] Extra Quota Rate (e.g. 0.20)

  fileUrl String? @map("file_url") @db.Text

  // Stats
  approvedQuota Int @default(0) @map("approved_quota")
  usedQuota     Int @default(0) @map("used_quota")

  employer        Employer         @relation(fields: [employerId], references: [id], onDelete: Cascade)
  employerFactory EmployerFactory? @relation(fields: [factoryId], references: [id])

  // Relations
  recruitmentLetters EmployerRecruitmentLetter[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Soft Delete
  isDeleted Boolean   @default(false) @map("is_deleted")
  deletedAt DateTime? @map("deleted_at")

  @@map("industry_recognitions")
}

model RecruitmentProof {
  id         String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  employerId String @map("employer_id") @db.Uuid

  receiptNumber String   @unique @map("receipt_number") @db.VarChar(50) // Ê±ÇÊâçË≠âÊòéÂ∫èËôü
  registerDate  DateTime @map("register_date") @db.Date // Ê±ÇÊâçÁôªË®òÊó•
  issueDate     DateTime @map("issue_date") @db.Date // Ë≠âÊòéÊõ∏ÁôºÊñáÊó•

  jobCenter String? @map("job_center") @db.VarChar(50) // ÂèóÁêÜÂÖ¨Á´ãÂ∞±Ê•≠ÊúçÂãôÊ©üÊßã
  status    String  @default("VALID") @db.VarChar(20) // VALID, EXPIRED, USED

  // Fees
  reviewFeeReceiptNo String?   @map("review_fee_receipt_no") @db.VarChar(50) // ÂØ©Êü•Ë≤ªÊî∂ÊìöËôüÁ¢º
  reviewFeePayDate   DateTime? @map("review_fee_pay_date") @db.Date

  employer Employer @relation(fields: [employerId], references: [id], onDelete: Cascade)

  // Relations
  recruitmentLetters EmployerRecruitmentLetter[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("recruitment_proofs")
}

model PermitDocument {
  id               String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  employerId       String   @map("employer_id") @db.Uuid
  permitNumber     String   @unique @map("permit_number") @db.VarChar(50)
  issueDate        DateTime @map("issue_date") @db.Date
  issuingAuthority String?  @map("issuing_authority") @db.VarChar(100)

  employer Employer @relation(fields: [employerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  workerPermitDetails WorkerPermitDetail[]

  @@map("permit_documents")
}

model WorkerPermitDetail {
  id               String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  permitDocumentId String     @map("permit_document_id") @db.Uuid
  deploymentId     String     @map("deployment_id") @db.Uuid
  permitType       PermitType @map("permit_type")
  startDate        DateTime   @map("start_date") @db.Date
  endDate          DateTime   @map("end_date") @db.Date

  permitDocument PermitDocument @relation(fields: [permitDocumentId], references: [id], onDelete: Cascade)
  deployment     Deployment     @relation(fields: [deploymentId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("worker_permit_details")
}

model HealthCheck {
  id           String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  workerId     String            @map("worker_id") @db.Uuid
  deploymentId String            @map("deployment_id") @db.Uuid
  checkType    HealthCheckType   @map("check_type")
  checkDate    DateTime          @map("check_date") @db.Date
  hospitalName String?           @map("hospital_name") @db.VarChar(100)
  result       HealthCheckResult @default(pending)
  reportDate   DateTime?         @map("report_date") @db.Date
  failReason   String?           @map("fail_reason") @db.Text

  worker     Worker     @relation(fields: [workerId], references: [id], onDelete: Cascade)
  deployment Deployment @relation(fields: [deploymentId], references: [id], onDelete: Cascade)
  
  medicalExceptions MedicalException[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("health_checks")
}

model Incident {
  id            String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  workerId      String?          @map("worker_id") @db.Uuid
  employerId    String?          @map("employer_id") @db.Uuid
  description   String           @db.Text
  severityLevel IncidentSeverity @map("severity_level")
  status        IncidentStatus   @default(open)
  incidentDate  DateTime         @default(now()) @map("incident_date") @db.Timestamptz

  isAutoGenerated Boolean @default(false) @map("is_auto_generated")
  sourceRefId     String? @map("source_ref_id") @db.Uuid
  category        String? @map("category") @db.VarChar(50)

  worker   Worker?   @relation(fields: [workerId], references: [id])
  employer Employer? @relation(fields: [employerId], references: [id])

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("incidents")
}

model ServiceAssignment {
  id             String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  employerId     String?       @map("employer_id") @db.Uuid
  workerId       String?       @map("worker_id") @db.Uuid
  internalUserId String        @map("internal_user_id") @db.Uuid
  role           StaffRoleType
  startDate      DateTime      @default(now()) @map("start_date") @db.Date
  endDate        DateTime?     @map("end_date") @db.Date
  notes          String?       @db.Text

  employer     Employer?    @relation(fields: [employerId], references: [id], onDelete: Cascade)
  worker       Worker?      @relation(fields: [workerId], references: [id], onDelete: Cascade)
  internalUser InternalUser @relation("ServiceAssignedUser", fields: [internalUserId], references: [id])

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  @@map("service_assignments")
}

model WorkerInsurance {
  id            String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  workerId      String        @map("worker_id") @db.Uuid
  deploymentId  String?       @map("deployment_id") @db.Uuid
  type          InsuranceType
  providerName  String?       @map("provider_name") @db.VarChar(50)
  policyNumber  String?       @map("policy_number") @db.VarChar(50)
  insuredAmount Decimal?      @map("insured_amount") @db.Decimal(10, 2)
  startDate     DateTime      @map("start_date") @db.Date
  endDate       DateTime?     @map("end_date") @db.Date

  worker     Worker      @relation(fields: [workerId], references: [id], onDelete: Cascade)
  deployment Deployment? @relation(fields: [deploymentId], references: [id])

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("worker_insurances")
}

model WorkerAddressHistory {
  id            String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  workerId      String      @map("worker_id") @db.Uuid
  addressType   AddressType @map("address_type")
  addressDetail String      @map("address_detail") @db.Text
  startDate     DateTime    @map("start_date") @db.Date
  endDate       DateTime?   @map("end_date") @db.Date

  worker Worker @relation(fields: [workerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  @@map("worker_address_history")
}

model JobOrder {
  id                       String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  employerId               String         @map("employer_id") @db.Uuid
  
  // Basic Info (Added for Phase 0.2)
  title       String   @default("General Worker") @db.VarChar(200)
  description String?  @db.Text
  skillRequirements String? @map("skill_requirements") @db.Text
  workLocation String?  @map("work_location") @db.VarChar(200)
  jobType      String?  @map("job_type") @db.VarChar(100)
  requiredCount Int    @map("required_count") @default(1)

  // Legacy/Other Fields
  orderDate                DateTime       @default(now()) @map("order_date") @db.Date
  requiredWorkers          Int            @map("required_workers") @default(1)
  expectedArrivalDate      DateTime?      @map("expected_arrival_date") @db.Date
  localRecruitmentDeadline DateTime?      @map("local_recruitment_deadline") @db.Date
  status                   JobOrderStatus @default(open)
  jobCenter                String?        @map("job_center") @db.VarChar(100)

  // ÈúÄÊ±ÇÂÅèÂ•Ω (Preference Fields)
  nationalityPreference    String?        @map("nationality_preference") @db.VarChar(50) // ÂúãÁ±çÂÅèÂ•Ω (e.g., "VN,PH,ID")
  genderPreference         GenderType?    @map("gender_preference") // ÊÄßÂà•ÂÅèÂ•Ω
  filledCount              Int            @default(0) @map("filled_count") // Â∑≤ÈåÑÂèñ‰∫∫Êï∏

  employer Employer @relation(fields: [employerId], references: [id], onDelete: Cascade)

  createdBy     String?       @map("created_by") @db.Uuid
  updatedBy     String?       @map("updated_by") @db.Uuid
  createdByUser InternalUser? @relation("JobOrderCreatedBy", fields: [createdBy], references: [id])
  updatedByUser InternalUser? @relation("JobOrderUpdatedBy", fields: [updatedBy], references: [id])

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  interviews Interview[]

  // Soft Delete
  isDeleted Boolean   @default(false) @map("is_deleted")
  deletedAt DateTime? @map("deleted_at")

  @@map("job_orders")
}

model WorkerEvent {
  id        String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  workerId  String          @map("worker_id") @db.Uuid
  eventType WorkerEventType @map("event_type")

  eventDate  DateTime? @map("event_date") @db.Date // ÁôºÁîüÊó•Êúü
  reportDate DateTime? @map("report_date") @db.Date // ÈÄöÂ†±Êó•Êúü/ÁôªË®òÊó•

  bureauRefNumber String?   @map("bureau_ref_number") @db.VarChar(50) // Ê†∏ÂÇôÊñáËôü
  bureauRefDate   DateTime? @map("bureau_ref_date") @db.Date // Ê†∏ÂÇôÂáΩÊñáÊó•Êúü

  notes   String? @db.Text
  fileUrl String? @map("file_url") @db.Text

  worker Worker @relation(fields: [workerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("worker_events")
}

model Interview {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  jobOrderId    String   @map("job_order_id") @db.Uuid
  interviewDate DateTime @map("interview_date") @db.Timestamptz
  location      String?  @db.Text
  interviewer   String?  @db.VarChar(100)

  jobOrder JobOrder @relation(fields: [jobOrderId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  candidates InterviewCandidate[]

  @@map("interviews")
}

model InterviewCandidate {
  id          String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  interviewId String          @map("interview_id") @db.Uuid
  
  // Link to Candidate OR Worker
  candidateId String?         @map("candidate_id") @db.Uuid
  workerId    String?         @map("worker_id") @db.Uuid
  
  result      CandidateResult @default(pending)
  remarks     String?         @db.Text

  interview Interview  @relation(fields: [interviewId], references: [id], onDelete: Cascade)
  candidate Candidate? @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  worker    Worker?    @relation(fields: [workerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@unique([interviewId, workerId])
  @@map("interview_candidates")
}



model Attachment {
  id       String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  refId    String @map("ref_id") @db.Uuid
  refTable String @map("ref_table") @db.VarChar(50)

  filePath String  @map("file_path") @db.Text
  fileName String  @map("file_name") @db.VarChar(255)
  fileType String? @map("file_type") @db.VarChar(100)

  uploaderId String?  @map("uploader_id") @db.Uuid
  uploadedAt DateTime @default(now()) @map("uploaded_at") @db.Timestamptz

  @@index([refTable, refId])
  @@map("attachments")
}

model Hospital {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code       String?   @unique @db.VarChar(50)
  name       String    @db.VarChar(255)
  // [Added] Basic Info
  shortName  String?   @map("short_name") @db.VarChar(50) // LBB04
  address    String?   @db.Text // LBB06
  city       String?   @db.VarChar(50)
  country    String?   @db.VarChar(50)
  validUntil DateTime? @map("valid_until") @db.Date

  // [Added] Contact Info
  phone         String? @db.VarChar(50) // LBB07
  fax           String? @db.VarChar(50) // LBB10
  contactPerson String? @map("contact_person") @db.VarChar(50) // LBB09

  // [Added] Legacy / Config
  assessmentCode String? @map("assessment_code") @db.VarChar(50) // LBB11
  sortOrder      Int     @default(999) @map("sort_order") // LBB12

  isGeneral  Boolean @default(false) @map("is_general")
  isXray     Boolean @default(false) @map("is_xray")
  isOverseas Boolean @default(false) @map("is_overseas")

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("hospitals")
}

// Tax Configuration (Annual Parameters)
model TaxConfig {
  id                         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  year                       Int      @unique
  minWage                    Int      @map("min_wage")
  minWageThresholdMultiplier Float    @default(1.5) @map("min_wage_threshold_multiplier")
  standardDeduction          Int      @map("standard_deduction")
  salaryDeduction            Int      @map("salary_deduction")
  personalExemption          Int      @map("personal_exemption")
  taxRateResident            Float    @map("tax_rate_resident")
  nonResidentLowRate         Float    @map("non_resident_low_rate")
  nonResidentHighRate        Float    @map("non_resident_high_rate")
  effectiveDate              DateTime @map("effective_date") @db.Date
  notes                      String?  @db.Text

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("tax_configs")
}

model IncomeTaxCategory {
  id   String @id @default(uuid()) @db.Uuid
  code String @unique @db.VarChar(10) // e.g., "50", "9A"

  name   String  @db.VarChar(100) // e.g., "Ëñ™Ë≥áÊâÄÂæó"
  nameEn String? @map("name_en") @db.VarChar(100)

  // Tax Rates
  taxRateNonResident Decimal @default(0) @map("tax_rate_non_resident") @db.Decimal(5, 2) // e.g., 20.00

  description String? @db.Text
  sortOrder   Int     @default(0) @map("sort_order")
  isActive    Boolean @default(true) @map("is_active")

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@map("income_tax_categories")
}

// Fee Items (Official Fees by Nationality)
model ReceivableItem {
  id   String @id @default(uuid()) @db.Uuid
  code String @unique @db.VarChar(20) // LAA01: Item Code

  // Names (Multi-language)
  nameZh String  @map("name_zh") @db.VarChar(100) // LAA02
  nameEn String  @map("name_en") @db.VarChar(100) // LAA02_2
  nameTh String? @map("name_th") @db.VarChar(100) // LAA02_1
  nameId String? @map("name_id") @db.VarChar(100) // LAA02_3
  nameVn String? @map("name_vn") @db.VarChar(100) // LAA02_4

  // Accounting Settings
  debitAccountCode  String? @map("debit_account_code") @db.VarChar(50) // LAA12
  creditAccountCode String? @map("credit_account_code") @db.VarChar(50) // LAA16

  // Type & Config
  itemCategory       String? @map("item_category") @db.VarChar(50) // LAA13 (e.g., "flight", "medical", "service_fee")
  isDailyCalculation Boolean @default(false) @map("is_daily_calculation") // LAA14
  isActive           Boolean @default(true) @map("is_active") // LAA15

  // Relations
  pricingRules ReceivablePricingRule[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("receivable_items")
}

model ReceivablePricingRule {
  id     String         @id @default(uuid()) @db.Uuid
  itemId String         @map("item_id") @db.Uuid
  item   ReceivableItem @relation(fields: [itemId], references: [id], onDelete: Cascade)

  // --- Conditions (Null = "Any") ---
  // REMOVED: nationality    NationalityType? // Enum: VN, ID, PH, TH...
  nationalityId String?      @map("nationality_id") @db.Uuid
  nationality   Nationality? @relation(fields: [nationalityId], references: [id])
  // REMOVED: nationality    NationalityType?
  gender        GenderType? // Enum: male, female
  employerId    String?      @map("employer_id") @db.Uuid // Special price for specific employer

  // Tenure-based pricing (e.g., Year 1 vs Year 2 service fee)
  minTenureMonths Int? @map("min_tenure_months") // e.g., 1 (Month 1-12)
  maxTenureMonths Int? @map("max_tenure_months") // e.g., 12

  // --- Price ---
  amount      Decimal @db.Decimal(10, 2)
  description String? @db.Text // Internal note for this rule

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Indexes for fast lookup
  @@index([itemId])
  @@index([employerId])
  @@map("receivable_pricing_rules")
}

// Insurance Tiers (Labor + Health Insurance Rates by Salary Grade)
model InsuranceTier {
  id        String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  grade     Int    @unique
  minSalary Int    @map("min_salary")
  maxSalary Int    @map("max_salary")
  laborFee  Int    @map("labor_fee")
  healthFee Int    @map("health_fee")

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("insurance_tiers")
}

// ==========================================
// Document System (Dynamic & Multi-language)
// ==========================================

model Nationality {
  id     String  @id @default(uuid()) @db.Uuid
  code   String  @unique @db.VarChar(10) // e.g., "PH", "VN", "TH"
  name   String  @db.VarChar(100) // Local Name (e.g., "Philippines")
  nameZh String  @map("name_zh") @db.VarChar(100) // "Ëè≤ÂæãË≥ì"
  nameEn String? @map("name_en") @db.VarChar(100)

  countryCode String? @map("country_code") @db.VarChar(3) // ISO Code
  sortOrder   Int     @default(0) @map("sort_order")
  isActive    Boolean @default(true) @map("is_active")

  // Relations
  workers            Worker[]
  templates          DocumentTemplate[]
  // [Added] Inverse relations
  pricingRules       ReceivablePricingRule[]
  recruitmentLetters EmployerRecruitmentLetter[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@map("nationalities")
}

model DocumentRequirement {
  id       String  @id @default(uuid()) @db.Uuid
  code     String  @unique @db.VarChar(50) // e.g., "LABOR_CONTRACT"
  name     String  @db.VarChar(100) // e.g., "ÂãûÂãïÂ•ëÁ¥Ñ"
  category String? @db.VarChar(50) // e.g., "Entry", "Medical"

  isRequired Boolean @default(false) @map("is_required")

  templates DocumentTemplate[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@map("document_requirements")
}

// Document Templates (Physical Files)
model DocumentTemplate {
  id       String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name     String @db.VarChar(255) // Specific version name e.g. "Labor Contract (Thai)"
  filePath String @map("file_path") @db.Text

  // Ê™îÊ°àÊ†ºÂºèË≥áË®ä (File Format Info)
  fileFormat   String? @map("file_format") @db.VarChar(20)   // docx, xlsx, odt, pdf
  mimeType     String? @map("mime_type") @db.VarChar(100)
  originalName String? @map("original_name") @db.VarChar(255)

  // Placeholder Ë®≠ÂÆö (JSON Ê†ºÂºèÂÑ≤Â≠òÊ¨Ñ‰ΩçÂ∞çÊáâ)
  placeholderSchema Json? @map("placeholder_schema")

  // Links
  documentRequirementId String?              @map("document_requirement_id") @db.Uuid
  documentRequirement   DocumentRequirement? @relation(fields: [documentRequirementId], references: [id])

  nationalityId String?      @map("nationality_id") @db.Uuid
  nationality   Nationality? @relation(fields: [nationalityId], references: [id])

  language String? @db.VarChar(20) // e.g., "zh-TW", "en", "th"
  version  String? @db.VarChar(20) // e.g., "v1.0"

  isActive    Boolean @default(true) @map("is_active")
  description String? @db.Text
  category    String? @db.VarChar(50)

  // Relations
  generatedDocuments GeneratedDocument[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("document_templates")
}

// Â∑≤Áî¢ÁîüÊñá‰ª∂ËøΩËπ§ (Generated Document Tracking)
model GeneratedDocument {
  id         String           @id @default(uuid()) @db.Uuid
  templateId String           @map("template_id") @db.Uuid
  template   DocumentTemplate @relation(fields: [templateId], references: [id])

  // ÈóúËÅØÂ∞çË±°
  workerId   String? @map("worker_id") @db.Uuid
  employerId String? @map("employer_id") @db.Uuid

  // Ê™îÊ°àË≥áË®ä
  fileName String  @map("file_name") @db.VarChar(255)
  filePath String  @map("file_path") @db.Text
  fileSize Int?    @map("file_size")

  // Áî¢ÁîüÁãÄÊÖã
  status       String  @default("SUCCESS") @db.VarChar(20) // SUCCESS, FAILED
  errorMessage String? @map("error_message") @db.Text

  generatedAt DateTime @default(now()) @map("generated_at") @db.Timestamptz
  generatedBy String?  @map("generated_by") @db.Uuid

  @@index([workerId])
  @@index([employerId])
  @@index([templateId])
  @@map("generated_documents")
}


model AgencyCompany {
  id                String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name              String  @db.VarChar(100)
  licenseNo         String? @map("license_no") @db.VarChar(50)
  taxId             String? @map("tax_id") @db.VarChar(20)
  address           String? @db.Text
  phone             String? @db.VarChar(20)
  fax               String? @db.VarChar(20)
  email             String? @db.VarChar(100)
  responsiblePerson String? @map("responsible_person") @db.VarChar(50)
  isDefault         Boolean @default(false) @map("is_default")

  employers Employer[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("agency_companies")
}

model ForeignAgency {
  id      String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name    String  @db.VarChar(100)
  code    String? @db.VarChar(50)
  address String? @db.Text
  country String? @db.VarChar(50)

  workers Worker[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("foreign_agencies")
}

model PayrollRecord {
  id       String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  workerId String @map("worker_id") @db.Uuid
  worker   Worker @relation(fields: [workerId], references: [id], onDelete: Cascade)

  payDate      DateTime @map("pay_date") @db.Date
  salaryAmount Decimal  @map("salary_amount") @db.Decimal(10, 2)
  bonusAmount  Decimal  @map("bonus_amount") @db.Decimal(10, 2)
  taxWithheld  Decimal  @map("tax_withheld") @db.Decimal(10, 2)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("payroll_records")
}

model Dormitory {
  id                  String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                String    @db.VarChar(100)
  address             String?   @db.Text
  landlordName        String?   @map("landlord_name") @db.VarChar(50)
  accommodationType   String?   @map("accommodation_type") @db.VarChar(50)
  
  // [New] Fee Standards
  rentFee       Int @default(0) @map("rent_fee")
  managementFee Int @default(0) @map("management_fee")

  totalArea           Decimal?  @map("total_area") @db.Decimal(10, 2)
  capacity            Int?      @default(0)
  bathroomCount       Int?      @default(0) @map("bathroom_count")
  waterHeaterCount    Int?      @default(0) @map("water_heater_count")
  hasFireExtinguisher Boolean   @default(false) @map("has_fire_extinguisher")
  hasFireAlarm        Boolean   @default(false) @map("has_fire_alarm")
  fireSafetyExpiry    DateTime? @map("fire_safety_expiry") @db.Date

  rooms DormitoryRoom[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("dormitories")
}

model DormitoryRoom {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  dormitoryId String   @map("dormitory_id") @db.Uuid
  roomNumber  String   @map("room_number") @db.VarChar(20)
  capacity    Int      @default(0)
  area        Decimal? @db.Decimal(10, 2) // Added for compliance checks

  dormitory Dormitory      @relation(fields: [dormitoryId], references: [id], onDelete: Cascade)
  beds      DormitoryBed[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("dormitory_rooms")
}

model DormitoryBed {
  id         String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  roomId     String  @map("room_id") @db.Uuid
  bedCode    String  @map("bed_code") @db.VarChar(20)
  isOccupied Boolean @default(false) @map("is_occupied")

  room   DormitoryRoom @relation(fields: [roomId], references: [id], onDelete: Cascade)
  worker Worker?
  accommodationHistory WorkerAccommodationHistory[]

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("dormitory_beds")
}

// ... existing code ...

model ComplianceRule {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code          String   @unique @db.VarChar(50)
  value         String   @db.VarChar(255)
  category      String   @db.VarChar(50)
  description   String?  @db.Text
  effectiveDate DateTime @default(now()) @map("effective_date") @db.Date

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("compliance_rules")
}

model OfficialAgency {
  id      String  @id @default(uuid()) @db.Uuid
  code    String  @unique @db.VarChar(50) // e.g., "MOL", "NIA"
  name    String  @db.VarChar(100) // e.g., "Ministry of Labor"
  nameEn  String? @map("name_en") @db.VarChar(100)
  address String? @db.Text
  phone   String? @db.VarChar(50)
  website String? @db.VarChar(200)

  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  personnel OfficialAgencyPerson[]

  @@map("official_agencies")
}

model OfficialAgencyPerson {
  id       String         @id @default(uuid()) @db.Uuid
  agencyId String         @map("agency_id") @db.Uuid
  agency   OfficialAgency @relation(fields: [agencyId], references: [id], onDelete: Cascade)

  // Personal Info
  name    String  @db.VarChar(50)
  nameEn  String? @map("name_en") @db.VarChar(100)
  title   String? @db.VarChar(100) // e.g., "Minister", "Director"
  titleEn String? @map("title_en") @db.VarChar(100)

  // Tenure & Status
  startDate DateTime? @map("start_date") @db.Date
  endDate   DateTime? @map("end_date") @db.Date

  // Delegate/Acting Logic
  isActing    Boolean @default(false) @map("is_acting") // ‰ª£Ë°å
  actingNotes String? @map("acting_notes") @db.Text // ‰ª£Ë°åË™™Êòé

  sortOrder Int     @default(0) @map("sort_order")
  isActive  Boolean @default(true) @map("is_active")

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@map("official_agency_personnel")
}

model ContractEndReason {
  id     String  @id @default(uuid()) @db.Uuid
  code   String  @unique @db.VarChar(50) // e.g., "HAA", "HEE"
  name   String  @db.VarChar(100) // e.g., "ËÅòÂÉ±ÊúüÊªø"
  nameEn String? @map("name_en") @db.VarChar(100)

  description String? @db.Text

  // Logic Helpers
  isAbnormal Boolean @default(false) @map("is_abnormal") // e.g., Runaway, Repatriated
  category   String? @db.VarChar(50) // e.g., "Medical", "Performance", "Legal", "Personal"

  sortOrder Int     @default(0) @map("sort_order")
  isActive  Boolean @default(true) @map("is_active")

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  deployments Deployment[]

  @@map("contract_end_reasons")
}

model OfficialDocument {
  id         String   @id @default(uuid()) @db.Uuid
  employerId String   @map("employer_id") @db.Uuid
  employer   Employer @relation(fields: [employerId], references: [id], onDelete: Cascade)

  // Optional: Link to a specific worker (e.g., Runaway letter for Worker A)
  workerId String? @map("worker_id") @db.Uuid
  worker   Worker? @relation(fields: [workerId], references: [id])

  // Document Info
  documentType String    @map("document_type") @db.VarChar(50) // e.g., "RUNAWAY", "TRANSFER", "INDUSTRIAL_BUREAU"
  docNumber    String    @map("doc_number") @db.VarChar(50) // ÂáΩÊñáËôüÁ¢º
  issueDate    DateTime  @map("issue_date") @db.Date // ÁôºÊñáÊó•Êúü
  expiryDate   DateTime? @map("expiry_date") @db.Date // ÊïàÊúü

  issuingAgency String? @map("issuing_agency") @db.VarChar(100) // ÁôºÊñáÂñÆ‰Ωç (e.g., ÂãûÂãïÈÉ®)
  title         String? @db.VarChar(200) // ÂáΩÊñáË™™Êòé/Ê®ôÈ°å
  description   String? @db.Text

  // File Link (for uploaded PDF)
  filePath String? @map("file_path") @db.Text

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@index([employerId])
  @@index([workerId])
  @@index([docNumber])
  @@map("official_documents")
}


// ==========================================
// Billing Plan Models (Concrete Instances)
// ==========================================

enum BillingPlanStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED

  @@map("billing_plan_status")
}

enum BillingItemCategory {
  SERVICE_FEE     // ÊúçÂãôË≤ª
  ARC_FEE         // Â±ÖÁïôË≠âË≤ª
  HEALTH_CHECK_FEE // È´îÊ™¢Ë≤ª
  DORMITORY_FEE   // ÂÆøËàçË≤ª
  OTHER           // ÂÖ∂‰ªñ

  @@map("billing_item_category")
}

enum BillingItemStatus {
  PENDING
  GENERATED
  BILLED
  CANCELLED

  @@map("billing_item_status")
}

enum BillingReviewStatus {
  NORMAL
  NEEDS_REVIEW

  @@map("billing_review_status")
}

model BillingPlan {
  id           String @id @default(uuid()) @db.Uuid
  deploymentId String @unique @map("deployment_id") @db.Uuid
  deployment   Deployment @relation(fields: [deploymentId], references: [id], onDelete: Cascade)

  totalAmount Int               @default(0) @map("total_amount")
  status      BillingPlanStatus @default(PENDING)

  // Review Mechanism
  reviewStatus BillingReviewStatus @default(NORMAL) @map("review_status")
  reviewReason String?             @map("review_reason") @db.VarChar(255)

  notes String? @db.Text

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  items BillingPlanItem[]

  @@map("billing_plans")
}

model BillingPlanItem {
  id            String @id @default(uuid()) @db.Uuid
  billingPlanId String @map("billing_plan_id") @db.Uuid
  billingPlan   BillingPlan @relation(fields: [billingPlanId], references: [id], onDelete: Cascade)

  billingDate  DateTime            @map("billing_date") @db.Date // È†êË®àÊî∂Ê¨æÊó• (e.g. 2024-01-10)
  amount       Int                 @default(0)
  itemCategory BillingItemCategory @map("item_category")
  status       BillingItemStatus   @default(GENERATED)
  
  isProrated   Boolean             @default(false) @map("is_prorated") // ÊòØÂê¶ÁÇ∫Á†¥Êúà
  description  String?             @db.VarChar(200)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  logs      BillingModificationLog[]

  @@index([billingPlanId])
  @@index([billingDate])
  @@map("billing_plan_items")
}

model BillingModificationLog {
  id          String   @id @default(uuid()) @db.Uuid
  planItemId  String   @map("plan_item_id") @db.Uuid
  
  oldAmount   Int      @map("old_amount")
  newAmount   Int      @map("new_amount")
  
  reason      String?  @db.VarChar(255)
  modifiedBy  String?  @map("modified_by") @db.VarChar(100)
  modifiedAt  DateTime @default(now()) @map("modified_at") @db.Timestamptz

  item        BillingPlanItem @relation(fields: [planItemId], references: [id], onDelete: Cascade)

  @@map("billing_modification_logs")
}


// ==========================================
// Candidate Management (Phase 0)
// ==========================================

enum CandidateStatus {
  NEW
  INTERVIEW
  SELECTED
  REJECTED
  WITHDRAWN

  @@map("candidate_status")
}

model Candidate {
  id          String   @id @default(uuid()) @db.Uuid
  
  // Basic Info
  nameZh      String   @map("name_zh") @db.VarChar(100)
  nameEn      String?  @map("name_en") @db.VarChar(100)
  gender      GenderType
  birthDate   DateTime @map("birth_date") @db.Date
  nationality String   @map("nationality") @db.VarChar(3) // ISO 3166-1 alpha-3
  
  // Passport
  passportNo  String   @unique @map("passport_no") @db.VarChar(50)
  passportExpiry DateTime? @map("passport_expiry") @db.Date
  
  // Physical
  height      Int?     // cm
  weight      Int?     // kg
  bloodType   String?  @map("blood_type") @db.VarChar(5)
  
  // Background
  maritalStatus    String?  @map("marital_status") @db.VarChar(20) // SINGLE, MARRIED, DIVORCED
  education        String?  @db.VarChar(100)
  skills           String?  @db.Text // JSON array or comma-separated
  workExperience   String?  @map("work_experience") @db.Text
  
  // Status
  status      CandidateStatus @default(NEW)
  remarks     String?  @db.Text
  
  // Source tracking
  sourceAgencyId String? @map("source_agency_id") @db.Uuid
  importDate     DateTime @default(now()) @map("import_date") @db.Timestamptz
  
  // Timestamps
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt   DateTime @updatedAt @map("updated_at") @db.Timestamptz
  
  // Relations
  interviewCandidates InterviewCandidate[]
  overseasProgress    OverseasProgress?

  @@index([passportNo])
  @@index([status])
  @@index([nationality])
  @@map("candidates")
}

// Êµ∑Â§ñÈÄ≤Â∫¶ËøΩËπ§
model OverseasProgress {
  id              String   @id @default(uuid()) @db.Uuid
  candidateId     String   @unique @map("candidate_id") @db.Uuid
  
  // Êµ∑Â§ñÈ´îÊ™¢
  medicalExamDate     DateTime? @map("medical_exam_date") @db.Date
  medicalExamResult   String?   @map("medical_exam_result") @db.VarChar(50) // PASS/FAIL/PENDING
  medicalExamRemarks  String?   @map("medical_exam_remarks") @db.Text
  
  // ËâØÊ∞ëË≠â
  policeClrDate       DateTime? @map("police_clr_date") @db.Date
  policeClrStatus     String?   @map("police_clr_status") @db.VarChar(50) // ISSUED/PENDING/REJECTED
  policeClrRemarks    String?   @map("police_clr_remarks") @db.Text
  
  // Ë≠∑ÁÖßÊ™¢Êü•
  passportChecked     Boolean   @default(false) @map("passport_checked")
  passportExpiryOk    Boolean   @default(false) @map("passport_expiry_ok")
  passportRemarks     String?   @map("passport_remarks") @db.Text
  
  // ËàäÂ±ÖÁïôË≠âÊ™¢Êü•
  arcChecked          Boolean   @default(false) @map("arc_checked")
  arcHasIssues        Boolean   @default(false) @map("arc_has_issues")
  arcRemarks          String?   @map("arc_remarks") @db.Text
  
  // Overall
  overallStatus       String    @default("IN_PROGRESS") @map("overall_status") @db.VarChar(30)
  
  createdAt           DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt           DateTime  @updatedAt @map("updated_at") @db.Timestamptz
  
  candidate           Candidate @relation(fields: [candidateId], references: [id])
  
  @@index([overallStatus])
  @@map("overseas_progress")
}

// ==========================================
// Phase 7: Collaboration & Alert System
// ==========================================

// Á≥ªÁµ±Ë®éË´ñ‰∏≤ (7.1)
model SystemComment {
  id          String   @id @default(uuid()) @db.Uuid
  
  // Â§öÂûãÊÖãÈóúËÅØÔºöÂèØÊéõËºâÊñºÂ§öÁ®ÆÂØ¶È´î
  entityType  CommentEntityType @map("entity_type")
  entityId    String   @map("entity_id") @db.Uuid
  
  // ÂÖßÂÆπ
  content     String   @db.Text
  
  // ÁôºÂ∏ÉËÄÖ
  authorId    String   @map("author_id") @db.Uuid
  author      InternalUser @relation("CommentAuthor", fields: [authorId], references: [id])
  
  // ÊôÇÈñìÊà≥Ë®ò
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt   DateTime @updatedAt @map("updated_at") @db.Timestamptz
  
  // ËªüÂà™Èô§
  isDeleted   Boolean  @default(false) @map("is_deleted")
  
  // Relations
  mentions    CommentMention[]
  
  @@index([entityType, entityId])
  @@index([authorId])
  @@map("system_comments")
}

// @ÊèêÂèäË®òÈåÑ (7.1)
model CommentMention {
  id          String   @id @default(uuid()) @db.Uuid
  commentId   String   @map("comment_id") @db.Uuid
  userId      String   @map("user_id") @db.Uuid
  
  // ÊòØÂê¶Â∑≤ËÆÄ
  isRead      Boolean  @default(false) @map("is_read")
  readAt      DateTime? @map("read_at") @db.Timestamptz
  
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz
  
  comment     SystemComment @relation(fields: [commentId], references: [id], onDelete: Cascade)
  user        InternalUser  @relation("MentionedUser", fields: [userId], references: [id])
  
  @@unique([commentId, userId])
  @@index([userId, isRead])
  @@map("comment_mentions")
}

// Êô∫ÊÖßÁï∞Â∏∏Ë≠¶Á§∫ (7.2)
model SystemAlert {
  id          String   @id @default(uuid()) @db.Uuid
  
  // ÈóúËÅØÂØ¶È´î
  entityType  CommentEntityType @map("entity_type")
  entityId    String   @map("entity_id") @db.Uuid
  
  // Ë≠¶Á§∫ÂÖßÂÆπ
  severity    AlertSeverity
  title       String   @db.VarChar(100)
  description String?  @db.Text
  
  // Âà∞Êúü/ÈÄæÊúüË≥áË®ä
  dueDate     DateTime? @map("due_date") @db.Date
  alertType   String   @map("alert_type") @db.VarChar(50) // e.g., "ARC_EXPIRY", "HEALTH_CHECK", "ENTRY_REPORT"
  
  // ÁãÄÊÖã
  status      AlertStatus @default(OPEN)
  acknowledgedBy String? @map("acknowledged_by") @db.Uuid
  acknowledgedAt DateTime? @map("acknowledged_at") @db.Timestamptz
  resolvedAt     DateTime? @map("resolved_at") @db.Timestamptz
  
  // ÊôÇÈñìÊà≥Ë®ò
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt   DateTime @updatedAt @map("updated_at") @db.Timestamptz
  
  @@index([severity, status])
  @@index([entityType, entityId])
  @@index([dueDate])
  @@map("system_alerts")
}
