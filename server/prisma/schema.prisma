generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Enums (SQLite treats validation as app-level)
// We keep the map for consistency but remove db-specific attributes if any

// Models

model InternalUser {
  id           String   @id @default(uuid())
  username     String   @unique
  email        String   @unique
  passwordHash String   @map("password_hash")
  role         String   @default("staff") // SQLite enums handled as strings
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @default(now()) @updatedAt @map("updated_at")

  // Relations
  createdEmployers Employer[] @relation("EmployerCreatedBy")
  updatedEmployers Employer[] @relation("EmployerUpdatedBy")
  createdWorkers   Worker[]   @relation("WorkerCreatedBy")
  updatedWorkers   Worker[]   @relation("WorkerUpdatedBy")
  createdJobOrders JobOrder[] @relation("JobOrderCreatedBy")
  updatedJobOrders JobOrder[] @relation("JobOrderUpdatedBy")

  assignedServices ServiceAssignment[] @relation("ServiceAssignedUser")

  comments         SystemComment[]  @relation("CommentAuthor")
  mentionsReceived CommentMention[] @relation("MentionedUser")
  coordinatedDisputes DisputeRecord[] @relation("DisputeCoordinator")
  handledResolutions  ResolutionLog[] @relation("ResolutionHandler")
  advancePayments     AdvancePayment[] @relation("StaffAdvancePayments")
  assignedLeads       Lead[]           @relation("LeadAssigned")

  @@map("internal_users")
}

model Employer {
  id               String  @id @default(uuid())
  taxId            String  @unique @map("tax_id")
  companyName      String  @map("company_name")
  type             String  @default("corporate") // Enum: corporate, individual
  withholdingTaxId String? @map("withholding_tax_id")
  invoiceAddress   String? @map("invoice_address")

  responsiblePerson       String?   @map("responsible_person")
  responsiblePersonDob    DateTime? @map("responsible_person_dob")
  responsiblePersonIdNo   String?   @map("responsible_person_id_no")
  responsiblePersonFather String?   @map("responsible_person_father_name")
  responsiblePersonMother String?   @map("responsible_person_mother_name")
  responsiblePersonSpouse String?   @map("responsible_person_spouse")
  idIssueDate             DateTime? @map("id_issue_date")
  idIssuePlace            String?   @map("id_issue_place")
  militaryStatus          String?   @map("military_status")

  address     String?
  phoneNumber String? @map("phone_number")

  factoryRegistrationNo    String? @map("factory_registration_no")
  factoryRegistrationId    String? @map("factory_registration_id")
  industryType             String? @map("industry_type")
  laborInsuranceNo         String? @map("labor_insurance_no")
  laborInsuranceId         String? @map("labor_insurance_id")
  healthInsuranceUnitNo    String? @map("health_insurance_unit_no")
  healthInsuranceId        String? @map("health_insurance_id")
  email                    String?
  faxNumber                String? @map("fax_number")
  billAddress              String? @map("bill_address")
  industryCode             String? @map("industry_code")
  responsiblePersonAddress String? @map("responsible_person_address")

  createdBy     String?       @map("created_by")
  updatedBy     String?       @map("updated_by")
  createdByUser InternalUser? @relation("EmployerCreatedBy", fields: [createdBy], references: [id])
  updatedByUser InternalUser? @relation("EmployerUpdatedBy", fields: [updatedBy], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  // Relations
  recruitmentLetters RecruitmentLetter[]
  deployments        Deployment[]
  permitDocuments    PermitDocument[]
  bills              Bill[]
  incidents          Incident[]
  serviceAssignments ServiceAssignment[]
  jobOrders          JobOrder[]
  transfersOut       TransferRecord[] @relation("TransferOldEmployer")
  transfersIn        TransferRecord[] @relation("TransferNewEmployer")

  agencyCompanyId String? @map("agency_company_id")
  agency          AgencyCompany? @relation(fields: [agencyCompanyId], references: [id])

  // Polymorphic Relation Fields
  category        String @default("MANUFACTURING") // MANUFACTURING, HOME_CARE, INSTITUTION

  allocationRate  Decimal? @map("allocation_rate") // 0.10, 0.15, 0.20, 0.25, 0.35
  totalQuota      Int?     @map("total_quota")
  
  complianceStandard   String?   @map("compliance_standard") // RBA, IWAY, NONE
  zeroFeeEffectiveDate DateTime? @map("zero_fee_effective_date")
  
  houseTaxId      String?  @map("house_tax_id") // For non-resident tax filing

  factoryInfo     FactoryInfo?
  homeCareInfo    HomeCareInfo?
  institutionInfo InstitutionInfo?

  laborCounts     EmployerLaborCount[]
  payrollRecords  PayrollRecord[]

  @@map("employers")
}

model FactoryInfo {
  id                    String @id @default(uuid())
  employerId            String @unique @map("employer_id")
  employer              Employer @relation(fields: [employerId], references: [id], onDelete: Cascade)

  factoryRegistrationNo String? @map("factory_registration_no")
  industryType          String? @map("industry_type")
  factoryAddress        String? @map("factory_address")
  
  @@map("employer_factory_infos")
}

model EmployerLaborCount {
  id         String   @id @default(uuid())
  employerId String   @map("employer_id")
  year       Int
  month      Int
  count      Int      @default(0)

  employer   Employer @relation(fields: [employerId], references: [id], onDelete: Cascade)

  updatedAt  DateTime @default(now()) @updatedAt @map("updated_at")

  @@unique([employerId, year, month])
  @@map("employer_labor_counts")
}

model PayrollRecord {
  id              String   @id @default(uuid())
  workerId        String   @map("worker_id")
  employerId      String   @map("employer_id")

  workPeriodStart DateTime @map("work_period_start")
  workPeriodEnd   DateTime @map("work_period_end")
  payDate         DateTime @map("pay_date") // Critical for tax year attribution

  salaryAmount    Decimal  @default(0) @map("salary_amount")
  bonusAmount     Decimal  @default(0) @map("bonus_amount")
  
  taxWithheld     Decimal  @default(0) @map("tax_withheld")
  taxRateUsed     Decimal  @default(0) @map("tax_rate_used") // e.g. 0.06, 0.18

  filingStatus    String   @default("PENDING") @map("filing_status") // PENDING, FILED_MONTHLY, FILED_ANNUALLY
  
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  worker          Worker   @relation(fields: [workerId], references: [id], onDelete: Cascade)
  employer        Employer @relation(fields: [employerId], references: [id], onDelete: Cascade)

  @@map("payroll_records")
}

model HomeCareInfo {
  id          String   @id @default(uuid())
  employerId  String   @unique @map("employer_id")
  employer    Employer @relation(fields: [employerId], references: [id], onDelete: Cascade)
  
  patients    Patient[]

  @@map("employer_home_care_infos")
}

model Patient {
  id             String       @id @default(uuid())
  homeCareInfoId String       @map("home_care_info_id")
  homeCareInfo   HomeCareInfo @relation(fields: [homeCareInfoId], references: [id], onDelete: Cascade)

  name         String
  idNo         String?   @map("id_no")
  dob          DateTime?
  relationship String?
  careAddress  String?   @map("care_address")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("patients")
}

model InstitutionInfo {
  id              String   @id @default(uuid())
  employerId      String   @unique @map("employer_id")
  employer        Employer @relation(fields: [employerId], references: [id], onDelete: Cascade)

  institutionCode String? @map("institution_code")
  bedCount        Int?    @map("bed_count")

  @@map("employer_institution_infos")
}

model Worker {
  id          String   @id @default(uuid())
  englishName String   @map("english_name")
  chineseName String?  @map("chinese_name")
  dob         DateTime
  nationality String // Enum as string
  category    String   @default("general") // Enum as string
  gender      String? // Enum as string

  oldPassportNumber String? @map("old_passport_number")
  homeCountryId     String? @map("home_country_id")
  taxId             String? @map("tax_id")
  bloodType         String? @map("blood_type")
  religion          String? @map("religion")
  isTaxResident     Boolean @default(false) @map("is_tax_resident")

  mobilePhone    String?   @map("mobile_phone")
  foreignAddress String?   @map("foreign_address")
  maritalStatus  String?   @map("marital_status")
  marriageDate   DateTime? @map("marriage_date")
  divorceDate    DateTime? @map("divorce_date")
  height         Decimal?
  weight         Decimal?
  birthPlace     String?   @map("birth_place")
  educationLevel String?   @map("education_level")
  spouseName     String?   @map("spouse_name")

  overseasContactPhone  String? @map("overseas_contact_phone")
  overseasFamilyContact String? @map("overseas_family_contact")

  lineId                String? @map("line_id")
  emergencyContactPhone String? @map("emergency_contact_phone")

  bankAccountNo     String?  @map("bank_account_no")
  bankCode          String?  @map("bank_code")
  bankBranchName    String?  @map("bank_branch_name")
  bankAccountHolder String?  @map("bank_account_holder")
  loanBank          String?  @map("loan_bank")
  loanAmount        Decimal? @map("loan_amount")

  flightArrivalInfo    String? @map("flight_arrival_info")
  oneStopServiceSerial String? @map("one_stop_service_serial")
  flightDeparture      String? @map("flight_departure")

  dormitoryId String? @map("dormitory_id")

  dormitory Dormitory? @relation(fields: [dormitoryId], references: [id])

  dormitoryBedId String?  @unique @map("dormitory_bed_id")
  bed            DormBed? @relation(fields: [dormitoryBedId], references: [id])

  foreignAgencyId String? @map("foreign_agency_id")
  foreignAgency   ForeignAgency? @relation(fields: [foreignAgencyId], references: [id])

  createdBy     String?       @map("created_by")
  updatedBy     String?       @map("updated_by")
  createdByUser InternalUser? @relation("WorkerCreatedBy", fields: [createdBy], references: [id])
  updatedByUser InternalUser? @relation("WorkerUpdatedBy", fields: [updatedBy], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  // Relations
  passports           WorkerPassport[]
  arcs                WorkerArc[]
  deployments         Deployment[]
  healthChecks        HealthCheck[]
  incidents           Incident[]
  serviceAssignments  ServiceAssignment[]
  insurances          WorkerInsurance[]
  addressHistory      WorkerAddressHistory[]
  interviewCandidates InterviewCandidate[]
  bills               Bill[]
  transfers           TransferRecord[]
  advancePayments     AdvancePayment[]
  studentEvaluation   StudentEvaluation?
  payrollRecords      PayrollRecord[]

  @@map("workers")
}

model StudentEvaluation {
  id           String   @id @default(uuid())
  workerId     String   @unique @map("worker_id")
  deploymentId String?  @map("deployment_id")
  
  // 1. Education
  educationDegree String? @map("education_degree") // PhD, Master, Bachelor, Associate
  educationScore  Int     @default(0) @map("education_score")

  // 2. Salary
  avgMonthlySalary Decimal? @map("avg_monthly_salary")
  salaryScore      Int      @default(0) @map("salary_score")

  // 3. Experience
  experienceYears Decimal? @map("experience_years") // Use decimal to support partial years or store as Int
  experienceScore Int      @default(0) @map("experience_score")

  // 4. Qualifications
  qualificationDetails String? @map("qualification_details") // Special skills/licenses
  qualificationScore   Int     @default(0) @map("qualification_score")

  // 5. Chinese Capability
  chineseLevel String? @map("chinese_level") // Fluent, High, Advanced
  chineseScore Int     @default(0) @map("chinese_score")

  // 6. Other Languages
  otherLanguageDetails String? @map("other_language_details")
  otherLanguageScore   Int     @default(0) @map("other_language_score")

  // 7. Overseas Growth
  overseasGrowthDetails String? @map("overseas_growth_details")
  overseasGrowthScore   Int     @default(0) @map("overseas_growth_score")

  // 8. Policy
  policyDetails String? @map("policy_details") // 5+2 industries, New Southbound Policy
  policyScore   Int     @default(0) @map("policy_score")

  totalScore  Int     @default(0) @map("total_score")
  isQualified Boolean @default(false) @map("is_qualified")

  status      String  @default("Draft") // Draft, Submitted
  reviewNotes String? @map("review_notes")

  worker     Worker      @relation(fields: [workerId], references: [id])
  deployment Deployment? @relation(fields: [deploymentId], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("student_evaluations")
}

model RecruitmentLetter {
  id            String   @id @default(uuid())
  employerId    String   @map("employer_id")
  letterNumber  String   @unique @map("letter_number")
  issueDate     DateTime @map("issue_date")
  expiryDate    DateTime @map("expiry_date")
  approvedQuota Int      @default(0) @map("approved_quota")
  // usedQuota is now calculated from EntryPermits or we keep it as a cached field?
  // Request says: "RecruitmentLetter.usedQuota should be the sum of quotas of all its EntryPermits."
  // So we can keep it for easy access or remove it. Let's keep it but manage it via logic.
  usedQuota     Int      @default(0) @map("used_quota")

  // Information for M343 (Recruitment Application)
  reviewFeeReceiptNo  String?   @map("review_fee_receipt_no")
  reviewFeeDate       DateTime? @map("review_fee_date")
  reviewFeeAmount     Int?      @default(0) @map("review_fee_amount")

  employer Employer @relation(fields: [employerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  // Relations
  entryPermits EntryPermit[]

  @@map("recruitment_letters")
}

model EntryPermit {
  id                  String   @id @default(uuid())
  recruitmentLetterId String   @map("recruitment_letter_id")
  permitNumber        String   @unique @map("permit_number")
  issueDate           DateTime @map("issue_date")
  expiryDate          DateTime @map("expiry_date")
  quota               Int      @map("quota") // Batch size
  
  // To track usage of this specific permit batch
  usedCount           Int      @default(0) @map("used_count")

  recruitmentLetter RecruitmentLetter @relation(fields: [recruitmentLetterId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  // Relations
  deployments Deployment[]

  @@map("entry_permits")
}

model WorkerPassport {
  id             String   @id @default(uuid())
  workerId       String   @map("worker_id")
  passportNumber String   @map("passport_number")
  issueDate      DateTime @map("issue_date")
  expiryDate     DateTime @map("expiry_date")
  issuePlace     String?  @map("issue_place")
  isCurrent      Boolean  @default(false) @map("is_current")
  isVerified     Boolean  @default(false) @map("is_verified")

  worker Worker @relation(fields: [workerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("worker_passports")
}

model WorkerArc {
  id         String   @id @default(uuid())
  workerId   String   @map("worker_id")
  arcNumber  String   @map("arc_number")
  issueDate  DateTime @map("issue_date")
  expiryDate DateTime @map("expiry_date")
  isCurrent  Boolean  @default(false) @map("is_current")
  isVerified Boolean  @default(false) @map("is_verified")

  worker Worker @relation(fields: [workerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("worker_arcs")
}

model Deployment {
  id                  String  @id @default(uuid())
  workerId            String  @map("worker_id")
  employerId          String  @map("employer_id")
  entryPermitId       String? @map("entry_permit_id")

  startDate     DateTime  @map("start_date")
  endDate       DateTime? @map("end_date")
  status        String    @default("active") // Enum as string
  serviceStatus String    @default("active_service") @map("service_status") // Enum as string
  sourceType    String    @default("direct_hiring") @map("source_type") // Enum as string
  processStage  String    @default("recruitment") @map("process_stage") // recruitment, visa_processing, flight_booking, arrival, medical_check

  jobDescription     String?   @map("job_description")
  entryDate          DateTime? @map("entry_date")
  entryReportSerial  String?   @map("entry_report_serial")
  entryReportDocNo   String?   @map("entry_report_doc_no")
  flightNumber       String?   @map("flight_number")
  flightArrivalDate  DateTime? @map("flight_arrival_date")
  visaLetterNo       String?   @map("visa_letter_no")
  jobType            String?   @map("job_type")
  shift              String?   @map("shift")
  basicSalary        Decimal?  @map("basic_salary")
  laborInsuranceAmt  Decimal?  @map("labor_insurance_amt")
  healthInsuranceAmt Decimal?  @map("health_insurance_amt")

  // Information for M343 (Employment Permit Application)
  employmentPermitReceiptNo String?   @map("emp_permit_receipt_no")
  employmentPermitDate      DateTime? @map("emp_permit_receipt_date")
  employmentPermitAmount    Int?      @default(0) @map("emp_permit_amount")

  // Information for Notification of Arrival
  visaNumber        String?   @map("visa_number") // Sticker Number (Distinct from visaLetterNo)
  
  // Living Care / Cost Information
  foodStatus        String    @default("provided_free") @map("food_status") // provided_free, provided_charge, self_care
  foodAmount        Decimal   @default(0) @map("food_amount")

  terminationReason String? @map("termination_reason")

  terminationNotes String? @map("termination_notes")

  runawayReportDate     DateTime? @map("runaway_report_date")
  runawayReportDocNo    String?   @map("runaway_report_doc_no")
  terminationPermitDate DateTime? @map("termination_permit_date")
  terminationPermitNo   String?   @map("termination_permit_no")
  transferPermitDate    DateTime? @map("transfer_permit_date")

  transferPermitNo String? @map("transfer_permit_no")

  runawayReportNo   String? @map("runaway_report_no")
  entryReportNo     String? @map("entry_report_no")
  laborContractType String? @map("labor_contract_type")

  // Permit/Visa Details
  visaLetterDate          DateTime? @map("visa_letter_date")
  entryReportDate         DateTime? @map("entry_report_date")
  fingerprintDate         DateTime? @map("fingerprint_date")
  replacementLetterNumber String?   @map("replacement_letter_number")
  replacementLetterDate   DateTime? @map("replacement_letter_date")

  worker            Worker                     @relation(fields: [workerId], references: [id])
  employer          Employer                   @relation(fields: [employerId], references: [id])
  entryPermit       EntryPermit?               @relation(fields: [entryPermitId], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  // Relations
  timelines     WorkerTimeline?
  healthChecks  HealthCheck[]
  permitDetails WorkerPermitDetail[]
  insurances    WorkerInsurance[]
  bills         Bill[]
  monthlyFee    MonthlyServiceFee?
  feeSchedules  FeeSchedule[]
  transfers     TransferRecord[]
  studentEvaluations StudentEvaluation[]

  @@map("deployments")
}

model PermitDocument {
  id               String   @id @default(uuid())
  employerId       String   @map("employer_id")
  permitNumber     String   @unique @map("permit_number")
  issueDate        DateTime @map("issue_date")
  issuingAuthority String?  @map("issuing_authority")

  employer Employer @relation(fields: [employerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  // Relations
  workerPermitDetails WorkerPermitDetail[]

  @@map("permit_documents")
}

model WorkerPermitDetail {
  id               String   @id @default(uuid())
  permitDocumentId String   @map("permit_document_id")
  deploymentId     String   @map("deployment_id")
  permitType       String   @map("permit_type") // Enum as string
  startDate        DateTime @map("start_date")
  endDate          DateTime @map("end_date")

  permitDocument PermitDocument @relation(fields: [permitDocumentId], references: [id], onDelete: Cascade)
  deployment     Deployment     @relation(fields: [deploymentId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("worker_permit_details")
}

model WorkerTimeline {
  id           String @id @default(uuid())
  deploymentId String @unique @map("deployment_id")

  entryMedCheckDeadline DateTime? @map("entry_med_check_deadline")
  empPermitDeadline     DateTime? @map("emp_permit_deadline")
  arcDeadline           DateTime? @map("arc_deadline")

  medCheck6moDeadline  DateTime? @map("med_check_6mo_deadline")
  medCheck18moDeadline DateTime? @map("med_check_18mo_deadline")
  medCheck30moDeadline DateTime? @map("med_check_30mo_deadline")

  residencePermitExpiry DateTime? @map("residence_permit_expiry")
  passportExpiry        DateTime? @map("passport_expiry")

  renewalWindowStart DateTime? @map("renewal_window_start")
  renewalWindowEnd   DateTime? @map("renewal_window_end")

  deployment Deployment @relation(fields: [deploymentId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("worker_timelines")
}

model HealthCheck {
  id            String    @id @default(uuid())
  workerId      String    @map("worker_id")
  deploymentId  String    @map("deployment_id")
  checkType     String    @map("check_type") // Enum
  checkDate     DateTime  @map("check_date")
  hospitalName  String?   @map("hospital_name")
  status        String    @default("upcoming") // upcoming, notified, scheduled, completed, archived
  notificationDate DateTime? @map("notification_date")
  result        String    @default("pending") // pending, pass, fail, needs_recheck
  reportDate    DateTime? @map("report_date")
  approvalDate  DateTime? @map("approval_date")
  approvalDocNo String?   @map("approval_doc_no")

  isRecheckRequired Boolean   @default(false) @map("is_recheck_required")
  recheckDate       DateTime? @map("recheck_date")
  recheckResult     String?   @map("recheck_result")
  treatmentHospital String?   @map("treatment_hospital")

  failReason String? @map("fail_reason")

  worker     Worker     @relation(fields: [workerId], references: [id], onDelete: Cascade)
  deployment Deployment @relation(fields: [deploymentId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("health_checks")
}

model Incident {
  id            String   @id @default(uuid())
  workerId      String?  @map("worker_id")
  employerId    String?  @map("employer_id")
  description   String
  severityLevel String   @map("severity_level") // Enum
  status        String   @default("open") // Enum
  incidentDate  DateTime @default(now()) @map("incident_date")

  isAutoGenerated Boolean @default(false) @map("is_auto_generated")
  sourceRefId     String? @map("source_ref_id")

  worker   Worker?   @relation(fields: [workerId], references: [id])
  employer Employer? @relation(fields: [employerId], references: [id])
  dispute  DisputeRecord?

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("incidents")
}

model ServiceAssignment {
  id             String    @id @default(uuid())
  employerId     String?   @map("employer_id")
  workerId       String?   @map("worker_id")
  internalUserId String    @map("internal_user_id")
  role           String // Enum
  startDate      DateTime  @default(now()) @map("start_date")
  endDate        DateTime? @map("end_date")
  notes          String?

  employer     Employer?    @relation(fields: [employerId], references: [id], onDelete: Cascade)
  worker       Worker?      @relation(fields: [workerId], references: [id], onDelete: Cascade)
  internalUser InternalUser @relation("ServiceAssignedUser", fields: [internalUserId], references: [id])

  createdAt DateTime @default(now()) @map("created_at")

  @@map("service_assignments")
}

model WorkerInsurance {
  id            String    @id @default(uuid())
  workerId      String    @map("worker_id")
  deploymentId  String?   @map("deployment_id")
  type          String // Enum
  providerName  String?   @map("provider_name")
  policyNumber  String?   @map("policy_number")
  insuredAmount Decimal?  @map("insured_amount")
  startDate     DateTime  @map("start_date")
  endDate       DateTime? @map("end_date")

  applyDate             DateTime? @map("apply_date")
  effectiveDate         DateTime? @map("effective_date")
  withdrawApplyDate     DateTime? @map("withdraw_apply_date")
  withdrawEffectiveDate DateTime? @map("withdraw_effective_date")

  worker     Worker      @relation(fields: [workerId], references: [id], onDelete: Cascade)
  deployment Deployment? @relation(fields: [deploymentId], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("worker_insurances")
}

model WorkerAddressHistory {
  id            String    @id @default(uuid())
  workerId      String    @map("worker_id")
  addressType   String    @map("address_type") // Enum
  addressDetail String    @map("address_detail")
  startDate     DateTime  @map("start_date")
  endDate       DateTime? @map("end_date")

  worker Worker @relation(fields: [workerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")

  @@map("worker_address_history")
}

model JobOrder {
  id                       String    @id @default(uuid())
  employerId               String    @map("employer_id")
  orderDate                DateTime  @default(now()) @map("order_date")
  requiredWorkers          Int       @map("required_workers")
  expectedArrivalDate      DateTime? @map("expected_arrival_date")
  localRecruitmentDeadline DateTime? @map("local_recruitment_deadline")
  status                   String    @default("open") // Enum

  employer Employer @relation(fields: [employerId], references: [id], onDelete: Cascade)

  createdBy     String?       @map("created_by")
  updatedBy     String?       @map("updated_by")
  createdByUser InternalUser? @relation("JobOrderCreatedBy", fields: [createdBy], references: [id])
  updatedByUser InternalUser? @relation("JobOrderUpdatedBy", fields: [updatedBy], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  // Relations
  interviews          Interview[]
  domesticRecruitment DomesticRecruitment?

  @@map("job_orders")
}

model DomesticRecruitment {
  id                     String   @id @default(uuid())
  jobOrderId             String   @unique @map("job_order_id")
  
  registryDate           DateTime @map("registry_date") // 求才登記日
  registryNumber         String?  @map("registry_number") // 求才證明序號
  
  laborViolationCertificateDate DateTime? @map("labor_violation_certificate_date") // 無違法證明申請日
  noViolationCertificateNumber  String?   @map("no_violation_certificate_number") // Kept for cert number
  
  jobOrder JobOrder @relation(fields: [jobOrderId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("domestic_recruitments")
}

model Interview {
  id            String   @id @default(uuid())
  jobOrderId    String   @map("job_order_id")
  interviewDate DateTime @map("interview_date")
  location      String?
  interviewer   String?

  jobOrder JobOrder @relation(fields: [jobOrderId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  // Relations
  candidates InterviewCandidate[]

  @@map("interviews")
}

model InterviewCandidate {
  id          String  @id @default(uuid())
  interviewId String  @map("interview_id")
  workerId    String  @map("worker_id")
  result      String  @default("pending") // Enum
  remarks     String?

  interview Interview @relation(fields: [interviewId], references: [id], onDelete: Cascade)
  worker    Worker    @relation(fields: [workerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@unique([interviewId, workerId])
  @@map("interview_candidates")
}

model SystemComment {
  id              String @id @default(uuid())
  recordId        String @map("record_id")
  recordTableName String @map("record_table_name")
  content         String

  createdBy String       @map("created_by")
  author    InternalUser @relation("CommentAuthor", fields: [createdBy], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  mentions CommentMention[]

  @@index([recordTableName, recordId])
  @@map("system_comments")
}

model CommentMention {
  id              String  @id @default(uuid())
  commentId       String  @map("comment_id")
  mentionedUserId String  @map("mentioned_user_id")
  isRead          Boolean @default(false) @map("is_read")

  comment SystemComment @relation(fields: [commentId], references: [id], onDelete: Cascade)
  user    InternalUser  @relation("MentionedUser", fields: [mentionedUserId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")

  @@unique([commentId, mentionedUserId])
  @@map("comment_mentions")
}

model Attachment {
  id       String @id @default(uuid())
  refId    String @map("ref_id")
  refTable String @map("ref_table")

  filePath String  @map("file_path")
  fileName String  @map("file_name")
  fileType String? @map("file_type")

  uploaderId String?  @map("uploader_id")
  uploadedAt DateTime @default(now()) @map("uploaded_at")

  @@index([refTable, refId])
  @@map("attachments")
}

model FeeItem {
  id            String  @id @default(uuid())
  name          String
  defaultAmount Decimal @map("default_amount")
  category      String // Enum: service_fee, placement_fee, official_fee, other
  nationality   String? // Optional: VN, ID, PH, TH
  description   String?
  isZeroFeeSubject Boolean @default(false) @map("is_zero_fee_subject")

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("fee_items")
}

model InsuranceTier {
  id            String   @id @default(uuid())
  grade         Int
  minSalary     Decimal  @map("min_salary")
  maxSalary     Decimal  @map("max_salary")
  laborFee      Decimal  @map("labor_fee")
  healthFee     Decimal  @map("health_fee")
  effectiveDate DateTime @default(now()) @map("effective_date")
  isActive      Boolean  @default(true) @map("is_active")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("insurance_tiers")
}

model Bill {
  id        String @id @default(uuid())
  billNo    String @unique @map("bill_no")
  payerType String @map("payer_type") // Enum: worker, employer

  workerId     String? @map("worker_id")
  employerId   String? @map("employer_id")
  deploymentId String? @map("deployment_id")

  billingDate DateTime @map("billing_date")
  dueDate     DateTime @map("due_date")
  totalAmount Decimal  @map("total_amount")
  paidAmount  Decimal  @default(0) @map("paid_amount")
  balance     Decimal  @default(0)
  previousBalance Decimal @default(0) @map("previous_balance")

  year               Int      @default(0) @map("year")
  month              Int      @default(0) @map("month")
  billingPeriodStart DateTime @default(now()) @map("billing_period_start")
  billingPeriodEnd   DateTime @default(now()) @map("billing_period_end")

  status        String  @default("draft") // Enum: draft, issued, paid, overdue, cancelled
  invoiceNumber String? @map("invoice_number")

  // Relations
  worker     Worker?     @relation(fields: [workerId], references: [id])
  employer   Employer?   @relation(fields: [employerId], references: [id])
  deployment Deployment? @relation(fields: [deploymentId], references: [id])
  items        BillItem[]
  feeSchedules FeeSchedule[]
  invoice      Invoice?

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("bills")
}

model DocumentTemplate {
  id          String  @id @default(uuid())
  name        String
  category    String // Enum: entry, medical, transfer, termination
  filePath    String  @map("file_path")
  description String?
  isActive    Boolean @default(true) @map("is_active")
  nationality String? // Optional: VN, ID, PH, TH

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("document_templates")
}

model BillItem {
  id          String  @id @default(uuid())
  billId      String  @map("bill_id")
  description String
  amount      Decimal
  feeCategory String  @map("fee_category") // Enum
  
  complianceOverrideReason String? @map("compliance_override_reason")
  isOverridden             Boolean @default(false) @map("is_overridden")

  bill Bill @relation(fields: [billId], references: [id], onDelete: Cascade)
  advancePayment AdvancePayment?

  @@map("bill_items")
}

model MonthlyServiceFee {
  id           String @id @default(uuid())
  deploymentId String @unique @map("deployment_id")

  amountYear1 Decimal @default(1800) @map("amount_year_1")
  amountYear2 Decimal @default(1700) @map("amount_year_2")
  amountYear3 Decimal @default(1500) @map("amount_year_3")
  
  accommodationFee Decimal @default(0) @map("accommodation_fee")

  lastBilledDate DateTime? @map("last_billed_date")

  deployment Deployment @relation(fields: [deploymentId], references: [id], onDelete: Cascade)

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("monthly_service_fees")
}

model FeeSchedule {
  id              String   @id @default(uuid())
  deploymentId    String   @map("deployment_id")
  installmentNo   Int      @map("installment_no")
  scheduleDate    DateTime @map("schedule_date")
  expectedAmount  Decimal  @map("expected_amount")
  paidAmount      Decimal  @default(0) @map("paid_amount")
  status          String   @default("pending") // pending, partial, paid, overdue
  description     String?
  
  billId          String?  @map("bill_id")
  
  deployment      Deployment @relation(fields: [deploymentId], references: [id], onDelete: Cascade)
  bill            Bill?      @relation(fields: [billId], references: [id]) 

  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("fee_schedules")
}

// =========================================
// 宿舍管理模組 (Dormitory Management)
// =========================================

model Dormitory {
  id                   String    @id @default(uuid())
  name                 String
  address              String
  capacity             Int       @default(0)
  currentOccupancy     Int       @default(0) @map("current_occupancy")
  landlordName         String?   @map("landlord_name")
  landlordPhone        String?   @map("landlord_phone")
  accommodationType    String?   @map("accommodation_type") // e.g. Factory Dorm, Rental
  safetyInspectionDate DateTime? @map("safety_inspection_date")
  
  // New Advanced Management Fields
  primaryManager    String?   @map("primary_manager") // "我司", "他仲", "雇主"
  totalArea         Decimal?  @map("total_area") // Total area in m²
  buildingUseType   String?   @map("building_use_type") // Building permit classification e.g. "H-1", "H-2", "Factory"
  fireSafetyExpiry  DateTime? @map("fire_safety_expiry") // Fire safety certification expiry

  // Compliance Fields for Living Care Plan
  bathroomCount     Int       @default(0) @map("bathroom_count")
  waterHeaterCount  Int       @default(0) @map("water_heater_count")
  isFactorySeparated Boolean  @default(true) @map("is_factory_separated")

  // Safety Equipment
  hasFireExtinguisher Boolean @default(true) @map("has_fire_extinguisher")
  hasFireAlarm        Boolean @default(true) @map("has_fire_alarm")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  // Relations
  rooms       DormRoom[]
  workers     Worker[]
  leases      Lease[]
  equipment   DormEquipment[]
  maintenance MaintenanceLog[]

  @@map("dormitories")
}

model DormRoom {
  id               String  @id @default(uuid())
  dormitoryId      String  @map("dormitory_id")
  roomNumber       String  @map("room_number") // e.g. "201", "A-1"
  capacity         Int     @default(0)
  currentHeadCount Int     @default(0) @map("current_head_count")
  gender           String? // Enum: male, female, mixed
  floor            Int?
  
  // New Advanced Management Fields
  area                Decimal? // Room area in m² (critical for compliance)
  accommodationType   String?  @map("accommodation_type") // "套房", "雅房"

  dormitory Dormitory @relation(fields: [dormitoryId], references: [id], onDelete: Cascade)

  // Relations
  beds   DormBed[]
  meters DormMeter[]

  @@map("dorm_rooms")
}

model DormBed {
  id      String @id @default(uuid())
  roomId  String @map("room_id")
  bedCode String @map("bed_code") // e.g. "1", "A", "Upper-L"
  status  String @default("vacant") // Enum: vacant, occupied, maintenance

  room   DormRoom @relation(fields: [roomId], references: [id], onDelete: Cascade)
  worker Worker?  // One-to-One: defined in Worker side as relation

  @@map("dorm_beds")
}

// 水電錶與抄表
model DormMeter {
  id          String  @id @default(uuid())
  roomId      String  @map("room_id")
  meterName   String  @map("meter_name") // e.g. "201冷氣", "3F總水錶"
  meterType   String  @map("meter_type") // Enum: electricity, water, gas
  ratePerUnit Decimal @default(5.0) @map("rate_per_unit")

  room DormRoom @relation(fields: [roomId], references: [id], onDelete: Cascade)

  // Relations
  readings MeterReading[]

  @@map("dorm_meters")
}

model MeterReading {
  id           String   @id @default(uuid())
  meterId      String   @map("meter_id")
  readingDate  DateTime @map("reading_date")
  readingValue Decimal  @map("reading_value")
  usage        Decimal // usage = current - prev
  cost         Decimal // cost = usage * rate
  isBilled     Boolean  @default(false) @map("is_billed")

  meter DormMeter @relation(fields: [meterId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("meter_readings")
}

model AgencyCompany {
  id                String   @id @default(uuid())
  name              String
  licenseNo         String   @map("license_no")
  taxId             String   @map("tax_id")
  responsiblePerson String   @map("responsible_person")
  address           String?
  phone             String?
  fax               String?
  email             String?
  isDefault         Boolean  @default(false) @map("is_default")

  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @default(now()) @updatedAt @map("updated_at")

  // Relations
  employers         Employer[]

  @@map("agency_companies")
}

model TransferRecord {
  id           String   @id @default(uuid())
  workerId     String   @map("worker_id")
  deploymentId String   @map("deployment_id") // The deployment ending due to transfer
  oldEmployerId String  @map("old_employer_id")
  newEmployerId String? @map("new_employer_id")

  status       String   @default("pending") // negotiating, agreed, mol_issued, completion_pending, completed, cancelled
  
  agreementDate       DateTime? @map("agreement_date") // 雙方/三方合意
  molLetterNumber     String?   @map("mol_letter_number") // 廢聘號
  molLetterDate       DateTime? @map("mol_letter_date")  // 廢聘日
  
  newEmployerRegDate  DateTime? @map("new_employer_reg_date") // 新雇主登記
  transferDate        DateTime? @map("transfer_date") // 生效日

  notes String?

  worker       Worker     @relation(fields: [workerId], references: [id], onDelete: Cascade)
  deployment   Deployment @relation(fields: [deploymentId], references: [id])
  oldEmployer  Employer   @relation("TransferOldEmployer", fields: [oldEmployerId], references: [id])
  newEmployer  Employer?  @relation("TransferNewEmployer", fields: [newEmployerId], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("transfer_records")
}

model ForeignAgency {
  id            String   @id @default(uuid())
  name          String
  chineseName   String?  @map("chinese_name")
  country       String   // Enum: VN, ID, PH, TH
  code          String?
  contactPerson String?  @map("contact_person")
  email         String?
  phone         String?

  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @default(now()) @updatedAt @map("updated_at")

  // Relations
  workers       Worker[]

  @@map("foreign_agencies")
}

model DisputeRecord {
  id              String   @id @default(uuid())
  incidentId      String   @unique @map("incident_id")
  
  source          String   // 1955, Bureau, Internal
  complaintType   String   @map("complaint_type") // Wage, Dorm, Management
  
  coordinatorId   String?  @map("coordinator_id")
  coordinator     InternalUser? @relation("DisputeCoordinator", fields: [coordinatorId], references: [id])

  status          String   @default("open") 

  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @default(now()) @updatedAt @map("updated_at")

  incident        Incident @relation(fields: [incidentId], references: [id])
  resolutions     ResolutionLog[]

  @@map("dispute_records")
}

model ResolutionLog {
  id              String   @id @default(uuid())
  disputeRecordId String   @map("dispute_record_id")
  logDate         DateTime @default(now()) @map("log_date")
  description     String
  outcome         String?
  
  handlerId       String?  @map("handler_id")
  handler         InternalUser? @relation("ResolutionHandler", fields: [handlerId], references: [id])

  disputeRecord   DisputeRecord @relation(fields: [disputeRecordId], references: [id], onDelete: Cascade)

  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("resolution_logs")
}

model AdvancePayment {
  id          String   @id @default(uuid())
  payerId     String   @map("payer_id")
  workerId    String?  @map("worker_id") // Usually associated with a worker/job
  description String
  amount      Decimal
  receiptImage String? @map("receipt_image")
  paymentDate DateTime @default(now()) @map("payment_date")
  
  status      String   @default("pending") // pending, approved, reimbursed, billed, rejected
  
  billItemId  String?  @unique @map("bill_item_id")
  billItem    BillItem? @relation(fields: [billItemId], references: [id])

  payer       InternalUser @relation("StaffAdvancePayments", fields: [payerId], references: [id])
  worker      Worker?      @relation(fields: [workerId], references: [id])

  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("advance_payments")
}

model Invoice {
  id            String   @id @default(uuid())
  billId        String   @unique @map("bill_id")
  
  invoiceNumber String   @unique @map("invoice_number")
  invoiceDate   DateTime @default(now()) @map("invoice_date") // Issued Date
  
  status        String   @default("issued") // issued, void, cancelled
  
  // ECPay / E-Invoice Specifics
  randomCode    String?  @map("random_code") // RelNum or Random
  totalAmount   Decimal  @map("total_amount")
  
  buyerName     String?  @map("buyer_name")
  buyerIdentifier String? @map("buyer_identifier") // Tax ID
  
  carrierType   String?  @map("carrier_type")
  carrierId     String?  @map("carrier_id")
  donationCode  String?  @map("donation_code")
  printMark     String?  @default("N") @map("print_mark")

  // Relations
  bill          Bill     @relation(fields: [billId], references: [id])

  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("invoices")
}

model Lease {
  id                  String    @id @default(uuid())
  dormId              String    @map("dorm_id")
  vendorId            String?   @map("vendor_id") // Landlord/Vendor ID
  
  contractItem        String    @map("contract_item") // Contract description
  payer               String    // Who pays: "我司", "雇主", etc.
  
  startDate           DateTime  @map("start_date")
  endDate             DateTime? @map("end_date")
  
  monthlyRent         Decimal   @map("monthly_rent")
  deposit             Decimal?  @default(0)
  isUtilitiesIncluded Boolean   @default(false) @map("is_utilities_included")
  
  notes               String?
  
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  // Relations
  dormitory Dormitory @relation(fields: [dormId], references: [id], onDelete: Cascade)
  
  @@map("leases")
}

model DormEquipment {
  id          String   @id @default(uuid())
  dormId      String   @map("dorm_id")
  
  name        String
  category    String   // "冷氣", "飲水機", "洗衣機", etc.
  brandModel  String?  @map("brand_model")
  location    String?  // "201房", "公共區域"
  status      String   @default("active") // active, maintenance, retired
  
  // Automated Scheduling Fields
  maintenanceIntervalMonths  Int?      @map("maintenance_interval_months") // e.g., 6 months
  complianceIntervalMonths   Int?      @map("compliance_interval_months") // e.g., 3 months for water quality
  lastMaintenanceDate        DateTime? @map("last_maintenance_date")
  nextMaintenanceDate        DateTime? @map("next_maintenance_date") // Auto-calculated
  
  purchaseDate   DateTime? @map("purchase_date")
  warrantyExpiry DateTime? @map("warranty_expiry")
  
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  // Relations
  dormitory       Dormitory        @relation(fields: [dormId], references: [id], onDelete: Cascade)
  maintenanceLogs MaintenanceLog[]
  
  @@map("dorm_equipment")
}

model MaintenanceLog {
  id          String   @id @default(uuid())
  equipmentId String?  @map("equipment_id") // Optional - can be general dorm maintenance
  dormId      String   @map("dorm_id")
  
  itemType    String   @map("item_type") // "維修", "保養", "更換耗材"
  description String
  
  reportedBy       String?   @map("reported_by") // Who reported the issue
  notificationDate DateTime? @map("notification_date") // When was it reported
  completionDate   DateTime? @map("completion_date") // When was it completed
  
  cost        Decimal?  @default(0)
  payer       String?   // "我司", "雇主", "廠商"
  status      String    @default("PENDING") // PENDING, IN_PROGRESS, COMPLETED
  
  invoiceInfo String?   @map("invoice_info") // Invoice number or reference
  photoPaths  String?   @map("photo_paths") // JSON array of photo URLs
  
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  // Relations
  dormitory Dormitory      @relation(fields: [dormId], references: [id], onDelete: Cascade)
  equipment DormEquipment? @relation(fields: [equipmentId], references: [id], onDelete: SetNull)
  
  @@map("maintenance_logs")
}

model Lead {
  id                  String   @id @default(uuid())
  companyName         String?  @map("company_name")
  contactPerson       String?  @map("contact_person")
  jobTitle            String?  @map("job_title")
  phone               String?
  mobile              String?
  email               String?
  lineId              String?  @map("line_id")
  address             String?

  // Business Info
  status              String   @default("NEW") // NEW, CONTACTED, MEETING, NEGOTIATING, WON, LOST
  source              String?
  estimatedWorkerCount Int?    @map("estimated_worker_count")
  industry            String?
  
  assignedTo          String?  @map("assigned_to")
  assignedUser        InternalUser? @relation("LeadAssigned", fields: [assignedTo], references: [id])

  lastContactDate     DateTime? @map("last_contact_date")
  nextFollowUpDate    DateTime? @map("next_follow_up_date")

  interactions        LeadInteraction[]

  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("leads")
}

model LeadInteraction {
  id           String   @id @default(uuid())
  leadId       String   @map("lead_id") // One-to-Many
  type         String   // Call, Visit, Line, Email
  summary      String
  detailedNotes String? @map("detailed_notes")
  outcome      String?
  date         DateTime @default(now())

  lead         Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)

  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("lead_interactions")
}

model TaxConfig {
  id        String   @id @default(uuid())
  year      Int      @unique
  
  // Minimum Wage Parameters
  minWage                    Int     @map("min_wage") // e.g., 27470 for 2024
  minWageThresholdMultiplier Decimal @default(1.5) @map("min_wage_threshold_multiplier")
  
  // Deductions and Exemptions
  standardDeduction  Int @map("standard_deduction")   // 標準扣除額
  salaryDeduction    Int @map("salary_deduction")     // 薪資所得特別扣除額
  personalExemption  Int @map("personal_exemption")   // 免稅額
  
  // Tax Rates
  taxRateResident       Decimal @map("tax_rate_resident")         // 5% for residents
  nonResidentLowRate    Decimal @map("non_resident_low_rate")     // 6% for low income
  nonResidentHighRate   Decimal @map("non_resident_high_rate")    // 18% for high income
  
  // Metadata
  effectiveDate DateTime  @map("effective_date")  // When this config becomes active
  notes         String?                           // Admin notes about changes
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  
  @@map("tax_configs")
}
