// ==========================================
// Foreign Worker Management
// ==========================================

model Worker {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  englishName String  @map("english_name") @db.VarChar(100) // English Name
  chineseName String? @map("chinese_name") @db.VarChar(50) // Chinese Name
  photoUrl    String? @map("photo_url") @db.VarChar(255) // Photo URL

  dob DateTime @db.Date // Date of Birth

  // [Modified] Nationality (Dynamic)

  nationalityId String? @map("nationality_id") @db.Uuid // Nationality ID

  nationality Nationality? @relation(fields: [nationalityId], references: [id])

  // [Dynamic Extension]
  attributes Json? @map("attributes") @db.JsonB // General dynamic attributes
  healthData Json? @map("health_data") @db.JsonB // Health-related dynamic attributes

  // REMOVED: nationality NationalityType

  category WorkerCategory @default(general) // Worker Category

  gender GenderType? // Gender

  mobilePhone String? @map("mobile_phone") @db.VarChar(50) // Mobile Phone

  // Foreign Address Standardized
  foreignCity          String? @map("foreign_city") @db.VarChar(50)
  foreignDistrict      String? @map("foreign_district") @db.VarChar(50)
  foreignAddressDetail String? @map("foreign_address_detail") @db.VarChar(200)
  foreignZipCode       String? @map("foreign_zip_code") @db.VarChar(20)
  foreignFullAddress   String? @map("foreign_full_address") @db.VarChar(300)

  maritalStatus String? @map("marital_status") @db.VarChar(20) // Marital Status

  marriageDate DateTime? @map("marriage_date") @db.Date // Marriage Date

  divorceDate DateTime? @map("divorce_date") @db.Date // Divorce Date

  height Decimal? @db.Decimal(5, 2) // Height

  weight Decimal? @db.Decimal(5, 2) // Weight

  birthPlace String? @map("birth_place") @db.VarChar(100) // Birth Place

  educationLevel String? @map("education_level") @db.VarChar(50) // Education Level

  spouseName String? @map("spouse_name") @db.VarChar(100) // Spouse Name

  overseasContactPhone String? @map("overseas_contact_phone") @db.VarChar(50) // Overseas Contact Phone

  overseasFamilyContact String? @map("overseas_family_contact") @db.VarChar(100) // Overseas Family Contact

  // Social & Emergency

  lineId String? @map("line_id") @db.VarChar(50) // LINE ID

  religion String? @db.VarChar(50) // Religion

  emergencyContactName String? @map("emergency_contact_name") @db.VarChar(50) // Emergency Contact (TW)

  emergencyContactPhone String? @map("emergency_contact_phone") @db.VarChar(50) // Emergency Phone (TW)

  bankAccountNo String? @map("bank_account_no") @db.VarChar(50) // Bank Account No

  bankCode String? @map("bank_code") @db.VarChar(20) // Bank Code

  loanBank String? @map("loan_bank") @db.VarChar(50) // Loan Bank

  loanAmount Decimal? @map("loan_amount") @db.Decimal(10, 2) // Loan Amount

  flightArrivalInfo String? @map("flight_arrival_info") @db.VarChar(100) // Flight Arrival Info

  oneStopServiceSerial String? @map("one_stop_service_serial") @db.VarChar(50) // One-Stop Service Serial

  flightDeparture String? @map("flight_departure") @db.VarChar(20) // Flight Departure

  createdBy String? @map("created_by") @db.Uuid

  updatedBy String? @map("updated_by") @db.Uuid

  createdByUser InternalUser? @relation("WorkerCreatedBy", fields: [createdBy], references: [id])

  updatedByUser InternalUser? @relation("WorkerUpdatedBy", fields: [updatedBy], references: [id])

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  // Relations

  events WorkerEvent[]

  passports WorkerPassport[]

  arcs WorkerArc[]

  deployments Deployment[]

  healthChecks HealthCheck[]

  incidents Incident[]

  officialDocuments OfficialDocument[]

  serviceAssignments ServiceAssignment[]

  insurances WorkerInsurance[]

  addressHistory WorkerAddressHistory[]

  interviewCandidates InterviewCandidate[]

  payrolls PayrollRecord[]

  // Phase 9: Accounting Module Relations
  receivables Receivable[]

  // Soft Delete

  isDeleted Boolean @default(false) @map("is_deleted")

  deletedAt DateTime? @map("deleted_at")

  // Foreign Agency

  foreignAgencyId String? @map("foreign_agency_id") @db.Uuid

  foreignAgency ForeignAgency? @relation(fields: [foreignAgencyId], references: [id])

  // New Fields for Scheduler

  residencePermitExpiry DateTime? @map("residence_permit_expiry") @db.Date

  passportExpiry DateTime? @map("passport_expiry") @db.Date

  medCheck6moDeadline DateTime? @map("med_check_6mo_deadline") @db.Date

  medCheck18moDeadline DateTime? @map("med_check_18mo_deadline") @db.Date

  medCheck30moDeadline DateTime? @map("med_check_30mo_deadline") @db.Date

  // Dormitory Bed

  bedId String? @unique @map("bed_id") @db.Uuid

  bed DormitoryBed? @relation(fields: [bedId], references: [id])

  EmployerFactory EmployerFactory? @relation(fields: [employerFactoryId], references: [id])

  employerFactoryId String? @db.Uuid

  // Relations

  accommodationHistory WorkerAccommodationHistory[]

  relocationNotifications RelocationNotification[]

  entryFiling EntryFiling?

  medicalExceptions MedicalException[]

  @@map("workers")
}

model WorkerPassport {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  workerId String @map("worker_id") @db.Uuid

  passportNumber String @map("passport_number") @db.VarChar(50)

  issueDate DateTime @map("issue_date") @db.Date

  expiryDate DateTime @map("expiry_date") @db.Date

  issuePlace String? @map("issue_place") @db.VarChar(100)

  isCurrent Boolean @default(false) @map("is_current")

  isVerified Boolean @default(false) @map("is_verified") // Added for verification

  worker Worker @relation(fields: [workerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("worker_passports")
}

model WorkerArc {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  workerId String @map("worker_id") @db.Uuid

  arcNumber String @map("arc_number") @db.VarChar(50)

  issueDate DateTime @map("issue_date") @db.Date

  expiryDate DateTime @map("expiry_date") @db.Date

  isCurrent Boolean @default(false) @map("is_current")

  isVerified Boolean @default(false) @map("is_verified") // Added for verification

  worker Worker @relation(fields: [workerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("worker_arcs")
}

model WorkerAddressHistory {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  workerId String @map("worker_id") @db.Uuid

  addressType AddressType @map("address_type")

  city          String? @db.VarChar(20)
  district      String? @db.VarChar(20)
  addressDetail String  @map("address_detail") @db.Text
  zipCode       String? @map("zip_code") @db.VarChar(10)
  fullAddress   String? @map("full_address") @db.VarChar(300)

  startDate DateTime @map("start_date") @db.Date

  endDate DateTime? @map("end_date") @db.Date

  worker Worker @relation(fields: [workerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  @@map("worker_address_history")
}

model WorkerInsurance {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  workerId String @map("worker_id") @db.Uuid

  deploymentId String? @map("deployment_id") @db.Uuid

  type InsuranceType

  providerName String? @map("provider_name") @db.VarChar(50)

  policyNumber String? @map("policy_number") @db.VarChar(50)

  insuredAmount Decimal? @map("insured_amount") @db.Decimal(10, 2)

  startDate DateTime @map("start_date") @db.Date

  endDate DateTime? @map("end_date") @db.Date

  worker Worker @relation(fields: [workerId], references: [id], onDelete: Cascade)

  deployment Deployment? @relation(fields: [deploymentId], references: [id])

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("worker_insurances")
}

model WorkerEvent {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  workerId String @map("worker_id") @db.Uuid

  eventType WorkerEventType @map("event_type")

  eventDate DateTime? @map("event_date") @db.Date // Event Date

  reportDate DateTime? @map("report_date") @db.Date // Report Date

  bureauRefNumber String? @map("bureau_ref_number") @db.VarChar(50) // Bureau Reference Number

  bureauRefDate DateTime? @map("bureau_ref_date") @db.Date // Bureau Reference Date

  notes String? @db.Text

  fileUrl String? @map("file_url") @db.Text

  worker Worker @relation(fields: [workerId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("worker_events")
}

model RunawayRecord {
  id           String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  deploymentId String     @map("deployment_id") @db.Uuid
  deployment   Deployment @relation(fields: [deploymentId], references: [id], onDelete: Cascade)

  missingDate DateTime @map("missing_date") @db.Date // 憭梯?交?
  reportDate  DateTime @default(now()) @map("report_date") @db.Date // 蝟餌絞閮??交?

  // Government Notification
  notificationDate   DateTime? @map("notification_date") @db.Date // ?銝餌恣璈??交?
  notificationNumber String?   @map("notification_number") @db.VarChar(50) // ?摨?

  status RunawayStatus @default(reported_internally)

  // 3-day logic
  threeDayCountdownStart DateTime? @map("three_day_countdown_start") @db.Date // Usually same as missingDate

  // Quota Impact
  isQuotaFrozen Boolean @default(false) @map("is_quota_frozen")

  notes String? @db.Text

  createdBy String?  @map("created_by") @db.Uuid
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("runaway_records")
}

model WorkerPermitDetail {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  permitDocumentId String @map("permit_document_id") @db.Uuid

  deploymentId String @map("deployment_id") @db.Uuid

  permitType PermitType @map("permit_type")

  startDate DateTime @map("start_date") @db.Date

  endDate DateTime @map("end_date") @db.Date

  permitDocument PermitDocument @relation(fields: [permitDocumentId], references: [id], onDelete: Cascade)

  deployment Deployment @relation(fields: [deploymentId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("worker_permit_details")
}

model WorkerAccommodationHistory {
  id String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid

  workerId String @map("worker_id") @db.Uuid

  worker Worker @relation(fields: [workerId], references: [id], onDelete: Cascade)

  // Accommodation Details

  city          String? @db.VarChar(20)
  district      String? @db.VarChar(20)
  addressDetail String? @map("address_detail") @db.VarChar(200)
  zipCode       String? @map("zip_code") @db.VarChar(10)
  fullAddress   String? @map("full_address") @db.VarChar(300)

  dormitoryBedId String? @map("dormitory_bed_id") @db.Uuid

  dormitoryBed DormitoryBed? @relation(fields: [dormitoryBedId], references: [id])

  // Timeline

  startDate DateTime @map("start_date") @db.Date

  endDate DateTime? @map("end_date") @db.Date

  isCurrent Boolean @default(false) @map("is_current")

  // Audit

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz

  @@map("worker_accommodation_history")
}
